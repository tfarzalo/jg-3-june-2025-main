import{a as e,s as r,b as t,j as s}from"./index-DSvJvUB2.js";import{u as a,r as l}from"./react-vendor-BmeRVKJv.js";import{S as n,t as d,u as o,ag as i,v as c,ah as m,ai as x,j as h,E as b}from"./ui-CiwSAYI4.js";import"./supabase-c3qFLfUQ.js";function g(){const g=a(),{theme:u,toggleTheme:f}=e(),[y,p]=l.useState(!0),[j,k]=l.useState(!1),[w,N]=l.useState(null),[v,_]=l.useState(!1),[C,S]=l.useState({id:"",email:"",full_name:"",role:"user",theme_preference:"dark",notification_settings:null}),[R,E]=l.useState({job_phase_changes:!0,work_orders:!0,callbacks:!0,system_alerts:!0}),[O,U]=l.useState({jobRequests:"",workOrders:"",allJobs:""}),[F,B]=l.useState(null);l.useEffect((()=>{D()}),[]),l.useEffect((()=>{if(F){const e=window.location.origin;U({jobRequests:`${e}/functions/v1/calendar-feed/job-requests?token=${encodeURIComponent(F)}`,workOrders:`${e}/functions/v1/calendar-feed/work-orders?token=${encodeURIComponent(F)}`,allJobs:`${e}/functions/v1/calendar-feed/all-jobs?token=${encodeURIComponent(F)}`})}}),[F]),l.useEffect((()=>{C.theme_preference&&u!==C.theme_preference&&"system"!==C.theme_preference&&f()}),[C.theme_preference,u,f]),l.useEffect((()=>{if(C.notification_settings)try{const e=JSON.parse(C.notification_settings);E(e)}catch(e){}}),[C.notification_settings]);const D=async()=>{try{p(!0);const{data:t,error:s}=await r.auth.getUser();if(s)throw s;if(!t.user)throw new Error("User not found");const{data:a,error:l}=await r.from("profiles").select("*").eq("id",t.user.id).single();if(l){if("PGRST116"!==l.code)throw l;{const e={id:t.user.id,email:t.user.email,full_name:t.user.user_metadata?.full_name||"",role:"user",theme_preference:"dark",notification_settings:JSON.stringify({job_phase_changes:!0,work_orders:!0,callbacks:!0,system_alerts:!0})},{error:s}=await r.from("profiles").insert([e]);if(s)throw s;S(e),E({job_phase_changes:!0,work_orders:!0,callbacks:!0,system_alerts:!0})}}else if(a)if(S(a),_("admin"===a.role),a.notification_settings)try{const e=JSON.parse(a.notification_settings);E(e)}catch(e){E({job_phase_changes:!0,work_orders:!0,callbacks:!0,system_alerts:!0})}else E({job_phase_changes:!0,work_orders:!0,callbacks:!0,system_alerts:!0});const{data:n,error:d}=await r.from("calendar_tokens").select("token").eq("user_id",t.user.id).single();if(d&&"PGRST116"===d.code){const e=crypto.randomUUID(),{error:s}=await r.from("calendar_tokens").insert([{user_id:t.user.id,token:e,created_at:(new Date).toISOString()}]);if(s)throw s;B(e)}else n&&B(n.token)}catch(s){N(s instanceof Error?s.message:"Failed to load settings"),t.error("Failed to load settings")}finally{p(!1)}},q=e=>{S((r=>({...r,theme_preference:e})))},A=e=>{E((r=>({...r,[e]:!r[e]})))},I=e=>{const r=O[e];r&&navigator.clipboard.writeText(r).then((()=>t.success("Calendar URL copied to clipboard"))).catch((()=>t.error("Failed to copy URL")))};return y?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsx("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A] min-h-screen",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsx("div",{className:"flex items-center justify-between mb-8",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(n,{className:"h-8 w-8 text-gray-600 dark:text-gray-400"}),s.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Application Settings"})]})}),w&&s.jsx("div",{className:"mb-6 bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:w}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),k(!0),N(null);try{const{error:e}=await r.from("profiles").update({theme_preference:C.theme_preference,notification_settings:JSON.stringify(R)}).eq("id",C.id);if(e)throw e;t.success("Settings updated successfully"),("light"===C.theme_preference&&"dark"===u||"dark"===C.theme_preference&&"light"===u)&&f()}catch(s){N(s instanceof Error?s.message:"Failed to update settings"),t.error("Failed to update settings")}finally{k(!1)}},className:"space-y-6",children:[s.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"User Information"}),s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Email Address"}),s.jsx("input",{type:"email",id:"email",name:"email",value:C.email,readOnly:!0,className:"w-full h-11 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-500 dark:text-gray-400 cursor-not-allowed"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Full Name"}),s.jsx("input",{type:"text",id:"full_name",name:"full_name",value:C.full_name||"",readOnly:!0,className:"w-full h-11 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-500 dark:text-gray-400 cursor-not-allowed"}),s.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Edit your name in the Profile page"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Role"}),s.jsx("div",{className:"flex items-center",children:s.jsx("input",{type:"text",id:"role",name:"role",value:C.role,readOnly:!0,className:"w-full h-11 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-500 dark:text-gray-400 cursor-not-allowed"})}),s.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Role can only be changed by an admin"})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Theme Preferences"}),s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-4",children:"Choose Theme"}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{className:"flex flex-col items-center p-4 rounded-lg cursor-pointer border-2 "+("light"===C.theme_preference?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700"),onClick:()=>q("light"),children:[s.jsx("div",{className:"w-12 h-12 bg-white rounded-full flex items-center justify-center mb-2 shadow",children:s.jsx(d,{className:"h-6 w-6 text-yellow-500"})}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Light"})]}),s.jsxs("div",{className:"flex flex-col items-center p-4 rounded-lg cursor-pointer border-2 "+("dark"===C.theme_preference?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700"),onClick:()=>q("dark"),children:[s.jsx("div",{className:"w-12 h-12 bg-gray-900 rounded-full flex items-center justify-center mb-2 shadow",children:s.jsx(o,{className:"h-6 w-6 text-gray-300"})}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Dark"})]}),s.jsxs("div",{className:"flex flex-col items-center p-4 rounded-lg cursor-pointer border-2 "+("system"===C.theme_preference?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700"),onClick:()=>q("system"),children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-white to-gray-900 rounded-full flex items-center justify-center mb-2 shadow",children:s.jsx(i,{className:"h-6 w-6 text-blue-500"})}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"System"})]})]})]})})]}),s.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx(c,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Notification Settings"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Job Phase Changes"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Receive notifications when a job changes phase"})]}),s.jsx("div",{className:"w-12 h-6 rounded-full flex items-center p-1 cursor-pointer transition-colors "+(R.job_phase_changes?"bg-blue-600":"bg-gray-300 dark:bg-gray-700"),onClick:()=>A("job_phase_changes"),children:s.jsx("div",{className:"w-4 h-4 rounded-full bg-white transform transition-transform "+(R.job_phase_changes?"translate-x-6":"translate-x-0")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Work Order Updates"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Receive notifications about work order updates"})]}),s.jsx("div",{className:"w-12 h-6 rounded-full flex items-center p-1 cursor-pointer transition-colors "+(R.work_orders?"bg-blue-600":"bg-gray-300 dark:bg-gray-700"),onClick:()=>A("work_orders"),children:s.jsx("div",{className:"w-4 h-4 rounded-full bg-white transform transition-transform "+(R.work_orders?"translate-x-6":"translate-x-0")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Callbacks"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Receive notifications about property callbacks"})]}),s.jsx("div",{className:"w-12 h-6 rounded-full flex items-center p-1 cursor-pointer transition-colors "+(R.callbacks?"bg-blue-600":"bg-gray-300 dark:bg-gray-700"),onClick:()=>A("callbacks"),children:s.jsx("div",{className:"w-4 h-4 rounded-full bg-white transform transition-transform "+(R.callbacks?"translate-x-6":"translate-x-0")})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"System Alerts"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Receive important system notifications and alerts"})]}),s.jsx("div",{className:"w-12 h-6 rounded-full flex items-center p-1 cursor-pointer transition-colors "+(R.system_alerts?"bg-blue-600":"bg-gray-300 dark:bg-gray-700"),onClick:()=>A("system_alerts"),children:s.jsx("div",{className:"w-4 h-4 rounded-full bg-white transform transition-transform "+(R.system_alerts?"translate-x-6":"translate-x-0")})})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Calendar Sync"}),s.jsx("button",{type:"button",onClick:async()=>{try{p(!0);const{data:e,error:s}=await r.auth.getUser();if(s)throw s;if(!e.user)throw new Error("User not found");const a=crypto.randomUUID(),{error:l}=await r.from("calendar_tokens").upsert({user_id:e.user.id,token:a,created_at:(new Date).toISOString()});if(l)throw l;B(a);const n=window.location.origin;U({jobRequests:`${n}/functions/v1/calendar-feed/job-requests?token=${encodeURIComponent(a)}`,workOrders:`${n}/functions/v1/calendar-feed/work-orders?token=${encodeURIComponent(a)}`,allJobs:`${n}/functions/v1/calendar-feed/all-jobs?token=${encodeURIComponent(a)}`}),t.success("Calendar token regenerated successfully")}catch(e){t.error("Failed to regenerate calendar token")}finally{p(!1)}},className:"px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:"Regenerate Token"})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"All Upcoming Job Requests"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"text",value:O.jobRequests,readOnly:!0,className:"flex-1 h-11 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-[#2D3B4E] rounded-l-lg text-gray-500 dark:text-gray-400 cursor-not-allowed"}),s.jsx("button",{type:"button",onClick:()=>I("jobRequests"),className:"h-11 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-r-lg transition-colors",children:s.jsx(m,{className:"h-5 w-5"})})]}),s.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"Sync all upcoming job requests to your calendar"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"All Work Orders"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"text",value:O.workOrders,readOnly:!0,className:"flex-1 h-11 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-[#2D3B4E] rounded-l-lg text-gray-500 dark:text-gray-400 cursor-not-allowed"}),s.jsx("button",{type:"button",onClick:()=>I("workOrders"),className:"h-11 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-r-lg transition-colors",children:s.jsx(m,{className:"h-5 w-5"})})]}),s.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"Sync all work orders to your calendar"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"All Jobs"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"text",value:O.allJobs,readOnly:!0,className:"flex-1 h-11 px-4 bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-[#2D3B4E] rounded-l-lg text-gray-500 dark:text-gray-400 cursor-not-allowed"}),s.jsx("button",{type:"button",onClick:()=>I("allJobs"),className:"h-11 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-r-lg transition-colors",children:s.jsx(m,{className:"h-5 w-5"})})]}),s.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:"Sync all jobs (both requests and work orders) to your calendar"})]}),s.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/30 rounded-lg",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(x,{className:"h-5 w-5 text-blue-500 mr-2 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"How to Add to Your Calendar"}),s.jsxs("div",{className:"mt-2 space-y-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Google Calendar"}),s.jsxs("ol",{className:"mt-1 text-sm text-blue-700 dark:text-blue-300 list-decimal pl-5 space-y-1",children:[s.jsx("li",{children:"Open Google Calendar"}),s.jsx("li",{children:'Click the + next to "Other calendars"'}),s.jsx("li",{children:'Select "From URL"'}),s.jsx("li",{children:"Paste the calendar URL"}),s.jsx("li",{children:'Click "Add calendar"'})]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Apple Calendar"}),s.jsxs("ol",{className:"mt-1 text-sm text-blue-700 dark:text-blue-300 list-decimal pl-5 space-y-1",children:[s.jsx("li",{children:"Open Calendar app"}),s.jsx("li",{children:"Go to File â†’ New Calendar Subscription"}),s.jsx("li",{children:"Paste the calendar URL"}),s.jsx("li",{children:'Click "Subscribe"'}),s.jsx("li",{children:'Choose your preferences and click "OK"'})]})]})]}),s.jsx("div",{className:"mt-4 p-3 bg-blue-100 dark:bg-blue-800/30 rounded",children:s.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[s.jsx("strong",{children:"Note:"}),' Your calendar links are permanent and will continue to work. If you need to revoke access, click the "Regenerate Token" button above.']})})]})]})})]})]}),v&&s.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow border-l-4 border-purple-500",children:[s.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6 flex items-center",children:[s.jsx(h,{className:"h-5 w-5 mr-2 text-purple-500"}),"Admin Settings"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"As an administrator, you have access to additional settings and user management features."}),s.jsxs("div",{className:"flex space-x-4",children:[s.jsx("button",{type:"button",onClick:()=>g("/dashboard/users"),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Manage Users"}),s.jsx("button",{type:"button",onClick:()=>g("/dashboard/settings/roles"),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Manage Roles"})]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>g("/dashboard"),className:"px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#2D3B4E] rounded-lg hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:j,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center",children:j?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Saving..."]}):s.jsxs(s.Fragment,{children:[s.jsx(b,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]})]})]})})}export{g as AppSettings};
