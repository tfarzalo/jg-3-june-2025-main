import{s as e,j as t}from"./index-nRXVoRx_.js";import{r as a}from"./react-vendor--AdGielI.js";import{N as r,p as s}from"./ui-a3QeRpHh.js";function i({workOrderId:i,folder:l,allowDelete:o=!1}){const[c,d]=a.useState([]),[n,m]=a.useState(!0),[f,h]=a.useState(null),[u,p]=a.useState(!1),[g,x]=a.useState(null);a.useEffect((()=>{y()}),[i,l]);const y=async()=>{try{m(!0),h(null);const t={before:"Before Images",sprinkler:"Sprinkler Images",other:"Other Files"}[l],{data:a,error:r}=await e.from("files").select("id").eq("name",t).eq("folder_id",i).eq("type","folder/directory").maybeSingle();if(r)throw r;if(!a||!a.id)return d([]),void m(!1);const{data:s,error:o}=await e.from("files").select("*").eq("folder_id",a.id).eq("category",l).order("created_at",{ascending:!1});if(o)throw o;d((s||[]).map((e=>({id:e.id,file_path:e.path,file_name:e.name,file_type:e.type,file_size:e.size,created_at:e.created_at}))))}catch(t){h(t instanceof Error?t.message:"Failed to fetch files")}finally{m(!1)}},j=t=>{const{data:a}=e.storage.from("files").getPublicUrl(t);return a.publicUrl};return n?t.jsx("div",{className:"flex items-center justify-center h-32",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):f?t.jsx("div",{className:"text-red-600 dark:text-red-400 text-sm",children:f}):0===c.length?t.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"No images uploaded yet"}):t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:c.map((a=>t.jsxs("div",{className:"relative group",children:[t.jsx("button",{onClick:()=>{return e={src:j(a.file_path),alt:a.file_name},x(e),void p(!0);var e},className:"w-full aspect-square rounded-lg overflow-hidden hover:opacity-90 transition-opacity",children:t.jsx("img",{src:j(a.file_path),alt:a.file_name,className:"w-full h-full object-cover"})}),o&&t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-opacity flex items-center justify-center",children:t.jsx("button",{onClick:t=>{t.stopPropagation(),(async(t,a)=>{try{const{error:r}=await e.storage.from("files").remove([a]);if(r)throw r;const{error:s}=await e.from("files").delete().eq("id",t);if(s)throw s;y()}catch(r){h(r instanceof Error?r.message:"Failed to delete file")}})(a.id,a.file_path)},className:"p-2 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600",children:t.jsx(r,{className:"h-4 w-4"})})})]},a.id)))}),u&&g&&t.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center",children:[t.jsx("button",{onClick:()=>p(!1),className:"absolute top-4 right-4 text-white hover:text-gray-300",children:t.jsx(s,{className:"h-6 w-6"})}),t.jsx("div",{className:"max-w-7xl max-h-[90vh] p-4",children:t.jsx("img",{src:g.src,alt:g.alt,className:"max-w-full max-h-[90vh] object-contain"})})]})]})}export{i as I};
