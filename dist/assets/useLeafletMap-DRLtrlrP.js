import{r}from"./react-vendor-BmeRVKJv.js";import{L as e}from"./leaflet-D5r8Lo0S.js";import{a as t}from"./index-trbIQK5H.js";function n({address:n}){const o=r.useRef(null),a=r.useRef(null),c=r.useRef(null),s=r.useRef(null),[u,i]=r.useState(null),[l,m]=r.useState(!1),{theme:p}=t();r.useEffect((()=>{const r=o.current;if(r&&n)return s.current&&window.clearTimeout(s.current),s.current=window.setTimeout((()=>{l?f(n):d(r,n)}),100),()=>{s.current&&window.clearTimeout(s.current)}}),[n,l]);const d=async(r,t)=>{try{a.current&&(a.current.remove(),a.current=null);const n=e.map(r,{center:[35.2271,-80.8431],zoom:13,zoomControl:!1});e.control.zoom({position:"topright"}).addTo(n);e.tileLayer("dark"===p?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);a.current=n;const o=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}`),s=await o.json();if(!(s&&s.length>0))throw new Error("Address not found");{const{lat:r,lon:t}=s[0];a.current&&(a.current.setView([r,t],15),c.current&&c.current.remove(),c.current=e.marker([r,t]).addTo(a.current))}m(!0),i(null)}catch(n){i(n instanceof Error?n.message:"Failed to initialize map")}},f=async r=>{if(a.current)try{const t=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r)}`),n=await t.json();if(!(n&&n.length>0))throw new Error("Address not found");{const{lat:r,lon:t}=n[0];a.current&&(a.current.setView([r,t],15),c.current&&c.current.remove(),c.current=e.marker([r,t]).addTo(a.current))}i(null)}catch(t){i(t instanceof Error?t.message:"Failed to update map location")}};return r.useEffect((()=>{a.current&&a.current.eachLayer((r=>{r instanceof e.TileLayer&&r.setUrl("dark"===p?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")}))}),[p]),r.useEffect((()=>()=>{a.current&&(a.current.remove(),a.current=null),s.current&&window.clearTimeout(s.current)}),[]),{mapRef:o,error:u}}export{n as u};
