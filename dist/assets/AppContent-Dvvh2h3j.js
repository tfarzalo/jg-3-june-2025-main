const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Auth-Cvi4W2-8.js","assets/index-nRXVoRx_.js","assets/react-vendor--AdGielI.js","assets/supabase-Dq0wjmmz.js","assets/index-Bb5O2NJ5.css","assets/Dashboard-DrBzAgQV.js","assets/ui-a3QeRpHh.js","assets/utils-DsqaXd9R.js","assets/SubcontractorDashboard-DPOKy6KW.js","assets/NewWorkOrder-x0yinFaI.js","assets/dateUtils-BelUzJwD.js","assets/ImageGallery-Daqwq708.js","assets/ApprovalPage-BQGhgII5.js"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-Dq0wjmmz.js";import{u as t,s as a,a as r,j as s,b as l}from"./index-nRXVoRx_.js";import{r as i,u as n,N as o,L as d,R as c,i as m,j as x,h as u}from"./react-vendor--AdGielI.js";import{C as b,a as h,b as g,c as p,L as y,d as f,U as j,S as k,e as w,F as N,D as v,f as _,X as E,A as S,g as T,B as A,h as C,i as D,j as L,k as P,l as R,m as B,n as I,o as O,p as F,q as M,r as $,M as z,H as U,T as G,s as J,P as q,t as V,u as W,v as Y,w as H}from"./ui-a3QeRpHh.js";import{s as K,f as X,p as Q}from"./utils-DsqaXd9R.js";function Z(){const{initialized:e}=t(),[r,s]=i.useState({role:null,permissions:[],loading:!0,error:null}),l=i.useCallback((async()=>{if(e)try{const{data:{session:e}}=await a.auth.getSession();if(!e)return void s((e=>({...e,role:null,permissions:[],error:null,loading:!1})));const{data:t,error:r}=await a.from("profiles").select("role").eq("id",e.user.id).single();if(r)throw r;s((e=>({...e,role:t?.role||null,permissions:[],error:null,loading:!1})))}catch(t){s((e=>({...e,role:null,permissions:[],error:t instanceof Error?t.message:"Failed to fetch role",loading:!1})))}}),[e]);return i.useEffect((()=>{let t=!0,r=null;if((async()=>{e?(r=setTimeout((()=>{t&&s((e=>({...e,loading:!1,error:null})))}),5e3),await new Promise((e=>setTimeout(e,100))),t&&(await l(),r&&(clearTimeout(r),r=null))):s((e=>({...e,loading:!0,error:null})))})(),e){const{data:{subscription:e}}=a.auth.onAuthStateChange((async e=>{t&&("SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await l():"SIGNED_OUT"===e&&s((e=>({...e,role:null,permissions:[],error:null,loading:!1}))))}));return()=>{t=!1,r&&clearTimeout(r),e.unsubscribe()}}return()=>{t=!1,r&&clearTimeout(r)}}),[l,e]),{...r,isAdmin:"admin"===r.role,isJGManagement:"jg_management"===r.role,isSubcontractor:"subcontractor"===r.role}}function ee(){const e=n(),{theme:t}=r(),{isSubcontractor:d}=Z(),[c,m]=i.useState(!1),[x,u]=i.useState(!1),[B,I]=i.useState({DASHBOARD:!0,"JOB MANAGEMENT":!0,PROPERTIES:!0,"FILE MANAGEMENT":!0,"JG USERS":!0,CALENDAR:!0,ACTIVITY:!0,SETTINGS:!0}),O=d?[{title:"DASHBOARD",items:[{icon:f,label:"Dashboard",to:"/dashboard/subcontractor"}]},{title:"SETTINGS",items:[{icon:j,label:"Profile",to:"/dashboard/profile"},{icon:k,label:"Settings",to:"/dashboard/settings"}]}]:[{title:"DASHBOARD",items:[{icon:f,label:"Dashboard",to:"/dashboard",dataTutorial:"dashboard"}]},{title:"JOB MANAGEMENT",items:[{icon:w,label:"All Jobs",to:"/dashboard/jobs",dataTutorial:"jobs"},{icon:N,label:"Job Requests",to:"/dashboard/jobs/requests"},{icon:N,label:"Work Orders",to:"/dashboard/jobs/work-orders"},{icon:v,label:"Invoicing",to:"/dashboard/jobs/invoicing"},{icon:_,label:"Completed",to:"/dashboard/jobs/completed"},{icon:E,label:"Cancelled",to:"/dashboard/jobs/cancelled"},{icon:S,label:"Archives",to:"/dashboard/jobs/archives"},{icon:T,label:"Sub Scheduler",to:"/dashboard/sub-scheduler"}]},{title:"PROPERTIES",items:[{icon:A,label:"Properties",to:"/dashboard/properties",dataTutorial:"properties"},{icon:A,label:"Property Groups",to:"/dashboard/property-groups"}]},{title:"FILE MANAGEMENT",items:[{icon:C,label:"Files",to:"/dashboard/files",dataTutorial:"files"},{icon:D,label:"Upload File",to:"/dashboard/files/upload"}]},{title:"JG USERS",items:[{icon:L,label:"Users",to:"/dashboard/users",dataTutorial:"users"}]},{title:"CALENDAR",items:[{icon:P,label:"Calendar",to:"/dashboard/calendar",dataTutorial:"calendar"}]},{title:"ACTIVITY",items:[{icon:R,label:"Activity Log",to:"/dashboard/activity",dataTutorial:"activity"}]},{title:"SETTINGS",items:[{icon:j,label:"Profile",to:"/dashboard/profile"},{icon:k,label:"Settings",to:"/dashboard/settings",dataTutorial:"settings"}]}];return s.jsxs("div",{className:(c?"w-20":"w-64")+" bg-white dark:bg-[#0F172A] border-r border-gray-200 dark:border-[#1E293B] flex flex-col transition-all duration-300",children:[s.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-gray-200 dark:border-[#1E293B]",children:[c?s.jsx("img",{src:"https://tbwtfimnbmvbgesidbxh.supabase.co/storage/v1/object/public/files/fb38963b-c67e-4924-860b-312045d19d2f/1750132407578_jg-logo-icon.png",alt:"JG Painting",className:"h-8 w-auto"}):s.jsx("img",{src:"https://tbwtfimnbmvbgesidbxh.supabase.co/storage/v1/object/public/files/fb38963b-c67e-4924-860b-312045d19d2f/1750132407578_jg-logo-icon.png",alt:"JG Painting",className:"h-12 w-auto"}),s.jsx("button",{onClick:()=>m(!c),className:"p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-[#1E293B] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-white ml-2",children:c?s.jsx(b,{className:"h-5 w-5"}):s.jsx(h,{className:"h-5 w-5"})})]}),s.jsx("nav",{className:"flex-1 overflow-y-auto px-3 py-2",children:O.map((e=>s.jsxs("div",{className:"mb-2",children:[!c&&s.jsxs("button",{onClick:()=>{return t=e.title,void I((e=>({...e,[t]:!e[t]})));var t},className:"w-full px-3 py-2 flex items-center justify-between text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-900 dark:hover:text-white",children:[s.jsx("span",{children:e.title}),B[e.title]?s.jsx(g,{className:"h-4 w-4"}):s.jsx(p,{className:"h-4 w-4"})]}),(!c&&B[e.title]||c)&&s.jsx("div",{className:"mt-1 space-y-1",children:e.items.map((e=>s.jsxs(o,{to:e.to,className:({isActive:e})=>"flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors "+(e?"bg-blue-50 text-blue-700 dark:bg-blue-600 dark:text-white":"text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-[#1E293B] hover:text-gray-900 dark:hover:text-white"),title:c?e.label:void 0,"data-tutorial":e.dataTutorial,children:[s.jsx(e.icon,{className:""+(c?"h-6 w-6":"h-5 w-5 mr-3")}),!c&&e.label]},e.to)))})]},e.title)))}),s.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-[#1E293B]",children:[s.jsxs("button",{onClick:async()=>{if(!x){u(!0);try{if(!navigator.onLine)return l.error("You appear to be offline. Please check your internet connection and try again."),void u(!1);const{error:t}=await a.auth.signOut();t?l.error("Error signing out. Please try again."):e("/auth")}catch(t){l.error("Error during logout. Please try again."),e("/auth")}finally{u(!1)}}},disabled:x,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white w-full rounded-lg hover:bg-gray-100 dark:hover:bg-[#1E293B] disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(y,{className:""+(c?"h-6 w-6":"h-5 w-5 mr-3")}),!c&&(x?"Logging out...":"Logout")]}),!c&&s.jsx("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-600",children:"Copyright 2025 JG Portal V2.0"})]})]})}function te(e,t){let a=null;return function(...r){null!==a&&clearTimeout(a),a=setTimeout((()=>{a=null,e(...r)}),t)}}function ae({isOpen:e,onClose:t}){const[r,l]=i.useState(""),[n,o]=i.useState([]),[c,m]=i.useState(!1),[x,u]=i.useState(!1),[b,h]=i.useState({types:{jobs:!0,properties:!0,files:!0,users:!0},dateRange:"all"}),p=i.useRef(null),y=i.useRef(null),f=i.useRef(!0);i.useEffect((()=>{e&&p.current&&setTimeout((()=>{p.current?.focus()}),100)}),[e]),i.useEffect((()=>{const a=e=>{"Escape"===e.key&&t()};return e&&document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}}),[e,t]),i.useEffect((()=>{const a=e=>{y.current&&!y.current.contains(e.target)&&t()};return e&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}}),[e,t]),i.useEffect((()=>()=>{f.current=!1}),[]);const j=e=>`WO-${String(e).padStart(6,"0")}`,k=i.useCallback(te((async(e,t)=>{if(!e.trim()||!f.current)return o([]),void m(!1);m(!0);const r=[];try{const l=(()=>{switch(t.dateRange){case"today":return(new Date).toISOString().split("T")[0];case"week":return K(new Date,7).toISOString();case"month":return K(new Date,30).toISOString();case"year":return K(new Date,365).toISOString();default:return null}})();let i=!1,n=null;const d=/^(?:WO[-\s]?)?(\d+)$/i,c=e.match(d);if(c&&c[1]&&(i=!0,n=parseInt(c[1],10)),t.types.jobs){let t=a.from("jobs").select("\n              id,\n              work_order_num,\n              unit_number,\n              description,\n              scheduled_date,\n              created_at,\n              property:properties (\n                property_name\n              ),\n              job_phase:current_phase_id (\n                job_phase_label,\n                color_dark_mode\n              ),\n              job_type:job_types (\n                job_type_label\n              )\n            ");t=i&&n?t.eq("work_order_num",n):t.or(`unit_number.ilike.%${e}%,description.ilike.%${e}%,work_order_num::text.ilike.%${e}%`),l&&(t=t.gte("created_at",l));const{data:o,error:d}=await t;d||o&&o.forEach((e=>{const t=j(e.work_order_num);r.push({id:e.id,type:"job",title:`${t} - Unit ${e.unit_number}`,subtitle:e.property?.property_name||"Unknown Property",description:e.description||"",date:X(Q(e.created_at),"MMM d, yyyy"),tags:[e.job_phase?.job_phase_label||"Unknown Phase",e.job_type?.job_type_label||"Unknown Type"],url:`/dashboard/jobs/${e.id}`,icon:s.jsx(N,{className:"h-5 w-5 text-blue-500"})})}))}if(t.types.properties){let t=a.from("properties").select("\n              id,\n              property_name,\n              address,\n              city,\n              state,\n              zip,\n              created_at,\n              property_management_group:property_management_groups (\n                company_name\n              )\n            ").or(`property_name.ilike.%${e}%,address.ilike.%${e}%,city.ilike.%${e}%`);l&&(t=t.gte("created_at",l));const{data:i,error:n}=await t;n||i&&i.forEach((e=>{const t=[e.address,e.city,e.state,e.zip].filter(Boolean).join(", ");r.push({id:e.id,type:"property",title:e.property_name,subtitle:t,description:e.property_management_group?.company_name||"No Management Group",date:e.created_at?X(Q(e.created_at),"MMM d, yyyy"):"",url:`/dashboard/properties/${e.id}`,icon:s.jsx(A,{className:"h-5 w-5 text-green-500"})})}))}if(t.types.files){let t=a.from("files").select("\n              id,\n              name,\n              path,\n              type,\n              size,\n              created_at,\n              property:properties (\n                property_name\n              ),\n              job:jobs (\n                work_order_num,\n                unit_number\n              )\n            ").not("type","eq","folder/directory").ilike("name",`%${e}%`);l&&(t=t.gte("created_at",l));const{data:i,error:n}=await t;n||i&&i.forEach((e=>{let t="General File";e.property?t=`Property: ${e.property.property_name}`:e.job&&(t=`Job: ${j(e.job.work_order_num)} - Unit ${e.job.unit_number}`),r.push({id:e.id,type:"file",title:e.name,subtitle:t,description:`${(e.size/1024).toFixed(2)} KB - ${e.type}`,date:X(Q(e.created_at),"MMM d, yyyy"),url:"/dashboard/files",icon:s.jsx(N,{className:"h-5 w-5 text-yellow-500"})})}))}if(t.types.users){let t=a.from("profiles").select("\n              id,\n              email,\n              full_name,\n              role,\n              created_at\n            ").or(`email.ilike.%${e}%,full_name.ilike.%${e}%`);l&&(t=t.gte("created_at",l));const{data:i,error:n}=await t;n||i&&i.forEach((e=>{r.push({id:e.id,type:"user",title:e.full_name||"Unnamed User",subtitle:e.email,description:`Role: ${e.role}`,date:X(Q(e.created_at),"MMM d, yyyy"),tags:[e.role],url:"/dashboard/users",icon:s.jsx(M,{className:"h-5 w-5 text-purple-500"})})}))}f.current&&o(r)}catch(l){}finally{f.current&&m(!1)}}),300),[]);i.useEffect((()=>{r?k(r,b):o([])}),[r,b,k]);const w=e=>{h((t=>({...t,types:{...t.types,[e]:!t.types[e]}})))},v=e=>{h((t=>({...t,dateRange:e})))};return e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-center pt-20",children:s.jsxs("div",{ref:y,className:"bg-white dark:bg-[#1E293B] rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col overflow-hidden",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-[#2D3B4E]",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),s.jsx("input",{ref:p,type:"text",placeholder:"Search by work order #, job details, properties, files, users...",value:r,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("button",{onClick:()=>u(!x),className:"ml-3 px-4 py-3 bg-gray-100 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-[#2D3B4E] transition-colors flex items-center",children:[s.jsx(I,{className:"h-5 w-5 mr-2"}),"Filters",x?s.jsx(O,{className:"h-4 w-4 ml-2"}):s.jsx(g,{className:"h-4 w-4 ml-2"})]}),s.jsx("button",{onClick:t,className:"ml-3 p-3 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-lg transition-colors",children:s.jsx(F,{className:"h-5 w-5"})})]}),x&&s.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search In"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("button",{onClick:()=>w("jobs"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+(b.types.jobs?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx(N,{className:"h-4 w-4 mr-1.5"}),"Jobs",b.types.jobs?s.jsx(_,{className:"h-4 w-4 ml-1.5"}):s.jsx(E,{className:"h-4 w-4 ml-1.5"})]}),s.jsxs("button",{onClick:()=>w("properties"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+(b.types.properties?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx(A,{className:"h-4 w-4 mr-1.5"}),"Properties",b.types.properties?s.jsx(_,{className:"h-4 w-4 ml-1.5"}):s.jsx(E,{className:"h-4 w-4 ml-1.5"})]}),s.jsxs("button",{onClick:()=>w("files"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+(b.types.files?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx(N,{className:"h-4 w-4 mr-1.5"}),"Files",b.types.files?s.jsx(_,{className:"h-4 w-4 ml-1.5"}):s.jsx(E,{className:"h-4 w-4 ml-1.5"})]}),s.jsxs("button",{onClick:()=>w("users"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+(b.types.users?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx(M,{className:"h-4 w-4 mr-1.5"}),"Users",b.types.users?s.jsx(_,{className:"h-4 w-4 ml-1.5"}):s.jsx(E,{className:"h-4 w-4 ml-1.5"})]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs("button",{onClick:()=>v("all"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+("all"===b.dateRange?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx($,{className:"h-4 w-4 mr-1.5"}),"All Time"]}),s.jsxs("button",{onClick:()=>v("today"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+("today"===b.dateRange?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx($,{className:"h-4 w-4 mr-1.5"}),"Today"]}),s.jsxs("button",{onClick:()=>v("week"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+("week"===b.dateRange?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx($,{className:"h-4 w-4 mr-1.5"}),"Last 7 Days"]}),s.jsxs("button",{onClick:()=>v("month"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+("month"===b.dateRange?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx(P,{className:"h-4 w-4 mr-1.5"}),"Last 30 Days"]}),s.jsxs("button",{onClick:()=>v("year"),className:"px-3 py-1.5 rounded-full text-sm flex items-center "+("year"===b.dateRange?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:[s.jsx(P,{className:"h-4 w-4 mr-1.5"}),"Last Year"]})]})]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r&&0===n.length?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(B,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No results found"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Try adjusting your search or filters"}),s.jsxs("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:[s.jsx("p",{children:"Search tips:"}),s.jsxs("ul",{className:"list-disc list-inside mt-2",children:[s.jsx("li",{children:'Try searching for a work order number (e.g., "WO-123456" or just "123456")'}),s.jsx("li",{children:"Search by property name or address"}),s.jsx("li",{children:"Search by unit number"}),s.jsx("li",{children:"Try using fewer or different keywords"})]})]})]}):r?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Found ",n.length,' results for "',r,'"']}),["job","property","file","user"].map((e=>{const a=n.filter((t=>t.type===e));return 0===a.length?null:s.jsxs("div",{className:"mb-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center",children:["job"===e&&s.jsx(N,{className:"h-5 w-5 mr-2 text-blue-500"}),"property"===e&&s.jsx(A,{className:"h-5 w-5 mr-2 text-green-500"}),"file"===e&&s.jsx(N,{className:"h-5 w-5 mr-2 text-yellow-500"}),"user"===e&&s.jsx(M,{className:"h-5 w-5 mr-2 text-purple-500"}),e.charAt(0).toUpperCase()+e.slice(1),"s (",a.length,")"]}),s.jsx("div",{className:"space-y-2",children:a.map((e=>s.jsx(d,{to:e.url,onClick:t,className:"block p-4 bg-white dark:bg-[#0F172A] rounded-lg border border-gray-200 dark:border-[#2D3B4E] hover:bg-gray-50 dark:hover:bg-[#1E293B] transition-colors",children:s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0 mr-4",children:e.icon}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"text-base font-medium text-gray-900 dark:text-white truncate",children:e.title}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 flex items-center",children:["property"===e.type&&s.jsx(z,{className:"h-3.5 w-3.5 mr-1 text-gray-400"}),"job"===e.type&&s.jsx(U,{className:"h-3.5 w-3.5 mr-1 text-gray-400"}),e.subtitle]}),e.description&&s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1 truncate",children:e.description}),s.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[s.jsx("div",{className:"flex items-center",children:e.tags&&e.tags.length>0&&s.jsxs("div",{className:"flex items-center mr-4",children:[s.jsx(G,{className:"h-3.5 w-3.5 mr-1 text-gray-400"}),s.jsx("div",{className:"flex space-x-1",children:e.tags.map(((e,t)=>s.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 rounded",children:e},t)))})]})}),e.date&&s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500 flex items-center",children:[s.jsx($,{className:"h-3 w-3 mr-1"}),e.date]})]})]})]})},`${e.type}-${e.id}`)))})]},e)}))]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(B,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Search the entire application"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Find jobs, properties, files, users and more"}),s.jsxs("div",{className:"max-w-md mx-auto text-left bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg border border-gray-200 dark:border-[#2D3B4E]",children:[s.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search tips:"}),s.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[s.jsxs("li",{className:"flex items-center",children:[s.jsx(U,{className:"h-3.5 w-3.5 mr-2 text-blue-500"}),'Search for work orders by number (e.g., "WO-123456" or just "123456")']}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(A,{className:"h-3.5 w-3.5 mr-2 text-green-500"}),"Find properties by name or address"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(N,{className:"h-3.5 w-3.5 mr-2 text-yellow-500"}),"Locate files by filename"]}),s.jsxs("li",{className:"flex items-center",children:[s.jsx(M,{className:"h-3.5 w-3.5 mr-2 text-purple-500"}),"Find users by name or email"]})]})]})]})}),s.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-[#2D3B4E] bg-gray-50 dark:bg-[#0F172A]",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Press ",s.jsx("kbd",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-gray-800 dark:text-gray-200 font-mono text-xs",children:"ESC"})," to close"]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Search powered by Supabase"}),s.jsx(J,{className:"h-4 w-4 text-gray-400"})]})]})})]})}):null}const re=c.memo((({children:e,variant:t="primary",size:a="md",icon:r,loading:l,fullWidth:i,className:n="",disabled:o,...d})=>{const c=["inline-flex items-center justify-center font-medium rounded-lg transition-colors",{primary:"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-blue-400 dark:bg-blue-600 dark:hover:bg-blue-700 dark:text-white dark:disabled:bg-blue-800",secondary:"bg-gray-200 hover:bg-gray-300 text-gray-800 disabled:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200 dark:disabled:bg-gray-800",danger:"bg-red-600 hover:bg-red-700 text-white disabled:bg-red-400 dark:bg-red-600 dark:hover:bg-red-700 dark:text-white dark:disabled:bg-red-800",ghost:"hover:bg-gray-100 text-gray-700 dark:text-gray-300 dark:hover:bg-gray-800"}[t],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg"}[a],i&&"w-full",o&&"opacity-50 cursor-not-allowed",n].filter(Boolean).join(" ");return s.jsx("button",{className:c,disabled:o||l,...d,children:l?s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):s.jsxs(s.Fragment,{children:[r&&s.jsx(r,{className:"h-4 w-4 "+(e?"mr-2":"")}),e]})})}));re.displayName="Button";const se=i.memo((function({showOnlyProfile:e=!1}){const{theme:o,toggleTheme:m}=r(),{session:x,signOut:u}=t(),{role:b}=Z(),h=n(),[g,p]=i.useState(!1),[f,j]=i.useState(!1),[w,N]=i.useState(!1),[v,E]=i.useState(null),[S,T]=i.useState([]),[A,C]=i.useState(0),D=i.useRef(null),L=i.useRef(null),R="subcontractor"===b;i.useEffect((()=>{(async()=>{if(x?.user.id){const{data:e,error:t}=await a.from("profiles").select("*").eq("id",x.user.id).single();t||E(e)}})()}),[x?.user.id]),c.useEffect((()=>{const e=e=>{D.current&&!D.current.contains(e.target)&&p(!1),L.current&&!L.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]),i.useEffect((()=>{if(x?.user.id&&!R){I();const e=a.channel("notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"user_notifications",filter:`user_id=eq.${x.user.id}`},(e=>{const t=e.new;T((e=>[t,...e])),C((e=>e+1)),l.info(t.message)})).subscribe();return()=>{a.removeChannel(e)}}}),[x?.user.id,R]);const I=async()=>{if(!x?.user.id)return;const{data:e,error:t}=await a.from("user_notifications").select("*").eq("user_id",x.user.id).order("created_at",{ascending:!1}).limit(10);t||(T(e||[]),C(e?.filter((e=>!e.is_read)).length||0))},O=async e=>{const{error:t}=await a.from("user_notifications").update({is_read:!0}).eq("id",e);t||(T((t=>t.map((t=>t.id===e?{...t,is_read:!0}:t)))),C((e=>Math.max(0,e-1))))};return i.useEffect((()=>{const e=e=>{"/"!==e.key||["INPUT","TEXTAREA"].includes(document.activeElement?.tagName||"")||(e.preventDefault(),N(!0)),"Escape"===e.key&&w&&N(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[w]),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"h-16 bg-white dark:bg-[#0F172A] border-b border-gray-200 dark:border-[#1E293B] px-6 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[R&&s.jsx("div",{className:"flex items-center",children:s.jsx("img",{src:"https://tbwtfimnbmvbgesidbxh.supabase.co/storage/v1/object/public/files/fb38963b-c67e-4924-860b-312045d19d2f/1750132407578_jg-logo-icon.png",alt:"JG Painting",className:"h-8 w-auto"})}),!R&&!e&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>N(!0),className:"relative w-10 h-10 flex items-center justify-center rounded-full bg-gray-100 dark:bg-[#1E293B] text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-[#2D3B4E] transition-colors","aria-label":"Search",children:s.jsx(B,{className:"h-5 w-5"})}),s.jsxs("button",{onClick:()=>h("/dashboard/sub-scheduler"),className:"bg-[#7C3AED] hover:bg-[#6D28D9] text-white px-4 py-2 rounded-lg flex items-center transition-colors",children:[s.jsx(P,{className:"h-4 w-4 mr-2"}),"Schedule"]}),s.jsxs("button",{onClick:()=>h("/dashboard/jobs/new"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors",children:[s.jsx(q,{className:"h-4 w-4 mr-2"}),"New Job"]}),s.jsxs("button",{onClick:()=>h("/dashboard/properties/new"),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors",children:[s.jsx(q,{className:"h-4 w-4 mr-2"}),"New Property"]})]})]}),s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsx(re,{variant:"ghost",size:"sm",onClick:m,className:"text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white",children:"dark"===o?s.jsx(V,{className:"h-5 w-5"}):s.jsx(W,{className:"h-5 w-5"})}),!R&&!e&&s.jsxs("div",{className:"relative",ref:L,children:[s.jsxs("button",{onClick:()=>j(!f),className:"relative text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-white transition-colors","aria-label":"Notifications",children:[s.jsx(Y,{className:"h-5 w-5"}),A>0&&s.jsx("span",{className:"absolute -top-1 -right-1 h-4 w-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:A})]}),f&&s.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-[#1E293B] rounded-lg shadow-lg z-50 overflow-hidden",children:[s.jsx("div",{className:"px-4 py-2 border-b border-gray-200 dark:border-[#2D3B4E]",children:s.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Notifications"})}),s.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===S.length?s.jsx("div",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400 text-center",children:"No notifications"}):S.map((e=>s.jsx("div",{className:"relative px-4 py-3 hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors "+(e.is_read?"opacity-60":"bg-blue-50 dark:bg-blue-900/20"),children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0 mt-1",children:"approval"===e.type||"job_phase_change"===e.type?s.jsx(_,{className:"h-5 w-5 text-blue-500"}):s.jsx(H,{className:"h-5 w-5 text-orange-500"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("button",{onClick:()=>(e=>{O(e.id),j(!1),e.reference_id&&"job"===e.reference_type&&h(`/dashboard/jobs/${e.reference_id}`)})(e),className:"text-left w-full",children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.title}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.message}),s.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:new Date(e.created_at).toLocaleString()})]}),!e.is_read&&s.jsx("div",{className:"mt-2",children:s.jsx("button",{onClick:t=>{t.stopPropagation(),O(e.id)},className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Mark as read"})})]}),s.jsx("button",{onClick:t=>{t.stopPropagation(),(async e=>{const{error:t}=await a.from("user_notifications").delete().eq("id",e);t?l.error("Failed to remove notification"):(T((t=>t.filter((t=>t.id!==e)))),C((t=>{const a=S.find((t=>t.id===e));return a&&!a.is_read?Math.max(0,t-1):t})),l.success("Notification removed"))})(e.id)},className:"flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200","aria-label":"Remove notification",children:s.jsx(F,{className:"h-4 w-4"})})]})},e.id)))})]})]}),s.jsxs("div",{className:"flex items-center space-x-4 text-gray-500 dark:text-gray-400",children:[s.jsx("span",{className:"text-sm hidden md:block",children:(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),s.jsxs("div",{className:"relative",ref:D,children:[s.jsxs("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>p(!g),children:[s.jsx("span",{className:"text-gray-900 dark:text-white text-sm hidden md:block",children:v?.full_name||x?.user.user_metadata.email?.split("@")[0]||"User"}),v?.avatar_url?s.jsx("img",{src:`https://tbwtfimnbmvbgesidbxh.supabase.co/storage/v1/object/public/avatars/${v.avatar_url}`,alt:v?.full_name||"User",className:"h-8 w-8 rounded-full object-cover"}):s.jsx("div",{className:"h-8 w-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium",children:v?.full_name?v.full_name.charAt(0).toUpperCase():x?.user.user_metadata.email?.charAt(0).toUpperCase()||"U"})]}),g&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-[#1E293B] rounded-lg shadow-lg z-50 overflow-hidden",children:[s.jsxs("div",{className:"px-4 py-2 border-b border-gray-200 dark:border-[#2D3B4E]",children:[s.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:v?.full_name||"User"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:x?.user.user_metadata.email})]}),!R&&s.jsxs(s.Fragment,{children:[s.jsxs(d,{to:"/dashboard/profile",className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-[#2D3B4E]",onClick:()=>p(!1),children:[s.jsx(M,{className:"h-4 w-4 inline-block mr-2"}),"Your Profile"]}),s.jsxs(d,{to:"/dashboard/settings",className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-[#2D3B4E]",onClick:()=>p(!1),children:[s.jsx(k,{className:"h-4 w-4 inline-block mr-2"}),"Settings"]}),s.jsx("div",{className:"border-t border-gray-200 dark:border-[#2D3B4E] my-1"})]}),s.jsxs("button",{onClick:async()=>{try{await u(),h("/auth")}catch(e){l.error("Failed to sign out")}},className:"block w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-[#2D3B4E]",children:[s.jsx(y,{className:"h-4 w-4 inline-block mr-2"}),"Sign out"]})]})]})]})]})]}),s.jsx(ae,{isOpen:w,onClose:()=>N(!1)})]})}));function le({children:e}){const[t,a]=c.useState(navigator.onLine),{isSubcontractor:r}=Z();return c.useEffect((()=>{const e=()=>a(!0),t=()=>a(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}),[]),s.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-[#0F172A]",children:[!t&&s.jsx("div",{className:"fixed top-0 left-0 right-0 bg-red-500 text-white p-2 text-center z-50",children:s.jsx("span",{children:"You are currently offline. Some features may not work properly."})}),r?s.jsxs("div",{className:"flex flex-col h-screen",children:[s.jsx(se,{showOnlyProfile:!0}),s.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 dark:bg-[#0F172A]",children:s.jsx(i.Suspense,{fallback:s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:e})})]}):s.jsxs("div",{className:"flex h-screen",children:[s.jsx(ee,{}),s.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[s.jsx(se,{}),s.jsx("main",{className:"flex-1 overflow-auto bg-gray-100 dark:bg-[#0F172A]",children:s.jsx(i.Suspense,{fallback:s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),children:e})})]})]})]})}const ie=i.lazy((()=>e((()=>import("./Auth-Cvi4W2-8.js")),__vite__mapDeps([0,1,2,3,4])))),ne=i.lazy((()=>e((()=>import("./Dashboard-DrBzAgQV.js")),__vite__mapDeps([5,3,2,1,4,6,7])))),oe=i.lazy((()=>e((()=>import("./SubcontractorDashboard-DPOKy6KW.js")),__vite__mapDeps([8,1,2,3,4,7,6])))),de=i.lazy((()=>e((()=>import("./NewWorkOrder-x0yinFaI.js")),__vite__mapDeps([9,1,2,3,4,10,7,11,6])))),ce=i.lazy((()=>e((()=>import("./ApprovalPage-BQGhgII5.js")),__vite__mapDeps([12,1,2,3,4])))),me=()=>s.jsx("div",{className:"min-h-screen bg-background dark:bg-background-dark flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})});const xe=Object.freeze(Object.defineProperty({__proto__:null,AppContent:function(){const e=n(),a=m(),{session:r,loading:l,initialized:o}=t(),{role:d,loading:c}=Z(),[b,h]=i.useState(!0),g=a.pathname.startsWith("/approval/");i.useEffect((()=>{const e=setTimeout((()=>{h(!1)}),5e3);return()=>clearTimeout(e)}),[]);const p=i.useMemo((()=>({hasSession:!!r,authLoading:l,roleLoading:c&&!!r,role:d,pathname:a.pathname,isApprovalPage:g,isInitialized:o})),[r,l,c,d,a.pathname,g,o]);return i.useEffect((()=>{const{hasSession:t,authLoading:r,roleLoading:s,role:l,isApprovalPage:i,isInitialized:n}=p;let o=null;if(i)h(!1);else if(n)return b&&n&&h(!1),n&&!r&&(t?t&&"/auth"===a.pathname&&(s?o=setTimeout((()=>{if("/auth"===window.location.pathname){e("subcontractor"===l?"/dashboard/subcontractor":"/dashboard",{replace:!0})}}),1500):e("subcontractor"===l?"/dashboard/subcontractor":"/dashboard",{replace:!0})):"/auth"!==a.pathname&&e("/auth",{replace:!0})),()=>{o&&clearTimeout(o)}}),[p,e,b,a.pathname]),!g&&(p.authLoading&&!p.isInitialized||!p.isInitialized&&b||p.hasSession&&p.roleLoading&&!p.role&&p.isInitialized)?s.jsx(me,{}):s.jsxs(x,{children:[s.jsx(u,{path:"/approval/:token",element:s.jsx(i.Suspense,{fallback:s.jsx(me,{}),children:s.jsx(ce,{})})}),s.jsx(u,{path:"/auth",element:s.jsx(i.Suspense,{fallback:s.jsx(me,{}),children:s.jsx(ie,{})})}),s.jsx(u,{path:"/dashboard/jobs/:jobId/new-work-order",element:s.jsx(i.Suspense,{fallback:s.jsx(me,{}),children:s.jsx(de,{})})}),s.jsx(u,{path:"/dashboard/*",element:s.jsx(le,{children:s.jsx(i.Suspense,{fallback:s.jsx(me,{}),children:"subcontractor"===p.role?s.jsx(oe,{}):s.jsx(ne,{})})})}),s.jsx(u,{path:"*",element:s.jsx(i.Suspense,{fallback:s.jsx(me,{}),children:s.jsx(ie,{})})})]})}},Symbol.toStringTag,{value:"Module"}));export{xe as A,te as d,Z as u};
