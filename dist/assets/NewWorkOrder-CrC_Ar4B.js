import{u as e,s as r,j as a,b as t}from"./index-trbIQK5H.js";import{r as s,u as i,k as o,i as n}from"./react-vendor-BmeRVKJv.js";import{f as l}from"./dateUtils-aI21ZMtv.js";import{I as d}from"./ImageGallery-BxEcHKme.js";import{z as c,B as m,F as h,k as g,w as u,E as p}from"./ui-CiwSAYI4.js";import"./supabase-c3qFLfUQ.js";import"./utils-C_z87yX_.js";const _=({jobId:t,workOrderId:i,folder:o,onUploadComplete:n,onError:l,readOnly:d=!1,resetTrigger:c,onImageDelete:m})=>{const[h,g]=s.useState(!1),[u,p]=s.useState(!1),[_,b]=s.useState([]),[x,f]=s.useState([]),[y,w]=s.useState(null),[j,k]=s.useState(new Set),{user:N,loading:v}=e(),E=s.useId();s.useEffect((()=>{}),[N,v,o]),s.useEffect((()=>{(async()=>{try{const{data:e,error:a}=await r.from("files").select("*").eq("job_id",t).eq("category",o).order("created_at",{ascending:!1});if(a)throw a;if(e&&e.length>0){const a=e.map((e=>{const{data:a}=r.storage.from("files").getPublicUrl(e.path);return{file_path:e.path,file_name:e.name,public_url:a.publicUrl,type:e.type}}));b(a)}else b([])}catch(e){b([])}})(),f([])}),[t,i,o,c]),s.useEffect((()=>()=>{x.forEach((e=>{URL.revokeObjectURL(e.preview)}))}),[x]);const I=s.useCallback((e=>{e.preventDefault(),e.stopPropagation(),g(!0)}),[]),C=s.useCallback((e=>{e.preventDefault(),e.stopPropagation(),g(!1)}),[]),S=s.useCallback((e=>{e.preventDefault(),e.stopPropagation()}),[]),F=s.useCallback((e=>{e.preventDefault(),e.stopPropagation(),g(!1);const r=Array.from(e.dataTransfer.files);W(r)}),[]),P=s.useCallback((e=>{if(e.target.files){const r=Array.from(e.target.files);W(r)}}),[]),U=async(e,a,t,s,i)=>{const o=a||null;let n=r.from("files").select("id").eq("name",e).eq("type","folder/directory");n=null===o?n.is("folder_id",null):n.eq("folder_id",o);const{data:l,error:d}=await n.maybeSingle();if(d)throw d;if(l&&l.id)return l.id;const{data:c,error:m}=await r.from("files").insert({name:e,path:t,type:"folder/directory",size:0,uploaded_by:N.id,property_id:i,job_id:s,folder_id:o}).select("id").single();if(m){if("23505"===m.code||m.message?.includes("duplicate key")||m.message?.includes("conflict")){let a=r.from("files").select("id").eq("name",e).eq("type","folder/directory");a=null===o?a.is("folder_id",null):a.eq("folder_id",o);const{data:t,error:s}=await a.maybeSingle();if(s||!t)throw m;return t.id}throw m}return c.id},W=async e=>{if(!e||0===e.length)return void(l&&l("No files selected"));if(!N)return void(l&&l("User not authenticated"));const a=e.map((e=>({file:e,preview:URL.createObjectURL(e),progress:0})));f(a),p(!0);try{const{data:a,error:i}=await r.from("jobs").select("work_order_num, property_id, properties!property_id (property_name)").eq("id",t).single();if(i||!a)throw new Error("Failed to fetch job data");const d=`WO-${String(a.work_order_num).padStart(6,"0")}`,c=Array.isArray(a.properties)?a.properties[0]?.property_name:a.properties?.property_name;if(!c)throw new Error("Property name not found");const m=`/${c}`,h=await U(c,null,m,null,a.property_id),g=`/${c}/Work Orders`,u=await U("Work Orders",h,g,null,a.property_id),p=`/${c}/Work Orders/${d}`,_=await U(d,u,p,t,a.property_id),x={before:"Before Images",sprinkler:"Sprinkler Images",other:"Other Files"}[o],y=`/${c}/Work Orders/${d}/${x}`,w=await U(x,_,y,t,a.property_id);for(let j=0;j<e.length;j++){const i=e[j],d=Date.now(),c=Math.random().toString(36).substring(7),m=`${d}-${c}-${i.name.replace(/[^a-zA-Z0-9-_\.]/g,"_")}`,h=`${y}/${m}`,g=`${y.replace(/^\//,"")}/${m}`;try{const e=i.type||"application/octet-stream";if(!e.match(/^[a-zA-Z0-9]+\/[a-zA-Z0-9\-\+\.]+$/))throw new Error(`Invalid MIME type: ${e}`);const{error:s}=await r.storage.from("files").upload(g,i,{cacheControl:"3600",upsert:!1});if(s)throw s;const{error:l}=await r.from("files").insert({name:m,path:h,size:i.size,type:e,uploaded_by:N.id,property_id:a.property_id,job_id:t,folder_id:w,category:o}).select().single();if(l)throw await r.storage.from("files").remove([g]),l;f((e=>e.map(((e,r)=>r===j?{...e,progress:100}:e))));const{data:d}=r.storage.from("files").getPublicUrl(g);if(!d?.publicUrl)throw new Error("Failed to generate public URL");b((r=>[...r,{file_path:h,file_name:m,public_url:d.publicUrl,type:e}])),n&&n(h)}catch(s){l&&l(s instanceof Error?s.message:"Failed to upload file")}}}catch(s){l&&l(s instanceof Error?s.message:"Failed to process files")}finally{p(!1),f([])}},B=({file:e})=>{const[r,t]=s.useState(!1),[i,o]=s.useState(e.public_url);return s.useEffect((()=>{o(e.public_url)}),[e.public_url]),r?a.jsx("div",{className:"w-full h-32 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center",children:a.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Failed to load image"})}):a.jsx("div",{className:"w-full h-32 rounded-lg overflow-hidden",children:a.jsx("img",{src:i,alt:e.file_name,className:"w-full h-full object-cover",onError:e=>{(e=>{e.currentTarget.onerror=null,e.currentTarget.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iI2NjYyIvPjx0ZXh0IHg9Ijc1IiB5PSI3NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+SW1hZ2UgTm90IEZvdW5kPC90ZXh0Pjwvc3ZnPg=="})(e),t(!0)},onLoad:()=>{}})})};return a.jsxs("div",{className:"w-full",children:[!d&&a.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center "+(h?"border-blue-500 bg-blue-50":"border-gray-300"),onDragEnter:I,onDragLeave:C,onDragOver:S,onDrop:F,children:[a.jsx("input",{type:"file",multiple:!0,accept:"other"===o?"*/*":"image/*",onChange:P,className:"hidden",id:E}),a.jsx("label",{htmlFor:E,className:"cursor-pointer text-blue-500 hover:text-blue-600",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-gray-600",children:"Drag and drop files here, or click to select files"}),a.jsx("div",{className:"text-sm text-gray-500",children:"other"===o?"All file types are supported":"Supported formats: JPG, PNG, GIF"})]})})]}),x.length>0&&a.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:x.map(((e,r)=>a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:e.preview,alt:"Uploading",className:"w-full h-32 object-cover rounded-lg"}),a.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1",children:["Uploading: ",Math.round(e.progress),"%"]})]},r)))}),_.length>0&&a.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:_.map(((e,r)=>a.jsxs("div",{className:"relative group",children:[a.jsx(B,{file:e}),!d&&a.jsx("button",{onClick:r=>{var a;r.preventDefault(),r.stopPropagation(),a=e.file_path,m&&m(a),k((e=>new Set([...e,a]))),b((e=>e.filter((e=>e.file_path!==a))))},className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},r)))})]})},b=s.createContext({previewUserId:null});const x=s.createContext({role:null,loading:!0,error:null});const f=(y=()=>{const{jobId:e}=o(),f=i(),y=n(),w=new URLSearchParams(y.search),j=w.get("userId"),k="true"===w.get("edit"),[N,v]=s.useState(!0),[E,I]=s.useState(!1),[C,S]=s.useState(null),[F,P]=s.useState(null),[U,W]=s.useState([]),[B,D]=s.useState([]),[A,O]=s.useState(null),[q,z]=s.useState(null),[$,L]=s.useState(0),[R,M]=s.useState([]),[Z,T]=s.useState(new Set),[J,H]=s.useState({unit_number:"",is_occupied:!1,is_full_paint:!1,job_type:"",job_category_id:"",has_sprinklers:!1,sprinklers:!1,sprinklers_painted:!1,painted_ceilings:!1,ceiling_rooms_count:0,painted_patio:!1,painted_garage:!1,painted_cabinets:!1,painted_crown_molding:!1,painted_front_door:!1,has_accent_wall:!1,accent_wall_type:"",accent_wall_count:0,has_extra_charges:!1,extra_charges_description:"",extra_hours:0,additional_comments:""}),{previewUserId:G}=function(){const e=s.useContext(b);if(void 0===e)throw new Error("useSubcontractorPreview must be used within a SubcontractorPreviewProvider");return e}(),{role:X,isAdmin:Y,isJGManagement:Q,isSubcontractor:V}=function(){const e=s.useContext(x);if(void 0===e)throw new Error("useUserRole must be used within a UserRoleProvider");return e}();s.useEffect((()=>{e?(async()=>{v(!0),S(null);try{await re(),await Promise.all([K(),ee(),ae()])}catch(e){S(e instanceof Error?e.message:"Failed to fetch data"),v(!1)}})():f("/dashboard/subcontractor")}),[e,f]),s.useEffect((()=>{A?H({unit_number:A.unit_number||"",is_occupied:A.is_occupied||!1,is_full_paint:A.is_full_paint||!1,job_type:A.job_type||"",job_category_id:A.job_category_id||"",has_sprinklers:A.has_sprinklers||!1,sprinklers:A.has_sprinklers||!1,sprinklers_painted:A.sprinklers_painted||!1,painted_ceilings:A.painted_ceilings||!1,ceiling_rooms_count:A.ceiling_rooms_count||0,painted_patio:A.painted_patio||!1,painted_garage:A.painted_garage||!1,painted_cabinets:A.painted_cabinets||!1,painted_crown_molding:A.painted_crown_molding||!1,painted_front_door:A.painted_front_door||!1,has_accent_wall:A.has_accent_wall||!1,accent_wall_type:A.accent_wall_type||"",accent_wall_count:A.accent_wall_count||0,has_extra_charges:A.has_extra_charges||!1,extra_charges_description:A.extra_charges_description||"",extra_hours:A.extra_hours||0,additional_comments:A.additional_comments||""}):F&&H({unit_number:F.unit_number||"",is_occupied:F.is_occupied||!1,is_full_paint:F.is_full_paint||!1,job_type:F.job_type?.job_type_label||"",job_category_id:F.job_category_id||"",has_sprinklers:F.has_sprinklers||!1,sprinklers:F.has_sprinklers||!1,sprinklers_painted:F.sprinklers_painted||!1,painted_ceilings:F.painted_ceilings||!1,ceiling_rooms_count:F.ceiling_rooms_count||0,painted_patio:F.painted_patio||!1,painted_garage:F.painted_garage||!1,painted_cabinets:F.painted_cabinets||!1,painted_crown_molding:F.painted_crown_molding||!1,painted_front_door:F.painted_front_door||!1,has_accent_wall:F.has_accent_wall||!1,accent_wall_type:F.accent_wall_type||"",accent_wall_count:F.accent_wall_count||0,has_extra_charges:F.has_extra_charges||!1,extra_charges_description:F.extra_charges_description||"",extra_hours:F.extra_hours||0,additional_comments:F.additional_comments||""})}),[A,F]);const K=async()=>{try{const{data:a,error:t}=await r.from("jobs").select("\n          *,\n          property:properties(*),\n          unit_size:unit_sizes(*),\n          job_type:job_types(*),\n          job_phase:job_phases(*)\n        ").eq("id",e).single();if(t)throw t;if(!a)throw new Error("Job not found");const s={...a,is_occupied:a.is_occupied??!1,is_full_paint:a.is_full_paint??!1,job_category:a.job_category??"Regular Paint",has_sprinklers:a.has_sprinklers??!1,sprinklers_painted:a.sprinklers_painted??!1,painted_ceilings:a.painted_ceilings??!1,ceiling_rooms_count:a.ceiling_rooms_count??0,painted_patio:a.painted_patio??!1,painted_garage:a.painted_garage??!1,painted_cabinets:a.painted_cabinets??!1,painted_crown_molding:a.painted_crown_molding??!1,painted_front_door:a.painted_front_door??!1,has_accent_wall:a.has_accent_wall??!1,accent_wall_type:a.accent_wall_type??"",accent_wall_count:a.accent_wall_count??0,has_extra_charges:a.has_extra_charges??!1,extra_charges_description:a.extra_charges_description??"",extra_hours:a.extra_hours??0,additional_comments:a.additional_comments??""};P(s),v(!1)}catch(a){S(a instanceof Error?a.message:"Failed to fetch job details"),v(!1)}},ee=async()=>{try{const{data:e,error:a}=await r.from("job_phases").select("id, job_phase_label").order("sort_order");if(a)throw a;W(e||[])}catch(e){}},re=async()=>{try{const{data:e,error:a}=await r.from("unit_sizes").select("id, unit_size_label").order("unit_size_label");if(a)throw a;D(e||[])}catch(e){}},ae=async()=>{try{const{data:a,error:t}=await r.from("work_orders").select("*").eq("job_id",e).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(t)return;a&&O(a)}catch(a){}},te=e=>{const{name:r,value:a,type:t}=e.target;if("checkbox"===t){const a=e.target.checked;H((e=>({...e,[r]:a})))}else H("number"===t?e=>({...e,[r]:parseFloat(a)||0}):e=>({...e,[r]:a}))};s.useEffect((()=>{(async()=>{if(F?.job_phase){const e=await(async()=>{if(!F)return null;try{const{data:e}=await r.auth.getUser();if(e?.user?.id){const{data:a}=await r.from("profiles").select("role").eq("id",e.user.id).single();if("admin"===a?.role||"jg_management"===a?.role)return null}return"Job Request"===F.job_phase?.job_phase_label||j?null:"Work Order"!==F.job_phase?.job_phase_label||F.work_order?"Work order already submitted":null}catch(e){return"Error checking job phase"}})();e&&S(e)}})()}),[F?.job_phase]);const se=e=>{t.success("Image uploaded successfully")},ie=e=>{t.error(e)},oe=e=>{T((r=>new Set([...r,e])))};s.useEffect((()=>{F?.property?.id&&ne()}),[F?.property?.id]);const ne=async()=>{try{if(!F?.property?.id)throw new Error("Job property not found");const{data:e,error:a}=await r.from("billing_categories").select("name").eq("property_id",F.property.id);if(a)throw a;if(!e||0===e.length)return void M([]);const{data:t,error:s}=await r.from("job_categories").select("*").in("name",e.map((e=>e.name))).order("sort_order");if(s)throw s;M(t||[])}catch(e){S(e instanceof Error?e.message:"Failed to fetch job categories")}},le=Boolean(J.unit_number&&J.job_category_id);return N?a.jsx("div",{className:"flex items-center justify-center h-full",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):C||!F?a.jsx("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A]",children:a.jsxs("div",{className:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded",children:[a.jsx("h3",{className:"font-medium mb-2",children:"Error Loading Work Order"}),a.jsx("p",{className:"mb-4",children:C||"Job not found"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("button",{onClick:()=>{f(j?`/dashboard/subcontractor?userId=${j}`:"/dashboard/subcontractor")},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Return to Dashboard"}),a.jsx("button",{onClick:()=>window.location.reload(),className:"w-full px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",children:"Try Again"})]})]})}):F?.unit_size?a.jsx("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A] min-h-screen",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsx("div",{className:"flex items-center justify-between mb-8",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:()=>{f(j?`/dashboard/subcontractor?userId=${j}`:"/dashboard/jobs")},className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:a.jsx(c,{className:"h-6 w-6"})}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:k?"Edit Work Order":"Add Work Order"})]})}),C&&a.jsx("div",{className:"mb-6 bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:C}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg mb-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Job Information"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Property"}),a.jsxs("div",{className:"text-gray-900 dark:text-white font-medium flex items-center",children:[a.jsx(m,{className:"h-4 w-4 mr-2 text-gray-500 dark:text-gray-400"}),F.property?.property_name]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Work Order #"}),a.jsxs("div",{className:"text-gray-900 dark:text-white font-medium flex items-center",children:[a.jsx(h,{className:"h-4 w-4 mr-2 text-gray-500 dark:text-gray-400"}),(de=F.work_order_num,`WO-${String(de).padStart(6,"0")}`)]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Unit #"}),a.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:F.unit_number})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Job Type"}),a.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:F.job_type?.job_type_label||"Not specified"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Unit Size"}),a.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:F.unit_size?.unit_size_label})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"Scheduled Date"}),a.jsxs("div",{className:"text-gray-900 dark:text-white font-medium flex items-center",children:[a.jsx(g,{className:"h-4 w-4 mr-2 text-gray-500 dark:text-gray-400"}),l(F.scheduled_date)]})]})]})]}),a.jsxs("form",{onSubmit:async a=>{a.preventDefault(),I(!0),S(null);try{if(!F)throw new Error("Job not found");if(V&&A)return S("A work order has already been submitted for this job. Please contact your manager if you need to make changes."),void I(!1);const{data:a,error:s}=await r.from("job_phases").select("id").eq("job_phase_label",J.has_extra_charges?"Pending Work Order":"Work Order");if(s)throw s;if(!a||0===a.length)throw new Error("Target phase not found");const i=a[0].id,o={job_id:F.id,unit_number:J.unit_number,unit_size:F.unit_size?.unit_size_label,is_occupied:J.is_occupied??!1,is_full_paint:J.is_full_paint??!1,job_category_id:J.job_category_id,has_sprinklers:J.has_sprinklers??!1,sprinklers_painted:J.sprinklers_painted??!1,painted_ceilings:J.painted_ceilings??!1,ceiling_rooms_count:J.ceiling_rooms_count||0,painted_patio:J.painted_patio??!1,painted_garage:J.painted_garage??!1,painted_cabinets:J.painted_cabinets??!1,painted_crown_molding:J.painted_crown_molding??!1,painted_front_door:J.painted_front_door??!1,has_accent_wall:J.has_accent_wall??!1,accent_wall_type:J.has_accent_wall?J.accent_wall_type||"":null,accent_wall_count:J.accent_wall_count||0,has_extra_charges:J.has_extra_charges??!1,extra_charges_description:J.extra_charges_description||"",extra_hours:J.extra_hours||0,additional_comments:J.additional_comments||"",prepared_by:(await r.auth.getUser()).data.user?.id};let n;if(A){const{data:e,error:a}=await r.from("work_orders").update(o).eq("id",A.id).select().single();n={data:e,error:a}}else{const{data:e,error:a}=await r.from("work_orders").insert([o]).select().single();n={data:e,error:a}}if(n.error)throw n.error;if(!n.data)throw new Error("No data returned from work order creation/update");z(n.data.id);const{error:l}=await r.from("jobs").update({current_phase_id:i}).eq("id",F.id);if(l)throw l;const{error:d}=await r.from("job_phase_changes").insert([{job_id:F.id,changed_by:j||(await r.auth.getUser()).data.user?.id,from_phase_id:F.job_phase?.id,to_phase_id:i,change_reason:J.has_extra_charges?"Work order created with extra charges":"Work order created"}]);if(d)throw d;for(const e of Z){const{error:a}=await r.storage.from("work_orders").remove([e.replace(/^\/+/,"")]),{error:t}=await r.from("files").delete().eq("path",e)}T(new Set),t.success(A?"Work order updated successfully":"Work order created successfully"),f(`/dashboard/jobs/${e}`)}catch(s){S(s instanceof Error?s.message:"Failed to create/update work order"),I(!1)}},className:"space-y-6",children:[a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Unit Information"}),a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"unit_number",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:["Unit # ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",id:"unit_number",name:"unit_number",required:!0,value:J.unit_number,onChange:te,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"job_category_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:["Job Category ",a.jsx("span",{className:"text-red-500",children:"*"})]}),0===R.length?a.jsx("div",{className:"text-yellow-600 dark:text-yellow-400 mb-4",children:"No billable categories available for this property. Please add billing details for the property first."}):a.jsxs("select",{id:"job_category_id",name:"job_category_id",required:!0,value:J.job_category_id,onChange:te,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select a job category"}),R.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"is_occupied",name:"is_occupied",checked:J.is_occupied,onChange:e=>H((r=>({...r,is_occupied:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"is_occupied",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Unit is Occupied"})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Sprinklers"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"sprinklers",checked:J.sprinklers,onChange:e=>H((r=>({...r,sprinklers:e.target.checked,has_sprinklers:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"sprinklers",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Unit Has Sprinklers"})]}),J.sprinklers&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center mt-4",children:[a.jsx("input",{type:"checkbox",id:"sprinklers_painted",checked:J.sprinklers_painted,onChange:e=>H((r=>({...r,sprinklers_painted:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"sprinklers_painted",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Paint on Sprinklers"})]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sprinkler Images"}),a.jsx(_,{jobId:e||"",workOrderId:A?.id||"",folder:"sprinkler",onUploadComplete:se,onError:ie})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Before Images"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Before Images"}),a.jsx(_,{jobId:e||"",workOrderId:A?.id||"",folder:"before",onUploadComplete:se,onError:ie,onImageDelete:oe})]})})]}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Other Files"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Files (All File Types)"}),a.jsx(_,{jobId:e||"",workOrderId:A?.id||"",folder:"other",onUploadComplete:se,onError:ie,onImageDelete:oe})]})})]}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Painted Items"}),a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"painted_ceilings",name:"painted_ceilings",checked:J.painted_ceilings,onChange:e=>H((r=>({...r,painted_ceilings:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"painted_ceilings",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Painted Ceilings"})]}),J.painted_ceilings&&a.jsxs("div",{className:"ml-6",children:[a.jsx("label",{htmlFor:"ceiling_rooms_count",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Number of Rooms"}),a.jsx("input",{type:"number",id:"ceiling_rooms_count",name:"ceiling_rooms_count",min:"0",value:J.ceiling_rooms_count,onChange:te,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"painted_patio",name:"painted_patio",checked:J.painted_patio,onChange:e=>H((r=>({...r,painted_patio:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"painted_patio",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Painted Patio"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"painted_garage",name:"painted_garage",checked:J.painted_garage,onChange:e=>H((r=>({...r,painted_garage:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"painted_garage",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Painted Garage"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"painted_cabinets",name:"painted_cabinets",checked:J.painted_cabinets,onChange:e=>H((r=>({...r,painted_cabinets:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"painted_cabinets",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Painted Cabinets"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"painted_crown_molding",name:"painted_crown_molding",checked:J.painted_crown_molding,onChange:e=>H((r=>({...r,painted_crown_molding:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"painted_crown_molding",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Painted Crown Molding"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"painted_front_door",name:"painted_front_door",checked:J.painted_front_door,onChange:e=>H((r=>({...r,painted_front_door:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"painted_front_door",className:"ml-2 block text-sm text-gray-900 dark:text-white",children:"Painted Front Door"})]})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsxs("div",{className:"flex items-center mb-6",children:[a.jsx("input",{type:"checkbox",id:"has_accent_wall",name:"has_accent_wall",checked:J.has_accent_wall,onChange:e=>H((r=>({...r,has_accent_wall:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"has_accent_wall",className:"ml-2 text-lg font-semibold text-gray-900 dark:text-white",children:"Accent Wall"})]}),J.has_accent_wall&&a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"accent_wall_type",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Accent Wall Type"}),a.jsxs("select",{id:"accent_wall_type",name:"accent_wall_type",required:J.has_accent_wall,value:J.accent_wall_type,onChange:te,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select type"}),a.jsx("option",{value:"Custom",children:"Custom"}),a.jsx("option",{value:"Paint Over",children:"Paint Over"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"accent_wall_count",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Number of Accent Walls"}),a.jsx("input",{type:"number",id:"accent_wall_count",name:"accent_wall_count",min:"0",required:J.has_accent_wall,value:J.accent_wall_count,onChange:te,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsxs("div",{className:"flex items-center mb-6",children:[a.jsx("input",{type:"checkbox",id:"has_extra_charges",name:"has_extra_charges",checked:J.has_extra_charges,onChange:e=>H((r=>({...r,has_extra_charges:e.target.checked}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"has_extra_charges",className:"ml-2 text-lg font-semibold text-gray-900 dark:text-white",children:"Extra Charges"})]}),J.has_extra_charges&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700/30 text-yellow-800 dark:text-yellow-200 px-4 py-3 rounded-lg mb-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(u,{className:"h-5 w-5 mr-2 text-yellow-600 dark:text-yellow-400 mt-0.5"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Extra Charges Require Approval"}),a.jsx("p",{className:"mt-1 text-sm",children:'Adding extra charges will set this job to "Pending Work Order" status until the charges are approved.'})]})]})}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"extra_charges_description",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Description"}),a.jsx("textarea",{id:"extra_charges_description",name:"extra_charges_description",rows:3,required:J.has_extra_charges,value:J.extra_charges_description,onChange:te,className:"w-full px-4 py-3 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe the extra charges"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"extra_hours",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Extra Hours"}),a.jsx("input",{type:"number",id:"extra_hours",name:"extra_hours",min:"0",required:J.has_extra_charges,value:J.extra_hours,onChange:te,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Additional Comments"}),a.jsx("div",{children:a.jsx("textarea",{id:"additional_comments",name:"additional_comments",rows:4,value:J.additional_comments,onChange:te,className:"w-full px-4 py-3 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter any additional comments or notes"})})]}),a.jsxs("div",{className:"flex justify-end gap-2 mt-8",children:[a.jsx("button",{type:"button",onClick:()=>f("/dashboard/jobs"),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-[#2D3B4E] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),le&&a.jsx("button",{type:"submit",disabled:E,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:E?a.jsxs("span",{className:"flex items-center",children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):a.jsxs("span",{className:"flex items-center",children:[a.jsx(p,{className:"h-4 w-4 mr-2"}),k?"Update Work Order":"Create Work Order"]})})]})]}),q&&a.jsxs("div",{className:"mt-8 bg-white dark:bg-[#1E293B] rounded-lg shadow-lg p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Work Order Images"}),a.jsx(d,{workOrderId:q},$),a.jsx("div",{className:"mt-6 flex justify-end",children:a.jsx("button",{onClick:()=>{f(j?`/dashboard/subcontractor?userId=${j}`:"/dashboard/subcontractor")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Return to Dashboard"})})]})]})}):a.jsx("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A]",children:a.jsxs("div",{className:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded",children:[a.jsx("h3",{className:"font-medium mb-2",children:"Error Loading Work Order"}),a.jsx("p",{className:"mb-4",children:"Unit size information is missing for this job."}),a.jsx("div",{className:"space-y-2",children:a.jsx("button",{onClick:()=>{f(j?`/dashboard/subcontractor?userId=${j}`:"/dashboard/subcontractor")},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Return to Dashboard"})})]})});var de},function(e){const t=i(),{jobId:n}=o();return s.useEffect((()=>{!async function(){const{data:e}=await r.auth.getUser(),a=e?.user?.id;if(!a||!n)return void t("/dashboard/subcontractor");const{data:s}=await r.from("jobs").select("assigned_to").eq("id",n).single();if(!s)return void t("/dashboard/subcontractor");const{data:i}=await r.from("profiles").select("role").eq("id",a).single();i?"admin"!==i.role&&"jg_management"!==i.role&&s.assigned_to!==a&&t("/dashboard/subcontractor"):t("/dashboard/subcontractor")}()}),[n,t]),a.jsx(y,{...e})});var y;export{f as default};
