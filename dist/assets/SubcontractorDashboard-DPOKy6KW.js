import{j as e,s as r}from"./index-nRXVoRx_.js";import{r as a,i as t,L as s}from"./react-vendor--AdGielI.js";import{u as n}from"./AppContent-Dvvh2h3j.js";import{i as l,b as o,a as d,f as i}from"./utils-DsqaXd9R.js";import{k as c,r as x,M as m,y as h}from"./ui-a3QeRpHh.js";import"./supabase-Dq0wjmmz.js";function y({message:r="Loading...",duration:t=4e3}){const[s,n]=a.useState(0);a.useEffect((()=>{const e=Date.now(),r=setInterval((()=>{const a=Date.now()-e,s=Math.min(a/t*100,100);n(s),s>=100&&clearInterval(r)}),16);return()=>clearInterval(r)}),[t]);const l={blue:`${Math.min(25,s)}%`,purple:`${Math.min(50,s)}%`,orange:`${Math.min(75,s)}%`,green:`${s}%`};return e.jsx("div",{className:"fixed inset-0 bg-white dark:bg-[#0F172A] flex items-center justify-center z-50",children:e.jsxs("div",{className:"w-64 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full transition-all duration-100 ease-linear",style:{width:`${s}%`,background:`linear-gradient(to right, \n                #3B82F6 0%, \n                #3B82F6 ${l.blue}, \n                #A855F7 ${l.blue}, \n                #A855F7 ${l.purple}, \n                #F97316 ${l.purple}, \n                #F97316 ${l.orange}, \n                #22C55E ${l.orange}, \n                #22C55E ${l.green}\n              )`}})}),e.jsx("h3",{className:"text-gray-900 dark:text-white font-medium text-xl text-center",children:"PAINTING DASHBOARD"})]})})}function g(){const[g,b]=a.useState(!0),[p,u]=a.useState(null),[j,f]=a.useState([]),[w,k]=a.useState([]),[_,N]=a.useState(new Date),[v,A]=a.useState([]),[$,M]=a.useState(!0),{role:D}=n(),E=t(),F=new URLSearchParams(E.search).get("userId"),S=F&&("admin"===D||"jg_management"===D);a.useEffect((()=>{(async()=>{try{b(!0);const[e,r]=await Promise.all([T(new Date),T(o(new Date,1))]);f(e||[]),k(r||[])}catch(e){u(e instanceof Error?e.message:"Failed to fetch jobs"),f([]),k([])}finally{b(!1)}})()}),[F]),a.useEffect((()=>{l(_,new Date)?A(j):l(_,o(new Date,1))?A(w):T(_).then((e=>{A(e||[])})).catch((e=>{u(e instanceof Error?e.message:"Failed to fetch jobs for date"),A([])}))}),[_,j,w]),a.useEffect((()=>{const e=setTimeout((()=>{M(!1)}),4e3);return()=>clearTimeout(e)}),[]);const T=async e=>{try{let a;if(F)a=F;else{const{data:e,error:t}=await r.auth.getUser();if(t)throw t;if(!e.user)throw new Error("User not found");a=e.user.id}if(!a)throw new Error("No user ID available");const t=d(e,"America/New_York","yyyy-MM-dd'T'00:00:00XXX"),s=d(e,"America/New_York","yyyy-MM-dd'T'23:59:59XXX"),{data:n,error:l}=await r.from("job_phases").select("id").eq("job_phase_label","Job Request");if(l)throw l;if(!n||0===n.length)return[];const o=n[0].id,{data:i,error:c}=await r.from("jobs").select("\n          id,\n          work_order_num,\n          unit_number,\n          scheduled_date,\n          property:properties (\n            property_name,\n            address,\n            city,\n            state\n          ),\n          job_phase:current_phase_id (\n            job_phase_label,\n            color_dark_mode,\n            id\n          ),\n          job_type:job_types (\n            job_type_label\n          ),\n          work_order:work_orders (\n            id\n          )\n        ").eq("assigned_to",a).eq("current_phase_id",o).gte("scheduled_date",t).lte("scheduled_date",s).order("scheduled_date",{ascending:!0});if(c)throw c;return(i||[]).map((e=>({...e,property:Array.isArray(e.property)?e.property[0]:e.property,job_phase:Array.isArray(e.job_phase)?e.job_phase[0]:e.job_phase,job_type:Array.isArray(e.job_type)?e.job_type[0]:e.job_type,work_order:Array.isArray(e.work_order)?e.work_order[0]:e.work_order})))}catch(a){return void u(a instanceof Error?a.message:"Failed to fetch jobs for date")}},C=e=>`WO-${String(e).padStart(6,"0")}`,U=l(_,new Date),B=l(_,o(new Date,1));return $?e.jsx(y,{message:"Loading your workspace..."}):e.jsxs("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A] min-h-screen",children:[S&&e.jsxs("div",{className:"mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700/30 text-yellow-800 dark:text-yellow-200 px-4 py-3 rounded-lg",children:[e.jsxs("p",{className:"flex items-center font-medium",children:[e.jsx(c,{className:"h-5 w-5 mr-2 text-yellow-600 dark:text-yellow-400"}),"You are viewing the subcontractor dashboard as ","admin"===D?"an administrator":"JG Management"]}),e.jsx("p",{className:"mt-1 text-sm",children:"This is a preview of what the subcontractor sees. Any actions taken here will affect the actual data."})]}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(c,{className:"h-8 w-8 text-gray-600 dark:text-gray-400"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"My Assigned Jobs"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>N(new Date),className:`px-4 py-2 ${U?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"} rounded-lg transition-colors`,children:"Today"}),e.jsx("button",{onClick:()=>N(o(new Date,1)),className:`px-4 py-2 ${B?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"} rounded-lg transition-colors`,children:"Tomorrow"})]})]}),p&&e.jsx("div",{className:"mb-6 bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:p}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg shadow-lg p-6 mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(x,{className:"h-5 w-5 mr-2 text-blue-500"}),"Jobs for ",i(_,"MMMM d, yyyy")]}),0===v.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(c,{className:"h-12 w-12 mx-auto mb-4 text-gray-400 dark:text-gray-600"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Jobs Scheduled"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:["There are no jobs scheduled for ",i(_,"MMMM d, yyyy"),"."]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:()=>N(o(_,-1)),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Previous Day"}),e.jsx("button",{onClick:()=>N(o(_,1)),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Next Day"})]})]}):e.jsx("div",{className:"space-y-4",children:v.map((r=>{return e.jsx("div",{className:"bg-gray-50 dark:bg-[#0F172A] rounded-lg p-4 border-l-4",style:{borderLeftColor:r.job_phase?.color_dark_mode||"#6B7280"},children:e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:C(r.work_order_num)}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:r.property?.property_name||"Unknown Property"})]}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:r.job_phase?.color_dark_mode||"#6B7280",color:"white"},children:r.job_phase?.job_phase_label||"Unknown Phase"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(m,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.property?(a=r.property,a?`${a.address}, ${a.city}, ${a.state}`:"No address available"):"No address available"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Unit #",r.unit_number]})})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.job_type?.job_type_label||"Unknown Type"})}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs(s,{to:`/dashboard/jobs/${r.id}/new-work-order${S?`?userId=${F}`:""}`,className:"inline-flex items-center px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Add Work Order"]})})]})},r.id);var a}))}),U&&w.length>0&&e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(c,{className:"h-5 w-5 mr-2 text-blue-500"}),"Tomorrow's Jobs"]}),e.jsx("div",{className:"space-y-3",children:w.map((r=>e.jsx("div",{className:"bg-gray-50 dark:bg-[#0F172A] rounded-lg p-3 border-l-2",style:{borderLeftColor:r.job_phase?.color_dark_mode||"#6B7280"},children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:C(r.work_order_num)}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r.property?.property_name||"Unknown Property"})]}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:r.job_phase?.color_dark_mode||"#6B7280",color:"white"},children:r.job_phase?.job_phase_label||"Unknown Phase"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Unit #",r.unit_number]}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:r.job_type?.job_type_label||"Unknown Type"})]})})]})},r.id)))})]})]})]})]})}export{g as SubcontractorDashboard,g as default};
