import{s as e,j as t,b as r}from"./index-nRXVoRx_.js";import{r as a,R as n,t as s,b as o,k as l,u as i,L as d}from"./react-vendor--AdGielI.js";import{f as c}from"./dateUtils-BelUzJwD.js";import{f as u,a as m}from"./formatUtils-fTiefMj9.js";import{d as x,u as g}from"./AppContent-Dvvh2h3j.js";import{E as h}from"./pdf-TGvrJ6T9.js";import{P as b}from"./PropertyMap-g0Uczq7S.js";import{I as p}from"./ImageGallery-Daqwq708.js";import{p as f,o as y,b as _,G as w,I as k,J as v,z as j,x as N,K as S,y as E,N as C,B as P,M as $,e as F,k as A,q as O,r as T,w as D,f as R,F as I,O as L,Q as W,R as M,V as z,W as q,Y,Z as B,_ as H}from"./ui-a3QeRpHh.js";import"./supabase-Dq0wjmmz.js";import"./utils-DsqaXd9R.js";import"./leaflet-DrIUZV5B.js";var U=Object.defineProperty,J=(e,t,r)=>(((e,t,r)=>{t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r);let V=new class{constructor(){J(this,"current",this.detect()),J(this,"handoffState","pending"),J(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return"server"===this.current}get isClient(){return"client"===this.current}detect(){return"undefined"==typeof window||"undefined"==typeof document?"server":"client"}handoff(){"pending"===this.handoffState&&(this.handoffState="complete")}get isHandoffComplete(){return"complete"===this.handoffState}};function G(e){var t,r;return V.isServer?null:e?"ownerDocument"in e?e.ownerDocument:"current"in e?null!=(r=null==(t=e.current)?void 0:t.ownerDocument)?r:document:null:document}function K(e){"function"==typeof queueMicrotask?queueMicrotask(e):Promise.resolve().then(e).catch((e=>setTimeout((()=>{throw e}))))}function X(){let e=[],t={addEventListener:(e,r,a,n)=>(e.addEventListener(r,a,n),t.add((()=>e.removeEventListener(r,a,n)))),requestAnimationFrame(...e){let r=requestAnimationFrame(...e);return t.add((()=>cancelAnimationFrame(r)))},nextFrame:(...e)=>t.requestAnimationFrame((()=>t.requestAnimationFrame(...e))),setTimeout(...e){let r=setTimeout(...e);return t.add((()=>clearTimeout(r)))},microTask(...e){let r={current:!0};return K((()=>{r.current&&e[0]()})),t.add((()=>{r.current=!1}))},style(e,t,r){let a=e.style.getPropertyValue(t);return Object.assign(e.style,{[t]:r}),this.add((()=>{Object.assign(e.style,{[t]:a})}))},group(e){let t=X();return e(t),this.add((()=>t.dispose()))},add:t=>(e.includes(t)||e.push(t),()=>{let r=e.indexOf(t);if(r>=0)for(let t of e.splice(r,1))t()}),dispose(){for(let t of e.splice(0))t()}};return t}function Z(){let[e]=a.useState(X);return a.useEffect((()=>()=>e.dispose()),[e]),e}let Q=(e,t)=>{V.isServer?a.useEffect(e,t):a.useLayoutEffect(e,t)};function ee(e){let t=a.useRef(e);return Q((()=>{t.current=e}),[e]),t}let te=function(e){let t=ee(e);return n.useCallback(((...e)=>t.current(...e)),[t])},re=a.createContext(void 0);function ae(...e){return Array.from(new Set(e.flatMap((e=>"string"==typeof e?e.split(" "):[])))).filter(Boolean).join(" ")}function ne(e,t,...r){if(e in t){let a=t[e];return"function"==typeof a?a(...r):a}let a=new Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map((e=>`"${e}"`)).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,ne),a}var se=(e=>(e[e.None=0]="None",e[e.RenderStrategy=1]="RenderStrategy",e[e.Static=2]="Static",e))(se||{}),oe=(e=>(e[e.Unmount=0]="Unmount",e[e.Hidden=1]="Hidden",e))(oe||{});function le(){let e=function(){let e=a.useRef([]),t=a.useCallback((t=>{for(let r of e.current)null!=r&&("function"==typeof r?r(t):r.current=t)}),[]);return(...r)=>{if(!r.every((e=>null==e)))return e.current=r,t}}();return a.useCallback((t=>function({ourProps:e,theirProps:t,slot:r,defaultTag:a,features:n,visible:s=!0,name:o,mergeRefs:l}){l=null!=l?l:de;let i=ce(t,e);if(s)return ie(i,r,a,o,l);let d=null!=n?n:0;if(2&d){let{static:e=!1,...t}=i;if(e)return ie(t,r,a,o,l)}if(1&d){let{unmount:e=!0,...t}=i;return ne(e?0:1,{0:()=>null,1:()=>ie({...t,hidden:!0,style:{display:"none"}},r,a,o,l)})}return ie(i,r,a,o,l)}({mergeRefs:e,...t})),[e])}function ie(e,t={},r,n,s){let{as:o=r,children:l,refName:i="ref",...d}=xe(e,["unmount","static"]),c=void 0!==e.ref?{[i]:e.ref}:{},u="function"==typeof l?l(t):l;"className"in d&&d.className&&"function"==typeof d.className&&(d.className=d.className(t)),d["aria-labelledby"]&&d["aria-labelledby"]===d.id&&(d["aria-labelledby"]=void 0);let m={};if(t){let e=!1,r=[];for(let[a,n]of Object.entries(t))"boolean"==typeof n&&(e=!0),!0===n&&r.push(a.replace(/([A-Z])/g,(e=>`-${e.toLowerCase()}`)));if(e){m["data-headlessui-state"]=r.join(" ");for(let e of r)m[`data-${e}`]=""}}if(o===a.Fragment&&(Object.keys(me(d)).length>0||Object.keys(me(m)).length>0)){if(a.isValidElement(u)&&!(Array.isArray(u)&&u.length>1)){let e=u.props,t=null==e?void 0:e.className,r="function"==typeof t?(...e)=>ae(t(...e),d.className):ae(t,d.className),n=r?{className:r}:{},o=ce(u.props,me(xe(d,["ref"])));for(let a in m)a in o&&delete m[a];return a.cloneElement(u,Object.assign({},o,m,c,{ref:s(ge(u),c.ref)},n))}if(Object.keys(me(d)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${n} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(me(d)).concat(Object.keys(me(m))).map((e=>`  - ${e}`)).join("\n"),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map((e=>`  - ${e}`)).join("\n")].join("\n"))}return a.createElement(o,Object.assign({},xe(d,["ref"]),o!==a.Fragment&&c,o!==a.Fragment&&m),u)}function de(...e){return e.every((e=>null==e))?void 0:t=>{for(let r of e)null!=r&&("function"==typeof r?r(t):r.current=t)}}function ce(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},r={};for(let a of e)for(let e in a)e.startsWith("on")&&"function"==typeof a[e]?(null!=r[e]||(r[e]=[]),r[e].push(a[e])):t[e]=a[e];if(t.disabled||t["aria-disabled"])for(let a in r)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(a)&&(r[a]=[e=>{var t;return null==(t=null==e?void 0:e.preventDefault)?void 0:t.call(e)}]);for(let a in r)Object.assign(t,{[a](e,...t){let n=r[a];for(let r of n){if((e instanceof Event||(null==e?void 0:e.nativeEvent)instanceof Event)&&e.defaultPrevented)return;r(e,...t)}}});return t}function ue(e){var t;return Object.assign(a.forwardRef(e),{displayName:null!=(t=e.displayName)?t:e.name})}function me(e){let t=Object.assign({},e);for(let r in t)void 0===t[r]&&delete t[r];return t}function xe(e,t=[]){let r=Object.assign({},e);for(let a of t)a in r&&delete r[a];return r}function ge(e){return n.version.split(".")[0]>="19"?e.props.ref:e.ref}var he=(e=>(e[e.None=1]="None",e[e.Focusable=2]="Focusable",e[e.Hidden=4]="Hidden",e))(he||{});let be=ue((function(e,t){var r;let{features:a=1,...n}=e,s={ref:t,"aria-hidden":!(2&~a)||(null!=(r=n["aria-hidden"])?r:void 0),hidden:!(4&~a)||void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...!(4&~a)&&!!(2&~a)&&{display:"none"}}};return le()({ourProps:s,theirProps:n,slot:{},defaultTag:"span",name:"Hidden"})}));function pe(e){return"object"==typeof e&&null!==e&&"nodeType"in e}function fe(e){return pe(e)&&"tagName"in e}function ye(e){return fe(e)&&"accessKey"in e}function _e(e){return fe(e)&&"tabIndex"in e}let we=Symbol();function ke(...e){let t=a.useRef(e);a.useEffect((()=>{t.current=e}),[e]);let r=te((e=>{for(let r of t.current)null!=r&&("function"==typeof r?r(e):r.current=e)}));return e.every((e=>null==e||(null==e?void 0:e[we])))?void 0:r}let ve=a.createContext(null);function je(){let e=a.useContext(ve);if(null===e){let e=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,je),e}return e}ve.displayName="DescriptionContext";let Ne=ue((function(e,t){let r=a.useId(),n=a.useContext(re),{id:s=`headlessui-description-${r}`,...o}=e,l=je(),i=ke(t);Q((()=>l.register(s)),[s,l.register]);let d=n||!1,c=a.useMemo((()=>({...l.slot,disabled:d})),[l.slot,d]),u={ref:i,...l.props,id:s};return le()({ourProps:u,theirProps:o,slot:c,defaultTag:"p",name:l.name||"Description"})})),Se=Object.assign(Ne,{});var Ee=(e=>(e.Space=" ",e.Enter="Enter",e.Escape="Escape",e.Backspace="Backspace",e.Delete="Delete",e.ArrowLeft="ArrowLeft",e.ArrowUp="ArrowUp",e.ArrowRight="ArrowRight",e.ArrowDown="ArrowDown",e.Home="Home",e.End="End",e.PageUp="PageUp",e.PageDown="PageDown",e.Tab="Tab",e))(Ee||{});let Ce=a.createContext((()=>{}));function Pe({value:e,children:t}){return n.createElement(Ce.Provider,{value:e},t)}let $e=class extends Map{constructor(e){super(),this.factory=e}get(e){let t=super.get(e);return void 0===t&&(t=this.factory(e),this.set(e,t)),t}};var Fe,Ae,Oe,Te=Object.defineProperty,De=(e,t,r)=>(((e,t,r)=>{t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,t+"",r),r),Re=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},Ie=(e,t,r)=>(Re(e,t,"read from private field"),r?r.call(e):t.get(e)),Le=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},We=(e,t,r,a)=>(Re(e,t,"write to private field"),t.set(e,r),r);let Me=class{constructor(e){Le(this,Fe,{}),Le(this,Ae,new $e((()=>new Set))),Le(this,Oe,new Set),De(this,"disposables",X()),We(this,Fe,e),V.isServer&&this.disposables.microTask((()=>{this.dispose()}))}dispose(){this.disposables.dispose()}get state(){return Ie(this,Fe)}subscribe(e,t){if(V.isServer)return()=>{};let r={selector:e,callback:t,current:e(Ie(this,Fe))};return Ie(this,Oe).add(r),this.disposables.add((()=>{Ie(this,Oe).delete(r)}))}on(e,t){return V.isServer?()=>{}:(Ie(this,Ae).get(e).add(t),this.disposables.add((()=>{Ie(this,Ae).get(e).delete(t)})))}send(e){let t=this.reduce(Ie(this,Fe),e);if(t!==Ie(this,Fe)){We(this,Fe,t);for(let e of Ie(this,Oe)){let t=e.selector(Ie(this,Fe));ze(e.current,t)||(e.current=t,e.callback(t))}for(let t of Ie(this,Ae).get(e.type))t(Ie(this,Fe),e)}}};function ze(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&qe(e[Symbol.iterator](),t[Symbol.iterator]()):e instanceof Map&&t instanceof Map||e instanceof Set&&t instanceof Set?e.size===t.size&&qe(e.entries(),t.entries()):!(!Ye(e)||!Ye(t))&&qe(Object.entries(e)[Symbol.iterator](),Object.entries(t)[Symbol.iterator]()))}function qe(e,t){for(;;){let r=e.next(),a=t.next();if(r.done&&a.done)return!0;if(r.done||a.done||!Object.is(r.value,a.value))return!1}}function Ye(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||null===Object.getPrototypeOf(t)}Fe=new WeakMap,Ae=new WeakMap,Oe=new WeakMap;var Be=Object.defineProperty,He=(e,t,r)=>(((e,t,r)=>{t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r),Ue=(e=>(e[e.Push=0]="Push",e[e.Pop=1]="Pop",e))(Ue||{});let Je={0(e,t){let r=t.id,a=e.stack,n=e.stack.indexOf(r);if(-1!==n){let t=e.stack.slice();return t.splice(n,1),t.push(r),a=t,{...e,stack:a}}return{...e,stack:[...e.stack,r]}},1(e,t){let r=t.id,a=e.stack.indexOf(r);if(-1===a)return e;let n=e.stack.slice();return n.splice(a,1),{...e,stack:n}}},Ve=class e extends Me{constructor(){super(...arguments),He(this,"actions",{push:e=>this.send({type:0,id:e}),pop:e=>this.send({type:1,id:e})}),He(this,"selectors",{isTop:(e,t)=>e.stack[e.stack.length-1]===t,inStack:(e,t)=>e.stack.includes(t)})}static new(){return new e({stack:[]})}reduce(e,t){return ne(t.type,Je,e,t)}};const Ge=new $e((()=>Ve.new()));var Ke={exports:{}},Xe={},Ze=a;var Qe="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},et=Ze.useSyncExternalStore,tt=Ze.useRef,rt=Ze.useEffect,at=Ze.useMemo,nt=Ze.useDebugValue;Xe.useSyncExternalStoreWithSelector=function(e,t,r,a,n){var s=tt(null);if(null===s.current){var o={hasValue:!1,value:null};s.current=o}else o=s.current;s=at((function(){function e(e){if(!i){if(i=!0,s=e,e=a(e),void 0!==n&&o.hasValue){var t=o.value;if(n(t,e))return l=t}return l=e}if(t=l,Qe(s,e))return t;var r=a(e);return void 0!==n&&n(t,r)?(s=e,t):(s=e,l=r)}var s,l,i=!1,d=void 0===r?null:r;return[function(){return e(t())},null===d?void 0:function(){return e(d())}]}),[t,r,a,n]);var l=et(e,s[0],s[1]);return rt((function(){o.hasValue=!0,o.value=l}),[l]),nt(l),l},Ke.exports=Xe;var st=Ke.exports;function ot(e,t,r=ze){return st.useSyncExternalStoreWithSelector(te((t=>e.subscribe(lt,t))),te((()=>e.state)),te((()=>e.state)),te(t),r)}function lt(e){return e}function it(e,t){let r=a.useId(),n=Ge.get(t),[s,o]=ot(n,a.useCallback((e=>[n.selectors.isTop(e,r),n.selectors.inStack(e,r)]),[n,r]));return Q((()=>{if(e)return n.actions.push(r),()=>n.actions.pop(r)}),[n,e,r]),!!e&&(!o||s)}let dt=new Map,ct=new Map;function ut(e){var t;let r=null!=(t=ct.get(e))?t:0;return ct.set(e,r+1),0!==r||(dt.set(e,{"aria-hidden":e.getAttribute("aria-hidden"),inert:e.inert}),e.setAttribute("aria-hidden","true"),e.inert=!0),()=>mt(e)}function mt(e){var t;let r=null!=(t=ct.get(e))?t:1;if(1===r?ct.delete(e):ct.set(e,r-1),1!==r)return;let a=dt.get(e);a&&(null===a["aria-hidden"]?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",a["aria-hidden"]),e.inert=a.inert,dt.delete(e))}let xt=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map((e=>`${e}:not([tabindex='-1'])`)).join(","),gt=["[data-autofocus]"].map((e=>`${e}:not([tabindex='-1'])`)).join(",");var ht=(e=>(e[e.First=1]="First",e[e.Previous=2]="Previous",e[e.Next=4]="Next",e[e.Last=8]="Last",e[e.WrapAround=16]="WrapAround",e[e.NoScroll=32]="NoScroll",e[e.AutoFocus=64]="AutoFocus",e))(ht||{}),bt=(e=>(e[e.Error=0]="Error",e[e.Overflow=1]="Overflow",e[e.Success=2]="Success",e[e.Underflow=3]="Underflow",e))(bt||{}),pt=(e=>(e[e.Previous=-1]="Previous",e[e.Next=1]="Next",e))(pt||{});var ft=(e=>(e[e.Strict=0]="Strict",e[e.Loose=1]="Loose",e))(ft||{});var yt=(e=>(e[e.Keyboard=0]="Keyboard",e[e.Mouse=1]="Mouse",e))(yt||{});function _t(e){null==e||e.focus({preventScroll:!0})}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("keydown",(e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")}),!0),document.addEventListener("click",(e=>{1===e.detail?delete document.documentElement.dataset.headlessuiFocusVisible:0===e.detail&&(document.documentElement.dataset.headlessuiFocusVisible="")}),!0));let wt=["textarea","input"].join(",");function kt(e,t,{sorted:r=!0,relativeTo:a=null,skipElements:n=[]}={}){let s=Array.isArray(e)?e.length>0?e[0].ownerDocument:document:e.ownerDocument,o=Array.isArray(e)?r?function(e,t=e=>e){return e.slice().sort(((e,r)=>{let a=t(e),n=t(r);if(null===a||null===n)return 0;let s=a.compareDocumentPosition(n);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0}))}(e):e:64&t?function(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(gt)).sort(((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER))))}(e):function(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(xt)).sort(((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER))))}(e);n.length>0&&o.length>1&&(o=o.filter((e=>!n.some((t=>null!=t&&"current"in t?(null==t?void 0:t.current)===e:t===e))))),a=null!=a?a:s.activeElement;let l,i=(()=>{if(5&t)return 1;if(10&t)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),d=(()=>{if(1&t)return 0;if(2&t)return Math.max(0,o.indexOf(a))-1;if(4&t)return Math.max(0,o.indexOf(a))+1;if(8&t)return o.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),c=32&t?{preventScroll:!0}:{},u=0,m=o.length;do{if(u>=m||u+m<=0)return 0;let e=d+u;if(16&t)e=(e+m)%m;else{if(e<0)return 3;if(e>=m)return 1}l=o[e],null==l||l.focus(c),u+=i}while(l!==s.activeElement);return 6&t&&function(e){var t,r;return null!=(r=null==(t=null==e?void 0:e.matches)?void 0:t.call(e,wt))&&r}(l)&&l.select(),2}function vt(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function jt(){return vt()||/Android/gi.test(window.navigator.userAgent)}function Nt(e,t,r,n){let s=ee(r);a.useEffect((()=>{if(e)return document.addEventListener(t,r,n),()=>document.removeEventListener(t,r,n);function r(e){s.current(e)}}),[e,t,n])}function St(e,t,r,n){let s=ee(r);a.useEffect((()=>{if(e)return window.addEventListener(t,r,n),()=>window.removeEventListener(t,r,n);function r(e){s.current(e)}}),[e,t,n])}function Et(e,t,r){let n=ee(r),s=a.useCallback((function(e,r){if(e.defaultPrevented)return;let a=r(e);if(null===a||!a.getRootNode().contains(a)||!a.isConnected)return;let s=function e(t){return"function"==typeof t?e(t()):Array.isArray(t)||t instanceof Set?t:[t]}(t);for(let t of s)if(null!==t&&(t.contains(a)||e.composed&&e.composedPath().includes(t)))return;return!function(e,t=0){var r;return e!==(null==(r=G(e))?void 0:r.body)&&ne(t,{0:()=>e.matches(xt),1(){let t=e;for(;null!==t;){if(t.matches(xt))return!0;t=t.parentElement}return!1}})}(a,ft.Loose)&&-1!==a.tabIndex&&e.preventDefault(),n.current(e,a)}),[n,t]),o=a.useRef(null);Nt(e,"pointerdown",(e=>{var t,r;jt()||(o.current=(null==(r=null==(t=e.composedPath)?void 0:t.call(e))?void 0:r[0])||e.target)}),!0),Nt(e,"pointerup",(e=>{if(jt()||!o.current)return;let t=o.current;return o.current=null,s(e,(()=>t))}),!0);let l=a.useRef({x:0,y:0});Nt(e,"touchstart",(e=>{l.current.x=e.touches[0].clientX,l.current.y=e.touches[0].clientY}),!0),Nt(e,"touchend",(e=>{let t=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY;if(!(Math.abs(t-l.current.x)>=30||Math.abs(r-l.current.y)>=30))return s(e,(()=>_e(e.target)?e.target:null))}),!0),St(e,"blur",(e=>s(e,(()=>function(e){return ye(e)&&"IFRAME"===e.nodeName}(window.document.activeElement)?window.document.activeElement:null))),!0)}function Ct(...e){return a.useMemo((()=>G(...e)),[...e])}function Pt(e,t,r,n){let s=ee(r);a.useEffect((()=>{function r(e){s.current(e)}return(e=null!=e?e:window).addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}),[e,t,n])}function $t(){let e;return{before({doc:t}){var r;let a=t.documentElement,n=null!=(r=t.defaultView)?r:window;e=Math.max(0,n.innerWidth-a.clientWidth)},after({doc:t,d:r}){let a=t.documentElement,n=Math.max(0,a.clientWidth-a.offsetWidth),s=Math.max(0,e-n);r.style(a,"paddingRight",`${s}px`)}}}function Ft(){return vt()?{before({doc:e,d:t,meta:r}){function a(e){return r.containers.flatMap((e=>e())).some((t=>t.contains(e)))}t.microTask((()=>{var r;if("auto"!==window.getComputedStyle(e.documentElement).scrollBehavior){let r=X();r.style(e.documentElement,"scrollBehavior","auto"),t.add((()=>t.microTask((()=>r.dispose()))))}let n=null!=(r=window.scrollY)?r:window.pageYOffset,s=null;t.addEventListener(e,"click",(t=>{if(_e(t.target))try{let r=t.target.closest("a");if(!r)return;let{hash:n}=new URL(r.href),o=e.querySelector(n);_e(o)&&!a(o)&&(s=o)}catch{}}),!0),t.addEventListener(e,"touchstart",(e=>{if(_e(e.target)&&function(e){return fe(e)&&"style"in e}(e.target))if(a(e.target)){let r=e.target;for(;r.parentElement&&a(r.parentElement);)r=r.parentElement;t.style(r,"overscrollBehavior","contain")}else t.style(e.target,"touchAction","none")})),t.addEventListener(e,"touchmove",(e=>{if(_e(e.target)){if(function(e){return ye(e)&&"INPUT"===e.nodeName}(e.target))return;if(a(e.target)){let t=e.target;for(;t.parentElement&&""!==t.dataset.headlessuiPortal&&!(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth);)t=t.parentElement;""===t.dataset.headlessuiPortal&&e.preventDefault()}else e.preventDefault()}}),{passive:!1}),t.add((()=>{var e;let t=null!=(e=window.scrollY)?e:window.pageYOffset;n!==t&&window.scrollTo(0,n),s&&s.isConnected&&(s.scrollIntoView({block:"nearest"}),s=null)}))}))}}:{}}function At(e){let t={};for(let r of e)Object.assign(t,r(t));return t}let Ot=function(e,t){let r=e(),a=new Set;return{getSnapshot:()=>r,subscribe:e=>(a.add(e),()=>a.delete(e)),dispatch(e,...n){let s=t[e].call(r,...n);s&&(r=s,a.forEach((e=>e())))}}}((()=>new Map),{PUSH(e,t){var r;let a=null!=(r=this.get(e))?r:{doc:e,count:0,d:X(),meta:new Set};return a.count++,a.meta.add(t),this.set(e,a),this},POP(e,t){let r=this.get(e);return r&&(r.count--,r.meta.delete(t)),this},SCROLL_PREVENT({doc:e,d:t,meta:r}){let a={doc:e,d:t,meta:At(r)},n=[Ft(),$t(),{before({doc:e,d:t}){t.style(e.documentElement,"overflow","hidden")}}];n.forEach((({before:e})=>null==e?void 0:e(a))),n.forEach((({after:e})=>null==e?void 0:e(a)))},SCROLL_ALLOW({d:e}){e.dispose()},TEARDOWN({doc:e}){this.delete(e)}});function Tt(e,t,r=()=>({containers:[]})){let n=function(e){return a.useSyncExternalStore(e.subscribe,e.getSnapshot,e.getSnapshot)}(Ot),s=t?n.get(t):void 0,o=!!s&&s.count>0;return Q((()=>{if(t&&e)return Ot.dispatch("PUSH",t,r),()=>Ot.dispatch("POP",t,r)}),[e,t]),o}Ot.subscribe((()=>{let e=Ot.getSnapshot(),t=new Map;for(let[r]of e)t.set(r,r.documentElement.style.overflow);for(let r of e.values()){let e="hidden"===t.get(r.doc),a=0!==r.count;(a&&!e||!a&&e)&&Ot.dispatch(r.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",r),0===r.count&&Ot.dispatch("TEARDOWN",r)}}));var Dt,Rt;"undefined"!=typeof process&&"undefined"!=typeof globalThis&&"undefined"!=typeof Element&&"test"===(null==(Dt=null==process?void 0:{})?void 0:Dt.NODE_ENV)&&void 0===(null==(Rt=null==Element?void 0:Element.prototype)?void 0:Rt.getAnimations)&&(Element.prototype.getAnimations=function(){return[]});var It=(e=>(e[e.None=0]="None",e[e.Closed=1]="Closed",e[e.Enter=2]="Enter",e[e.Leave=4]="Leave",e))(It||{});function Lt(e){let t={};for(let r in e)!0===e[r]&&(t[`data-${r}`]="");return t}function Wt(e,t,r,n){let[s,o]=a.useState(r),{hasFlag:l,addFlag:i,removeFlag:d}=function(e=0){let[t,r]=a.useState(e),n=a.useCallback((e=>r(e)),[t]),s=a.useCallback((e=>r((t=>t|e))),[t]),o=a.useCallback((e=>(t&e)===e),[t]),l=a.useCallback((e=>r((t=>t&~e))),[r]),i=a.useCallback((e=>r((t=>t^e))),[r]);return{flags:t,setFlag:n,addFlag:s,hasFlag:o,removeFlag:l,toggleFlag:i}}(e&&s?3:0),c=a.useRef(!1),u=a.useRef(!1),m=Z();return Q((()=>{var a;if(e)return r&&o(!0),t?(null==(a=null==n?void 0:n.start)||a.call(n,r),function(e,{prepare:t,run:r,done:a,inFlight:n}){let s=X();return function(e,{inFlight:t,prepare:r}){if(null!=t&&t.current)return void r();let a=e.style.transition;e.style.transition="none",r(),e.offsetHeight,e.style.transition=a}(e,{prepare:t,inFlight:n}),s.nextFrame((()=>{r(),s.requestAnimationFrame((()=>{s.add(function(e,t){var r,a;let n=X();if(!e)return n.dispose;let s=!1;n.add((()=>{s=!0}));let o=null!=(a=null==(r=e.getAnimations)?void 0:r.call(e).filter((e=>e instanceof CSSTransition)))?a:[];return 0===o.length?(t(),n.dispose):(Promise.allSettled(o.map((e=>e.finished))).then((()=>{s||t()})),n.dispose)}(e,a))}))})),s.dispose}(t,{inFlight:c,prepare(){u.current?u.current=!1:u.current=c.current,c.current=!0,!u.current&&(r?(i(3),d(4)):(i(4),d(2)))},run(){u.current?r?(d(3),i(4)):(d(4),i(3)):r?d(1):i(1)},done(){var e;u.current&&"function"==typeof t.getAnimations&&t.getAnimations().length>0||(c.current=!1,d(7),r||o(!1),null==(e=null==n?void 0:n.end)||e.call(n,r))}})):void(r&&i(3))}),[e,r,t,m]),e?[s,{closed:l(1),enter:l(2),leave:l(4),transition:l(2)||l(4)}]:[r,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function Mt(e,t){let r=a.useRef([]),n=te(e);a.useEffect((()=>{let e=[...r.current];for(let[a,s]of t.entries())if(r.current[a]!==s){let a=n(t,e);return r.current=t,a}}),[n,...t])}let zt=a.createContext(null);zt.displayName="OpenClosedContext";var qt=(e=>(e[e.Open=1]="Open",e[e.Closed=2]="Closed",e[e.Closing=4]="Closing",e[e.Opening=8]="Opening",e))(qt||{});function Yt(){return a.useContext(zt)}function Bt({value:e,children:t}){return n.createElement(zt.Provider,{value:e},t)}function Ht({children:e}){return n.createElement(zt.Provider,{value:null},e)}let Ut=[];function Jt(e){let t=te(e),r=a.useRef(!1);a.useEffect((()=>(r.current=!1,()=>{r.current=!0,K((()=>{r.current&&t()}))})),[t])}function Vt(){let e=function(){let e="undefined"==typeof document;return"useSyncExternalStore"in s&&s.useSyncExternalStore((()=>()=>{}),(()=>!1),(()=>!e))}(),[t,r]=a.useState(V.isHandoffComplete);return t&&!1===V.isHandoffComplete&&r(!1),a.useEffect((()=>{!0!==t&&r(!0)}),[t]),a.useEffect((()=>V.handoff()),[]),!e&&t}!function(e){function t(){"loading"!==document.readyState&&(e(),document.removeEventListener("DOMContentLoaded",t))}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("DOMContentLoaded",t),t())}((()=>{function e(e){if(!_e(e.target)||e.target===document.body||Ut[0]===e.target)return;let t=e.target;t=t.closest(xt),Ut.unshift(null!=t?t:e.target),Ut=Ut.filter((e=>null!=e&&e.isConnected)),Ut.splice(10)}window.addEventListener("click",e,{capture:!0}),window.addEventListener("mousedown",e,{capture:!0}),window.addEventListener("focus",e,{capture:!0}),document.body.addEventListener("click",e,{capture:!0}),document.body.addEventListener("mousedown",e,{capture:!0}),document.body.addEventListener("focus",e,{capture:!0})}));let Gt=a.createContext(!1);function Kt(){return a.useContext(Gt)}function Xt(e){return n.createElement(Gt.Provider,{value:e.force},e.children)}let Zt=a.Fragment,Qt=ue((function(e,t){let{ownerDocument:r=null,...n}=e,s=a.useRef(null),l=ke(function(e,t=!0){return Object.assign(e,{[we]:t})}((e=>{s.current=e})),t),i=Ct(s),d=null!=r?r:i,c=function(e){let t=Kt(),r=a.useContext(tr),[n,s]=a.useState((()=>{var a;if(!t&&null!==r)return null!=(a=r.current)?a:null;if(V.isServer)return null;let n=null==e?void 0:e.getElementById("headlessui-portal-root");if(n)return n;if(null===e)return null;let s=e.createElement("div");return s.setAttribute("id","headlessui-portal-root"),e.body.appendChild(s)}));return a.useEffect((()=>{null!==n&&(null!=e&&e.body.contains(n)||null==e||e.body.appendChild(n))}),[n,e]),a.useEffect((()=>{t||null!==r&&s(r.current)}),[r,s,t]),n}(d),[u]=a.useState((()=>{var e;return V.isServer?null:null!=(e=null==d?void 0:d.createElement("div"))?e:null})),m=a.useContext(rr),x=Vt();Q((()=>{!c||!u||c.contains(u)||(u.setAttribute("data-headlessui-portal",""),c.appendChild(u))}),[c,u]),Q((()=>{if(u&&m)return m.register(u)}),[m,u]),Jt((()=>{var e;!c||!u||(pe(u)&&c.contains(u)&&c.removeChild(u),c.childNodes.length<=0&&(null==(e=c.parentElement)||e.removeChild(c)))}));let g=le();return x&&c&&u?o.createPortal(g({ourProps:{ref:l},theirProps:n,slot:{},defaultTag:Zt,name:"Portal"}),u):null}));let er=a.Fragment,tr=a.createContext(null);let rr=a.createContext(null);function ar(){let e=a.useContext(rr),t=a.useRef([]),r=te((r=>(t.current.push(r),e&&e.register(r),()=>s(r)))),s=te((r=>{let a=t.current.indexOf(r);-1!==a&&t.current.splice(a,1),e&&e.unregister(r)})),o=a.useMemo((()=>({register:r,unregister:s,portals:t})),[r,s,t]);return[t,a.useMemo((()=>function({children:e}){return n.createElement(rr.Provider,{value:o},e)}),[o])]}let nr=ue((function(e,t){let r=ke(t),{enabled:a=!0,ownerDocument:s,...o}=e,l=le();return a?n.createElement(Qt,{...o,ownerDocument:s,ref:r}):l({ourProps:{ref:r},theirProps:o,slot:{},defaultTag:Zt,name:"Portal"})})),sr=ue((function(e,t){let{target:r,...a}=e,s={ref:ke(t)},o=le();return n.createElement(tr.Provider,{value:r},o({ourProps:s,theirProps:a,defaultTag:er,name:"Popover.Group"}))})),or=Object.assign(nr,{Group:sr});function lr(e,t=("undefined"!=typeof document?document.defaultView:null),r){let a=it(e,"escape");Pt(t,"keydown",(e=>{a&&(e.defaultPrevented||e.key===Ee.Escape&&r(e))}))}let ir=a.createContext(null);function dr({children:e,node:t}){let[r,s]=a.useState(null),o=cr(null!=t?t:r);return n.createElement(ir.Provider,{value:o},e,null===o&&n.createElement(be,{features:he.Hidden,ref:e=>{var t,r;if(e)for(let a of null!=(r=null==(t=G(e))?void 0:t.querySelectorAll("html > *, body > *"))?r:[])if(a!==document.body&&a!==document.head&&fe(a)&&null!=a&&a.contains(e)){s(a);break}}}))}function cr(e=null){var t;return null!=(t=a.useContext(ir))?t:e}function ur(){let e=a.useRef(!1);return Q((()=>(e.current=!0,()=>{e.current=!1})),[]),e}var mr=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(mr||{});function xr(e){if(!e)return new Set;if("function"==typeof e)return new Set(e());let t=new Set;for(let r of e.current)fe(r.current)&&t.add(r.current);return t}var gr=(e=>(e[e.None=0]="None",e[e.InitialFocus=1]="InitialFocus",e[e.TabLock=2]="TabLock",e[e.FocusLock=4]="FocusLock",e[e.RestoreFocus=8]="RestoreFocus",e[e.AutoFocus=16]="AutoFocus",e))(gr||{});let hr=ue((function(e,t){let r=a.useRef(null),s=ke(r,t),{initialFocus:o,initialFocusFallback:l,containers:i,features:d=15,...c}=e;Vt()||(d=0);let u=Ct(r);pr(d,{ownerDocument:u});let m=fr(d,{ownerDocument:u,container:r,initialFocus:o,initialFocusFallback:l});yr(d,{ownerDocument:u,container:r,containers:i,previousActiveElement:m});let x=function(){let e=a.useRef(0);return St(!0,"keydown",(t=>{"Tab"===t.key&&(e.current=t.shiftKey?1:0)}),!0),e}(),g=te((e=>{if(!ye(r.current))return;let t=r.current;ne(x.current,{[mr.Forwards]:()=>{kt(t,ht.First,{skipElements:[e.relatedTarget,l]})},[mr.Backwards]:()=>{kt(t,ht.Last,{skipElements:[e.relatedTarget,l]})}})})),h=it(!!(2&d),"focus-trap#tab-lock"),b=Z(),p=a.useRef(!1),f={ref:s,onKeyDown(e){"Tab"==e.key&&(p.current=!0,b.requestAnimationFrame((()=>{p.current=!1})))},onBlur(e){if(!(4&d))return;let t=xr(i);ye(r.current)&&t.add(r.current);let a=e.relatedTarget;_e(a)&&"true"!==a.dataset.headlessuiFocusGuard&&(_r(t,a)||(p.current?kt(r.current,ne(x.current,{[mr.Forwards]:()=>ht.Next,[mr.Backwards]:()=>ht.Previous})|ht.WrapAround,{relativeTo:e.target}):_e(e.target)&&_t(e.target)))}},y=le();return n.createElement(n.Fragment,null,h&&n.createElement(be,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:g,features:he.Focusable}),y({ourProps:f,theirProps:c,defaultTag:"div",name:"FocusTrap"}),h&&n.createElement(be,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:g,features:he.Focusable}))})),br=Object.assign(hr,{features:gr});function pr(e,{ownerDocument:t}){let r=!!(8&e),n=function(e=!0){let t=a.useRef(Ut.slice());return Mt((([e],[r])=>{!0===r&&!1===e&&K((()=>{t.current.splice(0)})),!1===r&&!0===e&&(t.current=Ut.slice())}),[e,Ut,t]),te((()=>{var e;return null!=(e=t.current.find((e=>null!=e&&e.isConnected)))?e:null}))}(r);Mt((()=>{r||(null==t?void 0:t.activeElement)===(null==t?void 0:t.body)&&_t(n())}),[r]),Jt((()=>{r&&_t(n())}))}function fr(e,{ownerDocument:t,container:r,initialFocus:n,initialFocusFallback:s}){let o=a.useRef(null),l=it(!!(1&e),"focus-trap#initial-focus"),i=ur();return Mt((()=>{if(0===e)return;if(!l)return void(null!=s&&s.current&&_t(s.current));let a=r.current;a&&K((()=>{if(!i.current)return;let r=null==t?void 0:t.activeElement;if(null!=n&&n.current){if((null==n?void 0:n.current)===r)return void(o.current=r)}else if(a.contains(r))return void(o.current=r);if(null!=n&&n.current)_t(n.current);else{if(16&e){if(kt(a,ht.First|ht.AutoFocus)!==bt.Error)return}else if(kt(a,ht.First)!==bt.Error)return;if(null!=s&&s.current&&(_t(s.current),(null==t?void 0:t.activeElement)===s.current))return}o.current=null==t?void 0:t.activeElement}))}),[s,l,e]),o}function yr(e,{ownerDocument:t,container:r,containers:a,previousActiveElement:n}){let s=ur(),o=!!(4&e);Pt(null==t?void 0:t.defaultView,"focus",(e=>{if(!o||!s.current)return;let t=xr(a);ye(r.current)&&t.add(r.current);let l=n.current;if(!l)return;let i=e.target;ye(i)?_r(t,i)?(n.current=i,_t(i)):(e.preventDefault(),e.stopPropagation(),_t(l)):_t(n.current)}),!0)}function _r(e,t){for(let r of e)if(r.contains(t))return!0;return!1}function wr(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||(null!=(t=e.as)?t:Er)!==a.Fragment||1===n.Children.count(e.children)}let kr=a.createContext(null);kr.displayName="TransitionContext";var vr=(e=>(e.Visible="visible",e.Hidden="hidden",e))(vr||{});let jr=a.createContext(null);function Nr(e){return"children"in e?Nr(e.children):e.current.filter((({el:e})=>null!==e.current)).filter((({state:e})=>"visible"===e)).length>0}function Sr(e,t){let r=ee(e),n=a.useRef([]),s=ur(),o=Z(),l=te(((e,t=oe.Hidden)=>{let a=n.current.findIndex((({el:t})=>t===e));-1!==a&&(ne(t,{[oe.Unmount](){n.current.splice(a,1)},[oe.Hidden](){n.current[a].state="hidden"}}),o.microTask((()=>{var e;!Nr(n)&&s.current&&(null==(e=r.current)||e.call(r))})))})),i=te((e=>{let t=n.current.find((({el:t})=>t===e));return t?"visible"!==t.state&&(t.state="visible"):n.current.push({el:e,state:"visible"}),()=>l(e,oe.Unmount)})),d=a.useRef([]),c=a.useRef(Promise.resolve()),u=a.useRef({enter:[],leave:[]}),m=te(((e,r,a)=>{d.current.splice(0),t&&(t.chains.current[r]=t.chains.current[r].filter((([t])=>t!==e))),null==t||t.chains.current[r].push([e,new Promise((e=>{d.current.push(e)}))]),null==t||t.chains.current[r].push([e,new Promise((e=>{Promise.all(u.current[r].map((([e,t])=>t))).then((()=>e()))}))]),"enter"===r?c.current=c.current.then((()=>null==t?void 0:t.wait.current)).then((()=>a(r))):a(r)})),x=te(((e,t,r)=>{Promise.all(u.current[t].splice(0).map((([e,t])=>t))).then((()=>{var e;null==(e=d.current.shift())||e()})).then((()=>r(t)))}));return a.useMemo((()=>({children:n,register:i,unregister:l,onStart:m,onStop:x,wait:c,chains:u})),[i,l,n,m,x,u,c])}jr.displayName="NestingContext";let Er=a.Fragment,Cr=se.RenderStrategy;let Pr=ue((function(e,t){let{show:r,appear:s=!1,unmount:o=!0,...l}=e,i=a.useRef(null),d=ke(...wr(e)?[i,t]:null===t?[]:[t]);Vt();let c=Yt();if(void 0===r&&null!==c&&(r=(c&qt.Open)===qt.Open),void 0===r)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[u,m]=a.useState(r?"visible":"hidden"),x=Sr((()=>{r||m("hidden")})),[g,h]=a.useState(!0),b=a.useRef([r]);Q((()=>{!1!==g&&b.current[b.current.length-1]!==r&&(b.current.push(r),h(!1))}),[b,r]);let p=a.useMemo((()=>({show:r,appear:s,initial:g})),[r,s,g]);Q((()=>{r?m("visible"):!Nr(x)&&null!==i.current&&m("hidden")}),[r,x]);let f={unmount:o},y=te((()=>{var t;g&&h(!1),null==(t=e.beforeEnter)||t.call(e)})),_=te((()=>{var t;g&&h(!1),null==(t=e.beforeLeave)||t.call(e)})),w=le();return n.createElement(jr.Provider,{value:x},n.createElement(kr.Provider,{value:p},w({ourProps:{...f,as:a.Fragment,children:n.createElement($r,{ref:d,...f,...l,beforeEnter:y,beforeLeave:_})},theirProps:{},defaultTag:a.Fragment,features:Cr,visible:"visible"===u,name:"Transition"})))})),$r=ue((function(e,t){var r,s;let{transition:o=!0,beforeEnter:l,afterEnter:i,beforeLeave:d,afterLeave:c,enter:u,enterFrom:m,enterTo:x,entered:g,leave:h,leaveFrom:b,leaveTo:p,...f}=e,[y,_]=a.useState(null),w=a.useRef(null),k=wr(e),v=ke(...k?[w,t,_]:null===t?[]:[t]),j=null==(r=f.unmount)||r?oe.Unmount:oe.Hidden,{show:N,appear:S,initial:E}=function(){let e=a.useContext(kr);if(null===e)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),[C,P]=a.useState(N?"visible":"hidden"),$=function(){let e=a.useContext(jr);if(null===e)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),{register:F,unregister:A}=$;Q((()=>F(w)),[F,w]),Q((()=>{if(j===oe.Hidden&&w.current)return N&&"visible"!==C?void P("visible"):ne(C,{hidden:()=>A(w),visible:()=>F(w)})}),[C,w,F,A,N,j]);let O=Vt();Q((()=>{if(k&&O&&"visible"===C&&null===w.current)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}),[w,C,O,k]);let T=E&&!S,D=S&&N&&E,R=a.useRef(!1),I=Sr((()=>{R.current||(P("hidden"),A(w))}),$),L=te((e=>{R.current=!0;let t=e?"enter":"leave";I.onStart(w,t,(e=>{"enter"===e?null==l||l():"leave"===e&&(null==d||d())}))})),W=te((e=>{let t=e?"enter":"leave";R.current=!1,I.onStop(w,t,(e=>{"enter"===e?null==i||i():"leave"===e&&(null==c||c())})),"leave"===t&&!Nr(I)&&(P("hidden"),A(w))}));a.useEffect((()=>{k&&o||(L(N),W(N))}),[N,k,o]);let M=!(!o||!k||!O||T),[,z]=Wt(M,y,N,{start:L,end:W}),q=me({ref:v,className:(null==(s=ae(f.className,D&&u,D&&m,z.enter&&u,z.enter&&z.closed&&m,z.enter&&!z.closed&&x,z.leave&&h,z.leave&&!z.closed&&b,z.leave&&z.closed&&p,!z.transition&&N&&g))?void 0:s.trim())||void 0,...Lt(z)}),Y=0;"visible"===C&&(Y|=qt.Open),"hidden"===C&&(Y|=qt.Closed),N&&"hidden"===C&&(Y|=qt.Opening),!N&&"visible"===C&&(Y|=qt.Closing);let B=le();return n.createElement(jr.Provider,{value:I},n.createElement(Bt,{value:Y},B({ourProps:q,theirProps:f,defaultTag:Er,features:Cr,visible:"visible"===C,name:"Transition.Child"})))})),Fr=ue((function(e,t){let r=null!==a.useContext(kr),s=null!==Yt();return n.createElement(n.Fragment,null,!r&&s?n.createElement(Pr,{ref:t,...e}):n.createElement($r,{ref:t,...e}))})),Ar=Object.assign(Pr,{Child:Fr,Root:Pr});var Or=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Or||{}),Tr=(e=>(e[e.SetTitleId=0]="SetTitleId",e))(Tr||{});let Dr={0:(e,t)=>e.titleId===t.id?e:{...e,titleId:t.id}},Rr=a.createContext(null);function Ir(e){let t=a.useContext(Rr);if(null===t){let t=new Error(`<${e} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,Ir),t}return t}function Lr(e,t){return ne(t.type,Dr,e,t)}Rr.displayName="DialogContext";let Wr=ue((function(e,t){let r=a.useId(),{id:s=`headlessui-dialog-${r}`,open:o,onClose:l,initialFocus:i,role:d="dialog",autoFocus:c=!0,__demoMode:u=!1,unmount:m=!1,...x}=e,g=a.useRef(!1);d="dialog"===d||"alertdialog"===d?d:(g.current||(g.current=!0),"dialog");let h=Yt();void 0===o&&null!==h&&(o=(h&qt.Open)===qt.Open);let b=a.useRef(null),p=ke(b,t),f=Ct(b),y=o?0:1,[_,w]=a.useReducer(Lr,{titleId:null,descriptionId:null,panelRef:a.createRef()}),k=te((()=>l(!1))),v=te((e=>w({type:0,id:e}))),j=!!Vt()&&0===y,[N,S]=ar(),E={get current(){var e;return null!=(e=_.panelRef.current)?e:b.current}},C=cr(),{resolveContainers:P}=function({defaultContainers:e=[],portals:t,mainTreeNode:r}={}){let a=Ct(r),n=te((()=>{var n,s;let o=[];for(let t of e)null!==t&&(fe(t)?o.push(t):"current"in t&&fe(t.current)&&o.push(t.current));if(null!=t&&t.current)for(let e of t.current)o.push(e);for(let e of null!=(n=null==a?void 0:a.querySelectorAll("html > *, body > *"))?n:[])e!==document.body&&e!==document.head&&fe(e)&&"headlessui-portal-root"!==e.id&&(r&&(e.contains(r)||e.contains(null==(s=null==r?void 0:r.getRootNode())?void 0:s.host))||o.some((t=>e.contains(t)))||o.push(e));return o}));return{resolveContainers:n,contains:te((e=>n().some((t=>t.contains(e)))))}}({mainTreeNode:C,portals:N,defaultContainers:[E]}),$=null!==h&&(h&qt.Closing)===qt.Closing;!function(e,{allowed:t,disallowed:r}={}){let a=it(e,"inert-others");Q((()=>{var e,n;if(!a)return;let s=X();for(let t of null!=(e=null==r?void 0:r())?e:[])t&&s.add(ut(t));let o=null!=(n=null==t?void 0:t())?n:[];for(let t of o){if(!t)continue;let e=G(t);if(!e)continue;let r=t.parentElement;for(;r&&r!==e.body;){for(let e of r.children)o.some((t=>e.contains(t)))||s.add(ut(e));r=r.parentElement}}return s.dispose}),[a,t,r])}(!u&&!$&&j,{allowed:te((()=>{var e,t;return[null!=(t=null==(e=b.current)?void 0:e.closest("[data-headlessui-portal]"))?t:null]})),disallowed:te((()=>{var e;return[null!=(e=null==C?void 0:C.closest("body > *:not(#headlessui-portal-root)"))?e:null]}))});let F=Ge.get(null);Q((()=>{if(j)return F.actions.push(s),()=>F.actions.pop(s)}),[F,s,j]);let A=ot(F,a.useCallback((e=>F.selectors.isTop(e,s)),[F,s]));Et(A,P,(e=>{e.preventDefault(),k()})),lr(A,null==f?void 0:f.defaultView,(e=>{e.preventDefault(),e.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur(),k()})),function(e,t,r=()=>[document.body]){Tt(it(e,"scroll-lock"),t,(e=>{var t;return{containers:[...null!=(t=e.containers)?t:[],r]}}))}(!u&&!$&&j,f,P),function(e,t,r){let n=ee((e=>{let t=e.getBoundingClientRect();0===t.x&&0===t.y&&0===t.width&&0===t.height&&r()}));a.useEffect((()=>{if(!e)return;let r=null===t?null:ye(t)?t:t.current;if(!r)return;let a=X();if("undefined"!=typeof ResizeObserver){let e=new ResizeObserver((()=>n.current(r)));e.observe(r),a.add((()=>e.disconnect()))}if("undefined"!=typeof IntersectionObserver){let e=new IntersectionObserver((()=>n.current(r)));e.observe(r),a.add((()=>e.disconnect()))}return()=>a.dispose()}),[t,n,e])}(j,b,k);let[O,T]=function(){let[e,t]=a.useState([]);return[e.length>0?e.join(" "):void 0,a.useMemo((()=>function(e){let r=te((e=>(t((t=>[...t,e])),()=>t((t=>{let r=t.slice(),a=r.indexOf(e);return-1!==a&&r.splice(a,1),r}))))),s=a.useMemo((()=>({register:r,slot:e.slot,name:e.name,props:e.props,value:e.value})),[r,e.slot,e.name,e.props,e.value]);return n.createElement(ve.Provider,{value:s},e.children)}),[t])]}(),D=a.useMemo((()=>[{dialogState:y,close:k,setTitleId:v,unmount:m},_]),[y,_,k,v,m]),R=a.useMemo((()=>({open:0===y})),[y]),I={ref:p,id:s,role:d,tabIndex:-1,"aria-modal":u?void 0:0===y||void 0,"aria-labelledby":_.titleId,"aria-describedby":O,unmount:m},L=!function(){var e;let[t]=a.useState((()=>"undefined"!=typeof window&&"function"==typeof window.matchMedia?window.matchMedia("(pointer: coarse)"):null)),[r,n]=a.useState(null!=(e=null==t?void 0:t.matches)&&e);return Q((()=>{if(t)return t.addEventListener("change",e),()=>t.removeEventListener("change",e);function e(e){n(e.matches)}}),[t]),r}(),W=gr.None;j&&!u&&(W|=gr.RestoreFocus,W|=gr.TabLock,c&&(W|=gr.AutoFocus),L&&(W|=gr.InitialFocus));let M=le();return n.createElement(Ht,null,n.createElement(Xt,{force:!0},n.createElement(or,null,n.createElement(Rr.Provider,{value:D},n.createElement(sr,{target:b},n.createElement(Xt,{force:!1},n.createElement(T,{slot:R},n.createElement(S,null,n.createElement(br,{initialFocus:i,initialFocusFallback:b,containers:P,features:W},n.createElement(Pe,{value:k},M({ourProps:I,theirProps:x,slot:R,defaultTag:Mr,features:zr,visible:0===y,name:"Dialog"})))))))))))})),Mr="div",zr=se.RenderStrategy|se.Static;let qr=ue((function(e,t){let{transition:r=!1,open:a,...s}=e,o=Yt(),l=e.hasOwnProperty("open")||null!==o,i=e.hasOwnProperty("onClose");if(!l&&!i)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!l)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!i)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!o&&"boolean"!=typeof e.open)throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${e.open}`);if("function"!=typeof e.onClose)throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${e.onClose}`);return void 0===a&&!r||s.static?n.createElement(dr,null,n.createElement(Wr,{ref:t,open:a,...s})):n.createElement(dr,null,n.createElement(Ar,{show:a,transition:r,unmount:s.unmount},n.createElement(Wr,{ref:t,...s})))})),Yr=ue((function(e,t){let r=a.useId(),{id:s=`headlessui-dialog-panel-${r}`,transition:o=!1,...l}=e,[{dialogState:i,unmount:d},c]=Ir("Dialog.Panel"),u=ke(t,c.panelRef),m=a.useMemo((()=>({open:0===i})),[i]),x=te((e=>{e.stopPropagation()})),g={ref:u,id:s,onClick:x},h=o?Fr:a.Fragment,b=o?{unmount:d}:{},p=le();return n.createElement(h,{...b},p({ourProps:g,theirProps:l,slot:m,defaultTag:"div",name:"Dialog.Panel"}))}));ue((function(e,t){let{transition:r=!1,...s}=e,[{dialogState:o,unmount:l}]=Ir("Dialog.Backdrop"),i=a.useMemo((()=>({open:0===o})),[o]),d={ref:t,"aria-hidden":!0},c=r?Fr:a.Fragment,u=r?{unmount:l}:{},m=le();return n.createElement(c,{...u},m({ourProps:d,theirProps:s,slot:i,defaultTag:"div",name:"Dialog.Backdrop"}))}));let Br=ue((function(e,t){let r=a.useId(),{id:n=`headlessui-dialog-title-${r}`,...s}=e,[{dialogState:o,setTitleId:l}]=Ir("Dialog.Title"),i=ke(t);a.useEffect((()=>(l(n),()=>l(null))),[n,l]);let d=a.useMemo((()=>({open:0===o})),[o]),c={ref:i,id:n};return le()({ourProps:c,theirProps:s,slot:d,defaultTag:"h2",name:"Dialog.Title"})})),Hr=Object.assign(qr,{Panel:Yr,Title:Br,Description:Se});const Ur=({recipientEmail:r,ccEmails:n,bccEmails:s,emailContent:o,sendingEmail:l,job:i,onClose:d,onSendEmail:c,onRecipientChange:u,onCCChange:m,onBCCChange:x,onContentChange:g})=>{const[h,b]=a.useState(!1),[p,w]=a.useState(!1),[k,v]=a.useState("visual"),[j,N]=a.useState(!1),[S,E]=a.useState(!1),[C,P]=a.useState(null),$=e=>{const t=e.split("\n");let r="",a=!1,n="",s=!1,o=!1,l=0;for(const i of t){const e=i.trim();if(e.startsWith('<div style="text-align: center'))a=!0,n=i,l=0;else if(a)n+="\n"+i,"</div>"===e&&(r+=n,a=!1,n="",l=0);else if(""===e)l++,1===l&&(r+="<br>");else if("Job Information:"===e)s=!0,l=0,r+=`<div style="margin-top: 16px; margin-bottom: 8px; font-weight: bold; color: #374151;">${e}</div>`;else if("Work Order Information:"===e)s=!1,o=!0,l=0,r+=`<div style="margin-top: 16px; margin-bottom: 8px; font-weight: bold; color: #374151;">${e}</div>`;else if(e.startsWith("•")){l=0;r+=`<div style="margin-left: 20px; margin-bottom: 4px; padding: 6px 10px; background-color: ${s?"#dbeafe":o?"#ecfdf5":"#f3f4f6"}; border-left: 3px solid ${s?"#3b82f6":o?"#10b981":"#6b7280"}; border-radius: 4px;">&bull; ${e.substring(1).trim()}</div>`}else e.startsWith("Dear")||e.startsWith("I hope")||e.startsWith("Please review")||e.startsWith("Thank you")?(l=0,r+=`<div style="margin-bottom: 12px; line-height: 1.5;">${e}</div>`):""!==e&&(l=0,e.startsWith("•")||e.includes("Information:")||(s=!1,o=!1),r+=`<div style="margin-bottom: 8px; line-height: 1.5;">${e}</div>`)}return r},[F,A]=a.useState(null),O=async()=>{if(!F){const t=await(async()=>{if(!i?.id)return null;try{const t=`${i.id}-${Date.now()}-${Math.random().toString(36).substring(2,15)}`,a=new Date(Date.now()+6048e5),n={items:i.work_order?.has_extra_charges?[{description:i.work_order.extra_charges_description||"Additional work required",cost:i.extra_charges_details?.bill_amount||0,hours:i.work_order.extra_hours||0}]:[],total:i.work_order?.has_extra_charges&&i.extra_charges_details?.bill_amount||0,job_details:{id:i.id,work_order_num:i.work_order_num,unit_number:i.unit_number,property:i.property}},{error:s}=await e.from("approval_tokens").insert({job_id:i.id,token:t,approval_type:"extra_charges",extra_charges_data:n,approver_email:r||"pending@example.com",approver_name:i.property?.name||"Property Manager",expires_at:a.toISOString()});return s?null:t}catch(t){return null}})();return t?(A(t),`${window.location.origin}/approval/${t}`):null}return`${window.location.origin}/approval/${F}`};a.useEffect((()=>{i?.id&&T(i.id)}),[i?.id]);const T=async t=>{E(!0);try{const{data:a,error:n}=await e.from("jobs").select("\n          id,\n          work_order_num,\n          unit_number,\n          description,\n          scheduled_date,\n          status,\n          property_id\n        ").eq("id",t).single();if(n)throw n;const{data:s,error:o}=await e.from("properties").select("\n          property_name,\n          address,\n          address_2,\n          city,\n          state,\n          zip,\n          ap_email\n        ").eq("id",a.property_id).single();if(o)throw o;const{data:l,error:i}=await e.from("work_orders").select("\n          id,\n          submission_date,\n          unit_number,\n          is_occupied,\n          is_full_paint,\n          job_category_id,\n          has_sprinklers,\n          sprinklers_painted,\n          painted_ceilings,\n          ceiling_rooms_count,\n          painted_patio,\n          painted_garage,\n          painted_cabinets,\n          painted_crown_molding,\n          painted_front_door,\n          has_accent_wall,\n          accent_wall_type,\n          accent_wall_count,\n          has_extra_charges,\n          extra_charges_description,\n          extra_hours,\n          additional_comments\n        ").eq("job_id",t);if(i)throw i;const d={id:a.id,work_order_num:a.work_order_num,unit_number:a.unit_number,description:a.description,scheduled_date:a.scheduled_date,status:a.status,property:{name:s.property_name,address:s.address,address_2:s.address_2,city:s.city,state:s.state,zip:s.zip,ap_email:s.ap_email},work_orders:l?.map((e=>({id:e.id,submission_date:e.submission_date,unit_number:e.unit_number,is_occupied:e.is_occupied,is_full_paint:e.is_full_paint,job_category:"Work Order",has_sprinklers:e.has_sprinklers,sprinklers_painted:e.sprinklers_painted,painted_ceilings:e.painted_ceilings,ceiling_rooms_count:e.ceiling_rooms_count,painted_patio:e.painted_patio,painted_garage:e.painted_garage,painted_cabinets:e.painted_cabinets,painted_crown_molding:e.painted_crown_molding,painted_front_door:e.painted_front_door,has_accent_wall:e.has_accent_wall,accent_wall_type:e.accent_wall_type,accent_wall_count:e.accent_wall_count,has_extra_charges:e.has_extra_charges,extra_charges_description:e.extra_charges_description,extra_hours:e.extra_hours,additional_comments:e.additional_comments})))||[]};P(d),!r&&s.ap_email&&u(s.ap_email)}catch(a){}finally{E(!1)}},D=async()=>{const e=await(async()=>{const e=await O();if(!e)return"";const t=i?.extra_charges_details?.bill_amount||50*(i?.work_order?.extra_hours||0)||0;return`\n<div style="text-align: center; margin: 30px 0; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">\n  <h3 style="margin: 0 0 15px 0; color: #1f2937;">One-Click Approval</h3>\n  <a href="${e}" \n     style="display: inline-block; background-color: #22c55e; color: white; padding: 15px 30px; \n            text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 16px;\n            margin: 10px 0;">\n    ✅ APPROVE EXTRA CHARGES${t>0?` - $${t.toFixed(2)}`:""}\n  </a>\n  <p style="margin: 15px 0 5px 0; font-size: 14px; color: #6b7280;">\n    Click the button above to approve these charges instantly and move the job to Work Order phase.\n  </p>\n  <p style="margin: 0; font-size: 12px; color: #9ca3af;">\n    Secure link • Expires in 7 days • You'll receive confirmation after approval\n  </p>\n</div>`})(),t=i?.work_order_num?`WO-${String(i.work_order_num).padStart(6,"0")}`:"[Work Order]";return`Dear Property Manager,\n\nI hope this email finds you well. I am writing to request your approval for additional charges related to ${t}.\n\n${i?`Job Information:\n• Work Order #: ${t}\n• Property: ${i.property?.name||"N/A"}\n• Address: ${i.property?.address||"N/A"}\n• Unit: ${i.unit_number||"N/A"}\n• Job Type: ${i.job_type?.label||"N/A"}\n• Phase: ${i.job_phase?.label||"N/A"}\n• Scheduled Date: ${i.scheduled_date?new Date(i.scheduled_date).toLocaleDateString():"N/A"}\n`:""}\n\n${i?.work_order?`Work Order Information:\n• Submission Date: ${i.work_order.submission_date?new Date(i.work_order.submission_date).toLocaleDateString():"N/A"}\n• Unit Occupied: ${i.work_order.is_occupied?"Yes":"No"}\n• Full Paint: ${i.work_order.is_full_paint?"Yes":"No"}\n• Extra Charges: ${i.work_order.has_extra_charges?"Yes":"No"}\n• Extra Hours: ${i.work_order.extra_hours||"0"}\n• Description: ${i.work_order.extra_charges_description||"N/A"}\n`:""}\n\n${e}\n\nPlease review these charges and let us know if you approve so we can proceed accordingly.\n\nThank you,\nJG Painting Pros Inc.`};return a.useEffect((()=>{(async()=>{if(i&&""===o){const e=await D();g(e)}})()}),[i,o,g]),t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Send Approval Request"}),t.jsx("button",{onClick:d,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx(f,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"space-y-4",children:[S&&t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent mr-3"}),t.jsx("span",{className:"text-blue-700 dark:text-blue-300 text-sm",children:"Loading detailed job information..."})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Recipient Email"}),t.jsx("input",{type:"email",value:r,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter recipient email"})]}),t.jsxs("div",{children:[t.jsx("button",{type:"button",onClick:()=>N(!j),className:"flex items-center text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:j?t.jsxs(t.Fragment,{children:[t.jsx(y,{className:"h-4 w-4 mr-1"}),"Hide CC/BCC"]}):t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"h-4 w-4 mr-1"}),"Add CC/BCC"]})}),j&&t.jsxs("div",{className:"mt-3 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"CC (optional)"}),t.jsx("input",{type:"text",value:n,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter CC emails (comma-separated)"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"BCC (optional)"}),t.jsx("input",{type:"text",value:s,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter BCC emails (comma-separated)"})]})]})]}),t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700/30 rounded-lg p-3 mb-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-200",children:[t.jsx("strong",{children:"Template:"})," Extra Charges Approval Email"]}),t.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-300",children:"💡 Use Visual tab to see how the email will look to recipients"})]})}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email Content"}),t.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[t.jsx("button",{onClick:()=>v("visual"),className:"px-3 py-1 text-xs font-medium rounded-md transition-colors "+("visual"===k?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:"Visual"}),t.jsx("button",{onClick:()=>v("code"),className:"px-3 py-1 text-xs font-medium rounded-md transition-colors "+("code"===k?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:"Code"})]})]}),"visual"===k?t.jsxs("div",{className:"border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 min-h-[300px] max-h-[400px] overflow-y-auto",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 border-b border-gray-200 dark:border-gray-600 text-xs text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[t.jsx("strong",{children:"To:"})," ",r||"recipient@example.com"]}),t.jsx("span",{className:"text-gray-400",children:"📧"})]}),n&&t.jsxs("div",{className:"mb-1",children:[t.jsx("strong",{children:"CC:"})," ",n]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Subject:"})," Extra Charges Approval Request - ",i?.work_order_num?`WO-${String(i.work_order_num).padStart(6,"0")}`:"Work Order"]})]}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"text-gray-900 dark:text-gray-100 text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:$(o)}})})]}):t.jsx("textarea",{id:"emailContent",name:"emailContent",value:o,onChange:e=>g(e.target.value),rows:12,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white font-mono text-sm",placeholder:"Email content will be generated automatically..."})]}),t.jsxs("div",{className:"flex justify-end space-x-4",children:[t.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600",children:"Preview Email"}),t.jsx("button",{onClick:()=>w(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm flex items-center",children:"Preview PDF"}),t.jsx("button",{onClick:c,disabled:l,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:l?"Sending...":"Send Email"})]})]}),h&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[150]",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Email Preview"}),t.jsx("button",{onClick:()=>b(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx(f,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 border border-gray-200 dark:border-gray-600 rounded-t-md text-xs text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[t.jsx("strong",{children:"To:"})," ",r||"recipient@example.com"]}),t.jsx("span",{className:"text-gray-400",children:"📧"})]}),n&&t.jsxs("div",{className:"mb-1",children:[t.jsx("strong",{children:"CC:"})," ",n]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Subject:"})," Extra Charges Approval Request - ",i?.work_order_num?`WO-${String(i.work_order_num).padStart(6,"0")}`:"Work Order"]})]}),t.jsx("div",{className:"border border-t-0 border-gray-200 dark:border-gray-600 rounded-b-md p-4 bg-white dark:bg-gray-800",children:t.jsx("div",{className:"text-gray-900 dark:text-gray-100 text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:$(o)}})})]})]})}),p&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[150]",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"PDF Preview"}),t.jsx("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Close"})]}),t.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:t.jsxs("div",{className:"bg-white p-6 border border-gray-200 rounded-md shadow-sm",style:{fontFamily:"Arial, sans-serif"},children:[t.jsxs("div",{className:"text-center mb-4 pb-4 border-b border-gray-200",children:[t.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"JG Painting Pros Inc."}),t.jsx("p",{className:"text-sm text-gray-600",children:"Extra Charges Approval Request"}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Work Order: ",i?.work_order_num?`WO-${String(i.work_order_num).padStart(6,"0")}`:"N/A"]})]}),t.jsx("div",{className:"text-gray-900 text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:$(o)}}),t.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 text-center",children:[t.jsx("p",{className:"text-xs text-gray-500",children:"This document was generated automatically by JG Painting Pros Inc."}),t.jsxs("p",{className:"text-xs text-gray-500",children:["Date: ",(new Date).toLocaleDateString()]})]})]})})]})})]})})},Jr=({isOpen:n,onClose:s,job:o,notificationType:l,onSent:i})=>{const[d,c]=a.useState(null),[u,m]=a.useState(""),[x,g]=a.useState(""),[h,b]=a.useState(""),[p,j]=a.useState(""),[N,S]=a.useState(""),[E,C]=a.useState(!1),[P,$]=a.useState(!0),[F,A]=a.useState("visual"),[O,T]=a.useState(!1),[D,R]=a.useState(!1);a.useEffect((()=>{n&&o&&(I(),L())}),[n,o,l]);const I=async()=>{try{$(!0);const{data:t,error:r}=await e.from("email_templates").select("*").eq("trigger_phase",l).eq("template_type","notification").single();if(r)throw r;if(c(t),t&&o){const e=W(t.subject,o),r=W(t.body,o);S(e),j(r)}}catch(t){r.error("Failed to load email template")}finally{$(!1)}},L=()=>{m(o?.property?.ap_email?o.property.ap_email:""),g(""),b("")},W=(e,t)=>{if(!e||!t)return e;const r=`${t.property.address}${t.property.address_2?`, ${t.property.address_2}`:""}, ${t.property.city}, ${t.property.state} ${t.property.zip}`,a=t.unit_number||"N/A",n=t.work_order_num?.toString()||t.id.slice(0,8);return e.replace(/\{\{property_address\}\}/g,r).replace(/\{\{unit_number\}\}/g,a).replace(/\{\{job_number\}\}/g,n).replace(/\{\{property_name\}\}/g,t.property.name||r)},M=e=>{if(!e)return"";const t=e.split("\n");let r="",a=0,n=!1,s=!1;for(const o of t){const e=o.trim();if(""===e)a++,1===a&&(r+="<br>");else if("Job Information:"===e||e.includes("Information:"))n="Job Information:"===e,s="Work Order Information:"===e,a=0,r+=`<div style="margin-top: 16px; margin-bottom: 8px; font-weight: bold; color: #374151;">${e}</div>`;else if(e.startsWith("•")){a=0;r+=`<div style="margin-left: 20px; margin-bottom: 4px; padding: 6px 10px; background-color: ${n?"#dbeafe":s?"#ecfdf5":"#f3f4f6"}; border-left: 3px solid ${n?"#3b82f6":s?"#10b981":"#6b7280"}; border-radius: 4px;">&bull; ${e.substring(1).trim()}</div>`}else e.startsWith("Dear")||e.startsWith("Hello")||e.startsWith("Hi")||e.startsWith("I hope")||e.startsWith("Please")||e.startsWith("Thank you")||e.startsWith("Thanks")?(a=0,r+=`<div style="margin-bottom: 12px; line-height: 1.5;">${e}</div>`):""!==e&&(a=0,e.startsWith("•")||e.includes("Information:")||(n=!1,s=!1),r+=`<div style="margin-bottom: 8px; line-height: 1.5;">${e}</div>`)}return r};return n?t.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[t.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Send ",(()=>{switch(l){case"sprinkler_paint":return"Sprinkler Paint";case"drywall_repairs":return"Drywall Repair";default:return"Notification"}})()," Notification"]}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:t.jsx(f,{className:"h-6 w-6"})})]}),t.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:P?t.jsxs("div",{className:"flex items-center justify-center py-8",children:[t.jsx(w,{className:"h-8 w-8 animate-spin text-blue-600"}),t.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Loading template..."})]}):t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["To: ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"email",value:u,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"recipient@example.com",required:!0})]}),t.jsxs("div",{children:[t.jsx("button",{type:"button",onClick:()=>T(!O),className:"flex items-center text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:O?t.jsxs(t.Fragment,{children:[t.jsx(y,{className:"h-4 w-4 mr-1"}),"Hide CC/BCC"]}):t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"h-4 w-4 mr-1"}),"Add CC/BCC"]})}),O&&t.jsxs("div",{className:"mt-3 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"CC:"}),t.jsx("input",{type:"email",value:x,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"cc1@example.com, cc2@example.com"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"BCC:"}),t.jsx("input",{type:"email",value:h,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"bcc1@example.com, bcc2@example.com"})]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Subject: ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",value:N,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Message: ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[t.jsx("button",{type:"button",onClick:()=>A("visual"),className:"px-3 py-1 text-xs font-medium rounded-md transition-colors "+("visual"===F?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:"Visual"}),t.jsx("button",{type:"button",onClick:()=>A("code"),className:"px-3 py-1 text-xs font-medium rounded-md transition-colors "+("code"===F?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:"Code"})]})]}),"visual"===F?t.jsxs("div",{className:"border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 min-h-[300px] max-h-[400px] overflow-y-auto",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 border-b border-gray-200 dark:border-gray-600 text-xs text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[t.jsx("strong",{children:"To:"})," ",u||"recipient@example.com"]}),t.jsx("span",{className:"text-gray-400",children:"📧"})]}),x&&t.jsxs("div",{className:"mb-1",children:[t.jsx("strong",{children:"CC:"})," ",x]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Subject:"})," ",N||"Notification Subject"]})]}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"text-gray-900 dark:text-gray-100 text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:M(p)}})})]}):t.jsx("textarea",{value:p,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white font-mono text-sm",rows:12,required:!0})]}),d?.auto_include_photos&&t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-md p-3",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(k,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-2"}),t.jsx("span",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Job photos will be automatically included with this notification"})]})})]})})}),t.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("button",{onClick:s,className:"px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700",disabled:E,children:"Cancel"}),t.jsx("button",{onClick:()=>R(!0),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600",children:"Preview Email"}),t.jsx("button",{onClick:async()=>{if(o&&u&&p&&N)try{C(!0);const t={to:u,cc:x||void 0,bcc:h||void 0,subject:N,content:p,job_id:o.id,template_type:l};if(d?.auto_include_photos&&o){const{data:r}=await e.from("job_images").select("*").eq("job_id",o.id).order("created_at",{ascending:!1});r&&r.length>0&&(t.content+="\n\n<p><em>Note: Job photos are attached to this email.</em></p>")}const{error:a}=await e.functions.invoke("send-notification-email",{body:t});if(a)throw a;await e.from("email_logs").insert({job_id:o?.id,recipient_email:u,cc_emails:x||null,bcc_emails:h||null,subject:N,template_type:l,sent_at:(new Date).toISOString()}),r.success("Notification sent successfully!"),i?.(),s()}catch(t){r.error("Failed to send notification")}finally{C(!1)}else r.error("Please fill in all required fields")},disabled:E||P||!u||!p||!N,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:E?t.jsxs(t.Fragment,{children:[t.jsx(w,{className:"h-4 w-4 animate-spin mr-2"}),"Sending..."]}):t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"h-4 w-4 mr-2"}),"Send Notification"]})})]})]}),D&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[150]",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Email Preview"}),t.jsx("button",{onClick:()=>R(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx(f,{className:"h-5 w-5"})})]}),t.jsxs("div",{className:"border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 border-b border-gray-200 dark:border-gray-600 text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("span",{children:[t.jsx("strong",{children:"To:"})," ",u||"recipient@example.com"]}),t.jsx("span",{className:"text-gray-400",children:"📧"})]}),x&&t.jsxs("div",{className:"mb-2",children:[t.jsx("strong",{children:"CC:"})," ",x]}),h&&t.jsxs("div",{className:"mb-2",children:[t.jsx("strong",{children:"BCC:"})," ",h]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Subject:"})," ",N||"Notification Subject"]})]}),t.jsx("div",{className:"p-6",children:t.jsx("div",{className:"text-gray-900 dark:text-gray-100 leading-relaxed",dangerouslySetInnerHTML:{__html:M(p)}})})]})]})})]}):null};function Vr(){const{jobId:n}=l(),s=i(),{job:o,loading:y,error:_,refetch:w}=function(t){const[r,n]=a.useState(null),[s,o]=a.useState(!0),[l,i]=a.useState(null),d=a.useRef(!0),c=a.useRef(0),u=a.useCallback((async()=>{if(!t)return n(null),void o(!1);const r=Date.now();if(!(r-c.current<5e3)){c.current=r;try{const{data:r,error:a}=await e.rpc("get_job_details",{p_job_id:t});if(a){if("401"===a.code||a.message?.includes("401")){const{data:r,error:s}=await e.from("jobs").select("*").eq("id",t).single();if(s)throw a;if(r)return n(r),void o(!1)}throw a}if(!r)throw new Error("Job not found");let s=null;if(r.assigned_to){const{data:t,error:a}=await e.from("profiles").select("full_name").eq("id",r.assigned_to).single();a||t&&(s=t.full_name)}const l={...r,assigned_to_name:s};d.current&&(n(l),i(null))}catch(a){d.current&&(i(a instanceof Error?a.message:"Failed to fetch job"),n(null))}finally{d.current&&o(!1)}}}),[t]),m=a.useCallback(x((()=>{d.current&&u()}),1e3),[u]);return a.useEffect((()=>{d.current=!0,u();const r=e.channel(`job-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"jobs",filter:`id=eq.${t}`},(e=>{d.current&&m()})).subscribe((e=>{})),a=e.channel(`work-order-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"work_orders",filter:`job_id=eq.${t}`},(e=>{d.current&&m()})).subscribe((e=>{})),n=e.channel(`phase-change-${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"job_phase_changes",filter:`job_id=eq.${t}`},(e=>{d.current&&u()})).subscribe((e=>{}));return()=>{d.current=!1,r.unsubscribe(),a.unsubscribe(),n.unsubscribe()}}),[t,u,m]),{job:r,loading:s,error:l,refetch:u}}(n),{phaseChanges:v,loading:U,error:J,refetch:V}=function(t){const[r,n]=a.useState([]),[s,o]=a.useState(!0),[l,i]=a.useState(null),d=a.useRef(!0),c=a.useRef(0),u=a.useCallback((async()=>{if(!t)return n([]),void o(!1);const r=Date.now();if(!(r-c.current<5e3)){c.current=r;try{const{data:r,error:a}=await e.rpc("get_job_phase_changes",{input_job_id:t});if(a)throw a;d.current&&(n(r||[]),i(null))}catch(a){d.current&&(i(a instanceof Error?a.message:"Failed to fetch phase changes"),n([]))}finally{d.current&&o(!1)}}}),[t]),m=a.useCallback(x((()=>{d.current&&u()}),1e3),[u]);return a.useEffect((()=>{d.current=!0,u();const r=e.channel(`job-${t}-phase-changes`).on("postgres_changes",{event:"*",schema:"public",table:"job_phase_changes",filter:`job_id=eq.${t}`},(()=>{d.current&&m()})).subscribe();return()=>{d.current=!1,r.unsubscribe()}}),[t,u,m]),{phaseChanges:r,loading:s,error:l,refetch:u}}(n),{phases:G,loading:K}=function(){const[t,r]=a.useState([]),[n,s]=a.useState(!0),[o,l]=a.useState(null),i=a.useRef(!0),d=a.useRef(0),c=a.useCallback((async()=>{const t=Date.now();if(!(t-d.current<1e4)){d.current=t;try{const{data:t,error:a}=await e.from("job_phases").select("*").neq("job_phase_label","Grading").order("sort_order");if(a)throw a;i.current&&(r(t||[]),l(null))}catch(a){i.current&&(l(a instanceof Error?a.message:"Failed to fetch phases"),r([]))}finally{i.current&&s(!1)}}}),[]),u=a.useCallback(x((()=>{i.current&&c()}),1e3),[c]);return a.useEffect((()=>{i.current=!0,c();const t=e.channel("job_phases_changes").on("postgres_changes",{event:"*",schema:"public",table:"job_phases"},(()=>{i.current&&u()})).subscribe();return()=>{i.current=!1,t.unsubscribe()}}),[c,u]),{phases:t,loading:n,error:o,refetch:c}}(),{isAdmin:X,isJGManagement:Z}=g(),[Q,ee]=a.useState(!1),[te,re]=a.useState([]),[ae,ne]=a.useState(!1),[se,oe]=a.useState(!1),[le,ie]=a.useState(null),[de,ce]=a.useState(""),[ue,me]=a.useState(!1),[xe,ge]=a.useState(!1),[he,be]=a.useState(!1),[pe,fe]=a.useState(!1),[ye,_e]=a.useState([]),[we,ke]=a.useState(null),[ve,je]=a.useState(!1),[Ne,Se]=a.useState(!1),[Ee,Ce]=a.useState(!1),[Pe,$e]=a.useState(""),[Fe,Ae]=a.useState(""),[Oe,Te]=a.useState(""),[De,Re]=a.useState(""),[Ie,Le]=a.useState(!0),[We,Me]=a.useState(!1),[ze,qe]=a.useState(!1),[Ye,Be]=a.useState(void 0),[He,Ue]=a.useState(!1),[Je,Ve]=a.useState(null),[Ge,Ke]=a.useState(!1),[Xe,Ze]=a.useState(null);a.useEffect((()=>{o?.property?.id&&Qe()}),[o]);const Qe=async()=>{if(o?.property?.id)try{const{data:t,error:r}=await e.from("files").select("*").eq("property_id",o.property.id).order("created_at",{ascending:!1});if(r)throw r;re(t||[])}catch(t){}};a.useEffect((()=>{}),[o]),a.useEffect((()=>{o?.property?.ap_email&&!Fe&&Ae(o.property.ap_email)}),[o?.property?.ap_email,Fe]),a.useEffect((()=>{(async()=>{if(!o||!n)return;const t=(o.billing_details?.bill_amount??0)+(o.work_order?.has_extra_charges&&o.work_order?.extra_hours?40*o.work_order.extra_hours:0);try{const{error:r}=await e.from("jobs").update({total_billing_amount:t}).eq("id",n);if(r)throw r}catch(r){}})()}),[o,n]),a.useEffect((()=>{o?.assigned_to&&ke(o.assigned_to),et()}),[o]),a.useEffect((()=>{(async()=>{if(!o?.work_order||!o?.property?.name)return;const t=`WO-${String(o.work_order_num).padStart(6,"0")}`,r=`/${o.property.name}/Work Orders/${t}`,{data:a,error:n}=await e.from("files").select("id").eq("path",r).eq("type","folder/directory").maybeSingle();!n&&a&&a.id?Ve(a.id):Ve(null)})()}),[o]);const et=async()=>{try{const{data:t,error:r}=await e.from("profiles").select("id, full_name").eq("role","subcontractor").order("full_name");if(r)throw r;_e(t||[])}catch(t){}},tt=e=>`WO-${String(e).padStart(6,"0")}`;if(y||K)return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(_||!o)return t.jsx("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A]",children:t.jsx("div",{className:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded",children:_||"Job not found"})});const rt=X||Z,at=(X||Z)&&"Job Request"===o.job_phase.label,nt=X&&"Job Request"===o.job_phase.label,st=X||Z,ot=!!o.work_order,lt="Job Request"===o.job_phase.label,it="Pending Work Order"===o.job_phase.label;o.job_phase.label;const dt="Invoicing"===o.job_phase.label;o.job_phase.label,o.job_phase.label;const ct=null!==o.billing_details?.bill_amount&&null!==o.billing_details?.sub_pay_amount&&void 0!==o.billing_details?.bill_amount&&void 0!==o.billing_details?.sub_pay_amount?o.billing_details.bill_amount-o.billing_details.sub_pay_amount:null,ut=o.extra_charges_details?.bill_amount??0,mt=o.extra_charges_details?.sub_pay_amount??0,xt=o.extra_charges_details?.profit_amount??0;o.extra_charges_details,o.extra_charges_details;const gt=G?G.filter((e=>"Pending Work Order"!==e.job_phase_label)):[],ht=gt.findIndex((e=>e.id===o.job_phase.id)),bt=async t=>{if(t){me(!0);try{const{data:a,error:s}=await e.auth.getUser();if(s)throw s;if(!a.user)throw new Error("User not found");const{error:l}=await e.from("jobs").update({current_phase_id:t.id}).eq("id",n);if(l)throw l;const{error:i}=await e.from("job_phase_changes").insert([{job_id:n,changed_by:a.user.id,from_phase_id:o.job_phase.id,to_phase_id:t.id,change_reason:`Phase changed by ${a.user.email}`}]);if(i)throw i;await w(),await V(),r.success("Job phase changed successfully")}catch(a){r.error(a instanceof Error?a.message:"Failed to change job phase")}finally{me(!1)}}};return t.jsxs("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A] min-h-screen",children:[t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>s("/dashboard/jobs"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:t.jsx(j,{className:"h-6 w-6"})}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:tt(o.work_order_num)}),t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:o.job_phase.color_dark_mode,color:"white"},children:o.job_phase.label})]}),t.jsxs("div",{className:"flex space-x-3",children:[rt&&!it&&t.jsxs(t.Fragment,{children:[!lt&&t.jsxs("button",{onClick:()=>{ht>0&&bt(gt[ht-1])},disabled:0===ht,className:"inline-flex items-center px-4 py-2 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:ht>0?gt[ht-1].color_dark_mode:"#6B7280"},children:[t.jsx(j,{className:"h-4 w-4 mr-2"}),"Previous: ",ht>0?gt[ht-1].job_phase_label:"N/A"]}),t.jsxs("button",{onClick:()=>{ht<gt.length-1&&bt(gt[ht+1])},disabled:ht===gt.length-1,className:"inline-flex items-center px-4 py-2 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:ht<gt.length-1?gt[ht+1].color_dark_mode:"#6B7280"},children:[t.jsx(N,{className:"h-4 w-4 mr-2"}),"Next: ",ht<gt.length-1?gt[ht+1].job_phase_label:"N/A"]})]}),at&&t.jsxs("button",{onClick:()=>s(`/dashboard/jobs/${n}/edit`),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(S,{className:"h-4 w-4 mr-2"}),"Edit Job"]}),ot&&t.jsxs(d,{to:`/dashboard/jobs/${n}/new-work-order?edit=true`,className:"inline-flex items-center px-4 py-2 text-white text-sm font-medium rounded-lg transition-colors",style:{backgroundColor:o.job_phase.color_dark_mode},children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),X||Z?"Edit Work Order":"View Work Order"]}),nt&&t.jsxs("button",{onClick:()=>oe(!0),className:"inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(C,{className:"h-4 w-4 mr-2"}),"Delete Job"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[t.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[t.jsxs("div",{className:"flex justify-between items-start mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Job Details"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Job Type:"}),t.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:o.job_type.label})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Property"}),t.jsxs("div",{className:"flex items-start",children:[t.jsx(P,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-0.5 mr-2"}),t.jsxs("div",{children:[t.jsx(d,{to:`/dashboard/properties/${o.property.id}`,className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:o.property.name}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[o.property.address,o.property.address_2&&t.jsxs("span",{children:[", ",o.property.address_2]}),t.jsx("br",{}),o.property.city,", ",o.property.state," ",o.property.zip]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Unit Information"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx($,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),t.jsxs("span",{className:"text-gray-900 dark:text-white",children:["Unit #",o.unit_number]})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(F,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),t.jsxs("span",{className:"text-gray-900 dark:text-white",children:["Size: ",o.unit_size.label]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Schedule"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx(A,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:c(o.scheduled_date)})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Assigned To"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(O,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:o.assigned_to?ye.find((e=>e.id===o.assigned_to))?.full_name||"Unknown":"Not assigned"})]}),st&&t.jsx(d,{to:`/dashboard/sub-scheduler?jobId=${n}`,className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:o.assigned_to?"Change":"Assign"})]})]})]}),t.jsx("div",{className:"mt-6 relative z-0",children:t.jsx(b,{address:`${o.property.address}${o.property.address_2?`, ${o.property.address_2}`:""}, ${o.property.city}, ${o.property.state} ${o.property.zip}`,className:"w-full h-[300px]",onMapClick:()=>{const e=document.querySelector(".leaflet-container");e&&e.classList.add("map-active")},onMapLoad:e=>{e.scrollWheelZoom.disable(),e.on("click",(()=>{e.scrollWheelZoom.enable()})),e.on("mouseout",(()=>{e.scrollWheelZoom.disable()}))}})}),o.description&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Description"}),t.jsx("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:o.description})]}),t.jsxs("div",{className:"mt-6 flex flex-wrap gap-4",children:[(X||Z)&&!ot&&t.jsxs(d,{to:`/dashboard/jobs/${n}/new-work-order`,className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),"Add Work Order"]}),!X&&!Z&&lt&&!ot&&t.jsxs(d,{to:`/dashboard/jobs/${n}/new-work-order`,className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),"Work Order"]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Phase History"}),t.jsx("button",{onClick:()=>be(!he),className:"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:he?"Show Less":"Show All"})]}),U?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):J?t.jsx("div",{className:"text-red-500 dark:text-red-400 text-sm",children:J}):0===v.length?t.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"No phase changes recorded"}):t.jsxs("div",{className:"space-y-4",children:[(he?v:v.slice(0,3)).map(((e,r)=>t.jsxs("div",{className:"relative pb-4",children:[r<v.length-1&&t.jsx("div",{className:"absolute left-4 top-4 h-full w-0.5 bg-gray-200 dark:bg-gray-700",style:{marginLeft:"0.5px"}}),t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"rounded-full h-9 w-9 flex items-center justify-center flex-shrink-0 z-10",style:{backgroundColor:e.to_phase_color||"#4B5563"},children:t.jsx(T,{className:"h-5 w-5 text-white"})}),t.jsxs("div",{className:"ml-4 flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.to_phase_label}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:c(e.changed_at)})]}),e.from_phase_label&&t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["From: ",e.from_phase_label]}),e.change_reason&&t.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:e.change_reason}),t.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["By: ",e.changed_by_name||"Unknown"]})]})]})]},e.id))),!he&&v.length>3&&t.jsx("button",{onClick:()=>be(!0),className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 w-full text-center mt-2",children:"Show More History"})]})]})]}),o.work_order&&t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg mb-6",children:[it&&o.work_order.has_extra_charges&&t.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700/30 text-yellow-800 dark:text-yellow-200 px-4 py-3 rounded-lg mb-6 relative z-[50]",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(D,{className:"h-5 w-5 mr-2 text-yellow-600 dark:text-yellow-400 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium",children:"Extra Charges Pending Approval"}),t.jsx("p",{className:"mt-1 text-sm",children:"This work order has extra charges that require approval before proceeding."}),t.jsx("div",{className:"mt-3 flex space-x-3",children:He?t.jsxs("button",{onClick:async()=>{if(o)try{const{data:t,error:r}=await e.from("job_phases").select("id").eq("job_phase_label","Work Order").single();if(r)throw r;if(!t)throw new Error("Work Order phase not found");const{error:a}=await e.from("jobs").update({current_phase_id:t.id}).eq("id",o.id);if(a)throw a;await w(),Ue(!1),alert("Extra charges approved successfully!")}catch(t){alert("Failed to approve extra charges. Please try again.")}},className:"inline-flex items-center px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(R,{className:"h-4 w-4 mr-2"}),"Approve Extra Charges"]}):t.jsxs("button",{onClick:()=>Ce(!0),className:"inline-flex items-center px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(k,{className:"h-4 w-4 mr-2"}),"Send Approval Email"]})})]})]})}),ot&&o.work_order?.has_sprinklers&&t.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700/30 text-blue-800 dark:text-blue-200 px-4 py-3 rounded-lg mb-6",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(k,{className:"h-5 w-5 mr-2 text-blue-600 dark:text-blue-400 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium",children:"Notification Actions"}),t.jsx("p",{className:"mt-1 text-sm",children:"Send notification emails to property managers about work progress."}),t.jsx("div",{className:"mt-3 flex space-x-3",children:t.jsxs("button",{onClick:()=>{Ze("sprinkler_paint"),Ke(!0)},className:"inline-flex items-center px-3 py-1.5 bg-orange-600 hover:bg-orange-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(k,{className:"h-4 w-4 mr-2"}),"Send Sprinkler Paint Notification"]})})]})]})}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-8",children:"Work Order Details"}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(I,{className:"h-5 w-5 mr-2 text-blue-500"}),"Work Order Details"]}),o.work_order&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.submission_date?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Submission Date"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.submission_date?"text-green-800 dark:text-green-200":""} mt-1`,children:c(o.work_order.submission_date)})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.is_occupied?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Occupied Unit"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.is_occupied?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.is_occupied?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.is_full_paint?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Full Paint"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.is_full_paint?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.is_full_paint?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.job_category?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Job Category"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.job_category?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.job_category||"N/A"})]})]})]}),t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(L,{className:"h-5 w-5 mr-2 text-blue-500"}),"Paint Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:`p-3 rounded-lg border ${void 0!==o.work_order.is_full_paint&&o.work_order.is_full_paint?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Full Paint"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.is_full_paint?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.is_full_paint?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.job_category?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Job Category"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.job_category?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.job_category||"N/A"})]})]})]}),ot&&o.work_order?.has_sprinklers&&t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(W,{className:"h-5 w-5 mr-2 text-blue-500"}),"Sprinkler Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.has_sprinklers?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Has Sprinklers"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.has_sprinklers?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.has_sprinklers?"Yes":"No"})]}),o.work_order.has_sprinklers&&t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.sprinklers_painted?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Sprinklers Painted"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.sprinklers_painted?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.sprinklers_painted?"Yes":"No"})]})]}),ot&&o.work_order?.has_sprinklers&&o.work_order?.id&&t.jsxs("div",{className:"mt-4",children:[t.jsx("h4",{className:"text-base font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Sprinkler Images"}),Je&&t.jsx(p,{workOrderId:Je,folder:"sprinkler"})]})]}),ot&&t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(M,{className:"h-5 w-5 mr-2 text-blue-500"}),"Painted Areas"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.painted_ceilings?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Ceilings"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.painted_ceilings?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.painted_ceilings?`Yes - ${o.work_order.ceiling_rooms_count} ceilings`:"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.painted_patio?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Patio"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.painted_patio?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.painted_patio?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.painted_garage?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Garage"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.painted_garage?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.painted_garage?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.painted_cabinets?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Cabinets"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.painted_cabinets?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.painted_cabinets?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.painted_crown_molding?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Crown Molding"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.painted_crown_molding?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.painted_crown_molding?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.painted_front_door?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Front Door"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.painted_front_door?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.painted_front_door?"Yes":"No"})]})]})]}),ot&&o.work_order?.has_accent_wall&&t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(z,{className:"h-5 w-5 mr-2 text-blue-500"}),"Accent Wall Details"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.accent_wall_type?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Type"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.accent_wall_type?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.accent_wall_type||"N/A"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.accent_wall_count>0?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Count"}),t.jsx("p",{className:`text-lg font-bold ${o.work_order.accent_wall_count>0?"text-green-800 dark:text-green-200":""} mt-1`,children:o.work_order.accent_wall_count||"N/A"})]})]})]}),ot&&o.work_order?.has_extra_charges&&t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(D,{className:"h-5 w-5 mr-2 text-blue-500"}),"Extra Charges"]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:`p-3 rounded-lg border ${o.work_order.has_extra_charges?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Has Extra Charges"}),t.jsx("p",{className:"text-sm font-bold "+(o.work_order.has_extra_charges?"text-green-800 dark:text-green-200":""),children:o.work_order.has_extra_charges?"Yes":"No"})]}),t.jsxs("div",{className:`p-3 rounded-lg border ${"number"==typeof o.work_order.extra_hours&&o.work_order.extra_hours>0?"border-green-500/50 bg-green-50 dark:bg-green-900/30":"border-gray-200 dark:border-gray-700"} flex flex-col justify-center`,children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Extra Hours"}),t.jsx("p",{className:`text-lg font-bold ${"number"==typeof o.work_order.extra_hours&&o.work_order.extra_hours>0?"text-green-800 dark:text-green-200":""} mt-1`,children:"number"==typeof o.work_order.extra_hours?o.work_order.extra_hours:"N/A"})]})]}),o.work_order.extra_charges_description&&t.jsxs("div",{className:"p-3 rounded-lg border border-green-500/50 bg-green-50 dark:bg-green-900/30 mt-6",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Description"}),t.jsx("p",{className:"text-lg font-bold text-green-800 dark:text-green-200 mt-1",children:o.work_order.extra_charges_description})]})]})]}),ot&&o.work_order?.additional_comments&&t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(q,{className:"h-5 w-5 mr-2 text-blue-500"}),"Additional Comments"]}),t.jsx("div",{className:"bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:t.jsx("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:o.work_order.additional_comments})})]}),ot&&o.work_order?.id&&t.jsxs("div",{className:"mb-8",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[t.jsx(Y,{className:"h-5 w-5 mr-2 text-blue-500"}),"Work Order Images"]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Before Images"}),Je&&t.jsx(p,{workOrderId:Je,folder:"before"})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Other Files"}),Je&&t.jsx(p,{workOrderId:Je,folder:"other"})]})]})]})]}),(X||Z)&&o.billing_details&&!lt&&t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg mb-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-8",children:"Billing Breakdown"}),t.jsxs("div",{className:"mb-6 text-gray-700 dark:text-gray-300",children:[t.jsxs("p",{className:"text-lg",children:["Unit Size: ",t.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:o.unit_size.label})]}),t.jsxs("p",{className:"text-lg mt-1",children:["Job Category: ",t.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:o.work_order?.job_category||"N/A"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:"p-3 rounded-lg border border-green-500/50",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Bill Amount"}),t.jsx("p",{className:"text-lg font-semibold text-green-600 dark:text-green-400 mt-1",children:null!==o.billing_details?.bill_amount?u(o.billing_details.bill_amount):"N/A"})]}),t.jsxs("div",{className:"p-3 rounded-lg border border-blue-500/50",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Subcontractor Pay"}),t.jsx("p",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 mt-1",children:null!==o.billing_details?.sub_pay_amount?u(o.billing_details.sub_pay_amount):"N/A"})]}),t.jsxs("div",{className:"p-3 rounded-lg border border-purple-500/50",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Profit"}),t.jsx("p",{className:`text-lg font-semibold ${null!==ct?ct>=0?"text-purple-600 dark:text-purple-400":"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"} mt-1`,children:null!==ct?u(ct):"N/A"})]})]}),ot&&o.work_order?.has_extra_charges&&o.work_order.extra_hours>0&&t.jsxs("div",{className:"mt-8",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Extra Charges Breakdown"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 dark:bg-[#0F172A] p-4 rounded-lg",children:[t.jsxs("div",{className:"p-3 rounded-lg border border-green-500/50",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Bill Amount"}),t.jsx("p",{className:"text-lg font-semibold text-green-600 dark:text-green-400 mt-1",children:u(ut)})]}),t.jsxs("div",{className:"p-3 rounded-lg border border-blue-500/50",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Sub Pay Amount"}),t.jsx("p",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400 mt-1",children:u(mt)})]}),t.jsxs("div",{className:"p-3 rounded-lg border border-purple-500/50",children:[t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Profit"}),t.jsx("p",{className:`text-lg font-semibold ${xt>=0?"text-purple-600 dark:text-purple-400":"text-red-600 dark:text-red-400"} mt-1`,children:u(xt)})]})]})]}),t.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Total to Invoice"}),t.jsx("span",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:u((o.billing_details?.bill_amount??0)+ut)})]}),o.billing_details&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700 space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-base font-medium text-gray-700 dark:text-gray-300",children:"Total Billing"}),t.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-white",children:u((o.billing_details?.bill_amount??0)+ut)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-base font-medium text-gray-700 dark:text-gray-300",children:"Total Subcontractor Pay"}),t.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-white",children:u((o.billing_details?.sub_pay_amount??0)+mt)})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-base font-medium text-gray-700 dark:text-gray-300",children:"Total Profit"}),t.jsx("span",{className:"text-base font-semibold "+(null!==ct?ct>=0?"text-purple-600 dark:text-purple-400":"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:u((o.billing_details?.bill_amount??0)-(o.billing_details?.sub_pay_amount??0)+xt)})]})]})]}),se&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Job"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Are you sure you want to delete this job? This action cannot be undone."}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>oe(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{if(n){ge(!0);try{const{error:t}=await e.from("job_phase_changes").delete().eq("job_id",n);if(t)throw t;const{error:a}=await e.from("work_orders").delete().eq("job_id",n);if(a)throw a;const{error:o}=await e.from("jobs").delete().eq("id",n);if(o)throw o;r.success("Job deleted successfully"),s("/dashboard/jobs")}catch(t){r.error(t instanceof Error?t.message:"Failed to delete job"),ge(!1)}}},disabled:xe,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:xe?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Deleting..."]}):"Delete Job"})]})]})}),ve&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Assign Subcontractor"}),t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{children:[t.jsx("label",{htmlFor:"subcontractor",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Subcontractor"}),t.jsxs("select",{id:"subcontractor",value:we||"",onChange:e=>ke(e.target.value),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select subcontractor"}),ye.map((e=>t.jsx("option",{value:e.id,children:e.full_name},e.id)))]})]})}),t.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>je(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{if(we){Se(!0);try{const{error:t}=await e.from("jobs").update({assigned_to:we}).eq("id",n);if(t)throw t;await w(),je(!1),r.success("Subcontractor assigned successfully")}catch(t){r.error(t instanceof Error?t.message:"Failed to assign subcontractor")}finally{Se(!1)}}},disabled:!we||Ne,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:Ne?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Assigning..."]}):"Assign Subcontractor"})]})]})}),Ee&&t.jsx(Ur,{recipientEmail:Fe,ccEmails:Oe,bccEmails:De,emailContent:Pe,sendingEmail:ze,job:o,onClose:()=>Ce(!1),onSendEmail:async()=>{if(Fe){qe(!0);try{alert("Email sent successfully!"),Ce(!1),Ue(!0)}catch(e){alert("Failed to send email. Please try again.")}finally{qe(!1)}}else alert("Please enter a recipient email address")},onRecipientChange:Ae,onCCChange:Te,onBCCChange:Re,onContentChange:$e}),We&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[150]",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"PDF Preview"}),t.jsx("button",{onClick:()=>{Me(!1),Be(void 0)},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx(f,{className:"h-5 w-5"})})]}),t.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:Ye?t.jsx("iframe",{src:Ye,className:"w-full h-[70vh]",title:"PDF Preview"}):t.jsx("div",{className:"flex items-center justify-center h-[70vh]",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}),t.jsx("div",{className:"flex justify-end mt-4",children:t.jsx("button",{onClick:()=>{Me(!1),Be(void 0)},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600",children:"Close"})})]})}),ot&&t.jsx("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg mb-6",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{children:ot&&t.jsxs(d,{to:`/dashboard/jobs/${n}/new-work-order?edit=true`,className:"inline-flex items-center px-4 py-2 text-white text-sm font-medium rounded-lg transition-colors",style:{backgroundColor:o.job_phase.color_dark_mode},children:[t.jsx(E,{className:"h-4 w-4 mr-2"}),X||Z?"Edit Work Order":"View Work Order"]})}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsxs("button",{onClick:async()=>{if(!o)return;const t=new h;let r=20;const a=20;if(t.setFontSize(20),t.text(`Work Order: ${tt(o.work_order_num)}`,a,r),r+=15,t.setFontSize(12),t.text(`Property: ${o.property.name}`,a,r),r+=10,t.text(`Unit: ${o.unit_number}`,a,r),r+=10,t.text(`Unit Size: ${o.unit_size.label}`,a,r),r+=10,t.text(`Job Type: ${o.job_type.label}`,a,r),r+=10,t.text(`Scheduled Date: ${c(o.scheduled_date)}`,a,r),r+=10,t.text(`Status: ${o.job_phase.label}`,a,r),r+=15,o.description){t.setFontSize(14),t.text("Description:",a,r),r+=10,t.setFontSize(12);const e=t.splitTextToSize(o.description,170);t.text(e,a,r),r+=7*e.length}if(o.work_order){if(r>180&&(t.addPage(),r=20),t.setFontSize(16),t.text("Work Order Details",a,r),r+=15,t.setFontSize(12),t.text(`Submission Date: ${c(o.work_order.submission_date)}`,a,r),r+=10,t.text("Occupied: "+(o.work_order.is_occupied?"Yes":"No"),a,r),r+=10,t.text("Full Paint: "+(o.work_order.is_full_paint?"Yes":"No"),a,r),r+=10,t.text(`Job Category: ${o.work_order.job_category}`,a,r),r+=15,o.work_order.has_sprinklers&&(t.text("Has Sprinklers: Yes",a,r),r+=10,t.text("Sprinklers Painted: "+(o.work_order.sprinklers_painted?"Yes":"No"),a,r),r+=10),o.work_order.painted_ceilings&&(t.text("Painted Ceilings: Yes",a,r),r+=10,t.text(`Ceiling Rooms: ${o.work_order.ceiling_rooms_count}`,a,r),r+=10),o.work_order.painted_patio&&(t.text("Painted Patio: Yes",a,r),r+=10),o.work_order.painted_garage&&(t.text("Painted Garage: Yes",a,r),r+=10),o.work_order.painted_cabinets&&(t.text("Painted Cabinets: Yes",a,r),r+=10),o.work_order.painted_crown_molding&&(t.text("Painted Crown Molding: Yes",a,r),r+=10),o.work_order.painted_front_door&&(t.text("Painted Front Door: Yes",a,r),r+=10),o.work_order.has_extra_charges){if(r>180&&(t.addPage(),r=20),r+=5,t.text("Has Extra Charges: Yes",a,r),r+=10,o.work_order.extra_charges_description){const e=t.splitTextToSize(o.work_order.extra_charges_description,170);t.text(e,a,r),r+=7*e.length}t.text(`Extra Hours: ${o.work_order.extra_hours||"N/A"}`,a,r),r+=10}if(o.work_order.additional_comments){r>180&&(t.addPage(),r=20),r+=5,t.text("Additional Comments:",a,r),r+=10;const e=t.splitTextToSize(o.work_order.additional_comments,170);t.text(e,a,r),r+=7*e.length}}if(o.billing_details&&(r>180&&(t.addPage(),r=20),t.setFontSize(16),t.text("Billing Details",a,r),r+=15,t.setFontSize(12),t.text(`Bill Amount: ${u(o.billing_details.bill_amount)}`,a,r),r+=10,t.text(`Subcontractor Pay: ${u(o.billing_details.sub_pay_amount)}`,a,r),r+=10,null!==o.billing_details.profit_amount&&(t.text(`Profit: ${u(o.billing_details.profit_amount)}`,a,r),r+=10),o.extra_charges_details&&(r+=5,t.text("Extra Charges Billing:",a,r),r+=10,t.text(`Hours: ${o.extra_charges_details.hours||0}`,a,r),r+=10,t.text(`Bill Amount: ${u(o.extra_charges_details.bill_amount)}`,a,r),r+=10,t.text(`Subcontractor Pay: ${u(o.extra_charges_details.sub_pay_amount)}`,a,r),r+=10,null!==o.extra_charges_details.profit_amount&&(t.text(`Profit: ${u(o.extra_charges_details.profit_amount)}`,a,r),r+=10))),o.work_order?.id)try{const{data:s,error:l}=await e.storage.from("work_orders").list(`${o.work_order.id}`);if(!l&&s&&s.length>0){r>130&&(t.addPage(),r=20),t.setFontSize(16),t.text("Job Images",a,r),r+=15;for(const l of s){const{data:s}=await e.storage.from("work_orders").getPublicUrl(`${o.work_order.id}/${l.name}`);if(s)try{const e=new Y;e.src=s.publicUrl,await new Promise((t=>{e.onload=t}));const n=170,o=100;let l=e.width,i=e.height;l>n&&(i=n*i/l,l=n),i>o&&(l=o*l/i,i=o),r+i>260&&(t.addPage(),r=20),t.addImage(e,"JPEG",a,r,l,i),r+=i+10}catch(n){}}}}catch(n){}t.save(`work-order-${o.work_order_num}.pdf`)},className:"inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[t.jsx(B,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),t.jsxs("button",{onClick:()=>window.print(),className:"inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:[t.jsx(H,{className:"h-4 w-4 mr-2"}),"Print"]})]})]})}),dt&&t.jsx("div",{className:"flex justify-end mb-6",children:t.jsxs("button",{onClick:async()=>{try{if(!o)return;const e=new h;let t=20;const r=20,a=new window.Image;a.src="https://tbwtfimnbmvbgesidbxh.supabase.co/storage/v1/object/public/files/fb38963b-c67e-4924-860b-312045d19d2f/1750132407578_jg-logo-icon.png";let n=!1;await new Promise((e=>{a.onload=()=>{n=!0,e()},setTimeout((()=>{n||e()}),2e3)})),n&&(e.addImage(a,"PNG",r,t,17,17),t+=35),e.setFontSize(22),e.text("INVOICE",r,t),t+=15,e.setFontSize(10),e.text(`Date: ${c((new Date).toISOString())}`,r,t),t+=6,e.text(`Invoice #: ${tt(o.work_order_num)}`,r,t),t+=6,e.text(`Property: ${o.property.name}`,r,t),t+=6,e.text(`Unit: ${o.unit_number}`,r,t),t+=6,e.text(`Address: ${m(o.property)}`,r,t),t+=6,e.text(`Job Type: ${o.job_type.label}`,r,t),t+=10,e.setFontSize(12),e.text("Billing Breakdown",r,t),t+=6,e.setFontSize(9);let s=t;e.text("Description",r,s),e.text("Amount",r+120,s),s+=6,e.setLineWidth(.1),e.line(r,s,r+170,s),s+=4;const l=`${o.work_order?.job_category||"Standard Paint"} - ${o.unit_size.label}`;if(e.text(l,r,s),e.text(`${u(o.billing_details?.bill_amount??0)}`,r+120,s),s+=6,o.work_order?.has_extra_charges&&o.work_order.extra_hours&&o.work_order.extra_hours>0){const t=o.work_order.extra_charges_description||"Extra Charges",a=o.work_order.extra_hours,n=40,l=`Extra Charges: ${t}`,i=e.splitTextToSize(l,110);e.text(i,r,s),e.text(`${u(a*n)}`,r+120,s),s+=6*i.length}s+=4,e.setFontSize(10),e.text("Total",r,s);let i=o.billing_details?.bill_amount??0;o.work_order?.has_extra_charges&&o.work_order.extra_hours&&o.work_order.extra_hours>0&&(i+=40*o.work_order.extra_hours),e.text(`${u(i)}`,r+120,s),s+=15,e.setFontSize(9),e.text("Thank you for your business!",r,s),e.addPage();let d=20;if(e.setFontSize(14),e.text("Work Order Information",r,d),d+=8,e.setFontSize(9),e.text(`Work Order #: ${tt(o.work_order_num)}`,r,d),d+=6,e.text(`Property: ${o.property.name}`,r,d),d+=6,e.text(`Unit: ${o.unit_number}`,r,d),d+=6,e.text(`Unit Size: ${o.unit_size.label}`,r,d),d+=6,e.text(`Job Type: ${o.job_type.label}`,r,d),d+=6,e.text(`Scheduled Date: ${c(o.scheduled_date)}`,r,d),d+=6,e.text(`Status: ${o.job_phase.label}`,r,d),d+=8,o.work_order){if(e.setFontSize(11),e.text("Work Order Details",r,d),d+=6,e.setFontSize(9),e.text(`Submission Date: ${c(o.work_order.submission_date)}`,r,d),d+=6,e.text("Occupied: "+(o.work_order.is_occupied?"Yes":"No"),r,d),d+=6,e.text("Full Paint: "+(o.work_order.is_full_paint?"Yes":"No"),r,d),d+=6,e.text(`Job Category: ${o.work_order.job_category}`,r,d),d+=6,o.work_order.has_sprinklers&&(e.text("Has Sprinklers: Yes",r,d),d+=6,e.text("Sprinklers Painted: "+(o.work_order.sprinklers_painted?"Yes":"No"),r,d),d+=6),o.work_order.painted_ceilings&&(e.text("Painted Ceilings: Yes",r,d),d+=6,e.text(`Ceiling Rooms: ${o.work_order.ceiling_rooms_count}`,r,d),d+=6),o.work_order.painted_patio&&(e.text("Painted Patio: Yes",r,d),d+=6),o.work_order.painted_garage&&(e.text("Painted Garage: Yes",r,d),d+=6),o.work_order.painted_cabinets&&(e.text("Painted Cabinets: Yes",r,d),d+=6),o.work_order.painted_crown_molding&&(e.text("Painted Crown Molding: Yes",r,d),d+=6),o.work_order.painted_front_door&&(e.text("Painted Front Door: Yes",r,d),d+=6),o.work_order.has_accent_wall&&(e.text(`Accent Wall: ${o.work_order.accent_wall_type||""} (${o.work_order.accent_wall_count||1})`,r,d),d+=6),o.work_order.has_extra_charges){if(e.text("Has Extra Charges: Yes",r,d),d+=6,o.work_order.extra_charges_description){const t=e.splitTextToSize(o.work_order.extra_charges_description,170);e.text(t,r,d),d+=6*t.length}e.text(`Extra Hours: ${o.work_order.extra_hours||"N/A"}`,r,d),d+=6}if(o.work_order.additional_comments){e.text("Additional Comments:",r,d),d+=6;const t=e.splitTextToSize(o.work_order.additional_comments,170);e.text(t,r,d),d+=6*t.length}}e.save(`invoice-${o.work_order_num}.pdf`)}catch(e){alert("Failed to generate invoice PDF. Please try again.")}},className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:[t.jsx(H,{className:"h-4 w-4 mr-2"}),"Print Invoice"]})}),Ge&&Xe&&t.jsx(Jr,{isOpen:Ge,onClose:()=>{Ke(!1),Ze(null)},job:o,notificationType:Xe,onSent:()=>{r.success("Notification sent successfully"),Ke(!1),Ze(null)}})]}),t.jsxs("button",{onClick:()=>ee(!0),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:[t.jsx(I,{className:"-ml-1 mr-2 h-5 w-5"}),"Property Files"]}),t.jsxs(Hr,{open:Q,onClose:()=>ee(!1),children:[t.jsx("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),t.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:t.jsxs(Hr.Panel,{className:"mx-auto max-w-3xl rounded bg-white p-6",children:[t.jsx(Hr.Title,{className:"text-lg font-medium mb-4",children:"Property Files"}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:te.map((e=>t.jsxs("div",{className:"relative flex items-center space-x-3 rounded-lg border border-gray-300 bg-white px-6 py-5 shadow-sm hover:border-gray-400",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(I,{className:"h-6 w-6 text-gray-400"})}),t.jsx("div",{className:"min-w-0 flex-1",children:t.jsxs("a",{href:e.path,target:"_blank",rel:"noopener noreferrer",className:"focus:outline-none",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsx("p",{className:"truncate text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]})})]},e.id)))}),t.jsx("div",{className:"mt-6 flex justify-end",children:t.jsx("button",{onClick:()=>ee(!1),className:"rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:"Close"})})]})})]})]})}export{Vr as JobDetails};
