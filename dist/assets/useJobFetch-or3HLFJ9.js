import{j as e,b as t,s}from"./index-BXIsiie0.js";import{r as a,L as r}from"./react-vendor--AdGielI.js";import{f as n,c as l,p as c,a as o,P as i}from"./utils-D-HhOMZR.js";import{E as d}from"./pdf-COdhzFmg.js";import{c as u}from"./supabase-Dq0wjmmz.js";import{e as x,a3 as h,A as m,N as p,P as g,Z as b,b as y,m as j,p as k,o as _,$ as f}from"./ui-a3QeRpHh.js";function w(e){return`WO-${String(e).padStart(6,"0")}`}function N(e){try{return o(c(e),"America/New_York","MMM d, yyyy")}catch(t){return e}}function v({title:o,jobs:v,loading:C,error:D,showAddButton:A=!1,addButtonLink:S="/dashboard/jobs/new",isArchive:E=!1,refetch:P}){const[R,z]=a.useState(""),[T,O]=a.useState(!1),[F,I]=a.useState(!1),[B,W]=a.useState(null),[J,$]=a.useState((()=>{const e=localStorage.getItem("jobExportConfig");if(e)try{return JSON.parse(e)}catch(t){}return{dateRange:{startDate:n(l(new Date,1),"yyyy-MM-dd"),endDate:n(new Date,"yyyy-MM-dd")},columns:{workOrder:!0,phase:!0,property:!0,address:!0,unitNumber:!0,unitSize:!0,jobType:!0,scheduledDate:!0,dueDate:!1,completedDate:!1,description:!1,status:!1,amount:!0,createdBy:!1,assignedTo:!1,createdAt:!1,updatedAt:!1,submissionDate:!1,isOccupied:!1,isFullPaint:!1,paintType:!1,hasSprinklers:!1,sprinklersPainted:!1,paintedCeilings:!1,ceilingRoomsCount:!1,paintedPatio:!1,paintedGarage:!1,paintedCabinets:!1,paintedCrownMolding:!1,paintedFrontDoor:!1,cabinetRemovalRepair:!1,ceilingLightsRepair:!1,hasAccentWall:!1,accentWallType:!1,accentWallCount:!1,hasExtraCharges:!1,extraChargesDescription:!1,extraHours:!1,additionalComments:!1}}})),[L,M]=a.useState({jobInfo:!0,workOrderInfo:!1}),[U,Y]=a.useState({field:"scheduled_date",direction:"asc"}),[H,G]=a.useState([]),[q,Z]=a.useState(!1),[X,V]=a.useState(!1),[Q,K]=a.useState(!1),[ee,te]=a.useState(!1),[se,ae]=a.useState(!1),re=e=>{Y((t=>({field:e,direction:t.field===e&&"asc"===t.direction?"desc":"asc"})))},ne=e=>{W(e),I(!0),O(!1)},le=e=>{M((t=>({...t,[e]:!t[e]})))},ce=(e,t)=>{$((s=>{const a={...s.columns};if("jobInfo"===e){["workOrder","phase","property","address","unitNumber","unitSize","jobType","scheduledDate","dueDate","completedDate","description","status","amount","createdBy","assignedTo","createdAt","updatedAt"].forEach((e=>{a[e]=t}))}else{["submissionDate","isOccupied","isFullPaint","paintType","hasSprinklers","sprinklersPainted","paintedCeilings","ceilingRoomsCount","paintedPatio","paintedGarage","paintedCabinets","paintedCrownMolding","paintedFrontDoor","cabinetRemovalRepair","ceilingLightsRepair","hasAccentWall","accentWallType","accentWallCount","hasExtraCharges","extraChargesDescription","extraHours","additionalComments"].forEach((e=>{a[e]=t}))}return{...s,columns:a}}))},oe=()=>{const e=de.filter((e=>{const t=c(e.scheduled_date),s=c(J.dateRange.startDate),a=c(J.dateRange.endDate);return t>=s&&t<=a})).map((e=>{const t={},s=e.work_orders?.[0];var a;return J.columns.workOrder&&(t["Work Order #"]=w(e.work_order_num)),J.columns.phase&&(t.Phase=e.job_phase?.job_phase_label||""),J.columns.property&&(t.Property=e.property.property_name),J.columns.address&&(t.Address=[(a=e.property).address,a.city,a.state].filter(Boolean).join(", ")),J.columns.unitNumber&&(t["Unit #"]=e.unit_number),J.columns.unitSize&&(t["Unit Size"]=e.unit_size.unit_size_label),J.columns.jobType&&(t["Job Type"]=e.job_type.job_type_label),J.columns.scheduledDate&&(t["Scheduled Date"]=N(e.scheduled_date)),J.columns.dueDate&&e.due_date&&(t["Due Date"]=N(e.due_date)),J.columns.completedDate&&e.completed_date&&(t["Completed Date"]=N(e.completed_date)),J.columns.description&&e.description&&(t.Description=e.description),J.columns.status&&e.status&&(t.Status=e.status),J.columns.amount&&(t.Amount=e.total_billing_amount?`$${e.total_billing_amount.toFixed(2)}`:"$0.00"),J.columns.createdBy&&e.created_by&&(t["Created By"]=e.created_by),J.columns.assignedTo&&e.assigned_to&&(t["Assigned To"]=e.assigned_to),J.columns.createdAt&&e.created_at&&(t["Created At"]=N(e.created_at)),J.columns.updatedAt&&e.updated_at&&(t["Updated At"]=N(e.updated_at)),s&&(J.columns.submissionDate&&s.submission_date&&(t["Submission Date"]=N(s.submission_date)),J.columns.isOccupied&&(t["Is Occupied"]=s.is_occupied?"Yes":"No"),J.columns.isFullPaint&&(t["Full Paint"]=s.is_full_paint?"Yes":"No"),J.columns.paintType&&s.paint_type&&(t["Paint Type"]=s.paint_type),J.columns.hasSprinklers&&(t["Has Sprinklers"]=s.has_sprinklers?"Yes":"No"),J.columns.sprinklersPainted&&(t["Sprinklers Painted"]=s.sprinklers_painted?"Yes":"No"),J.columns.paintedCeilings&&(t["Painted Ceilings"]=s.painted_ceilings?"Yes":"No"),J.columns.ceilingRoomsCount&&s.ceiling_rooms_count&&(t["Ceiling Rooms Count"]=String(s.ceiling_rooms_count)),J.columns.paintedPatio&&(t["Painted Patio"]=s.painted_patio?"Yes":"No"),J.columns.paintedGarage&&(t["Painted Garage"]=s.painted_garage?"Yes":"No"),J.columns.paintedCabinets&&(t["Painted Cabinets"]=s.painted_cabinets?"Yes":"No"),J.columns.paintedCrownMolding&&(t["Painted Crown Molding"]=s.painted_crown_molding?"Yes":"No"),J.columns.paintedFrontDoor&&(t["Painted Front Door"]=s.painted_front_door?"Yes":"No"),J.columns.cabinetRemovalRepair&&s.cabinet_removal_repair&&(t["Cabinet Removal/Repair"]=s.cabinet_removal_repair),J.columns.ceilingLightsRepair&&s.ceiling_lights_repair&&(t["Ceiling Lights Repair"]=s.ceiling_lights_repair),J.columns.hasAccentWall&&(t["Has Accent Wall"]=s.has_accent_wall?"Yes":"No"),J.columns.accentWallType&&s.accent_wall_type&&(t["Accent Wall Type"]=s.accent_wall_type),J.columns.accentWallCount&&s.accent_wall_count&&(t["Accent Wall Count"]=String(s.accent_wall_count)),J.columns.hasExtraCharges&&(t["Has Extra Charges"]=s.has_extra_charges?"Yes":"No"),J.columns.extraChargesDescription&&s.extra_charges_description&&(t["Extra Charges Description"]=s.extra_charges_description),J.columns.extraHours&&s.extra_hours&&(t["Extra Hours"]=String(s.extra_hours)),J.columns.additionalComments&&s.additional_comments&&(t["Additional Comments"]=s.additional_comments)),t})),t=i.unparse(e),s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(s),a.download=`${o.toLowerCase().replace(/\s+/g,"_")}_${n(new Date,"yyyy-MM-dd")}.csv`,a.click()},ie=()=>{const e=new d,t=de.filter((e=>{const t=c(e.scheduled_date),s=c(J.dateRange.startDate),a=c(J.dateRange.endDate);return t>=s&&t<=a})),s=[],a=[];J.columns.workOrder&&(s.push("WO #"),a.push(20)),J.columns.phase&&(s.push("Phase"),a.push(25)),J.columns.property&&(s.push("Property"),a.push(35)),J.columns.unitNumber&&(s.push("Unit #"),a.push(15)),J.columns.unitSize&&(s.push("Size"),a.push(15)),J.columns.jobType&&(s.push("Type"),a.push(20)),J.columns.scheduledDate&&(s.push("Work Order Date"),a.push(25)),J.columns.amount&&(s.push("Amount"),a.push(20));const r=t.map((e=>{const t=[];return J.columns.workOrder&&t.push(w(e.work_order_num)),J.columns.phase&&t.push(e.job_phase?.job_phase_label||""),J.columns.property&&t.push(e.property.property_name),J.columns.unitNumber&&t.push(e.unit_number),J.columns.unitSize&&t.push(e.unit_size.unit_size_label),J.columns.jobType&&t.push(e.job_type.job_type_label),J.columns.scheduledDate&&t.push(N(e.scheduled_date)),J.columns.amount&&t.push(e.total_billing_amount?`$${e.total_billing_amount.toFixed(2)}`:"$0.00"),t})),l=Math.floor((e.internal.pageSize.getHeight()-20-10)/8);e.setFontSize(12),e.text(o,10,15);const i=t=>{t>0&&e.addPage(),e.setFontSize(8);let n=10;s.forEach(((t,s)=>{e.text(t,n,20),n+=a[s]}));const c=Math.min(t+l,r.length);for(let s=t;s<c;s++){const l=r[s];n=10,l.forEach(((r,l)=>{const c=r?.toString()||"",o=Math.floor(a[l]/1.5),i=c.length>o?c.substring(0,o-3)+"...":c;e.text(i,n,20+8*(s-t+1)),n+=a[l]}))}return c};let u=0;for(;u<r.length;)u=i(u);e.save(`${o.toLowerCase().replace(/\s+/g,"_")}_${n(new Date,"yyyy-MM-dd")}.pdf`)},de=(ue=v.filter((e=>e.property.property_name.toLowerCase().includes(R.toLowerCase())||e.unit_number.toLowerCase().includes(R.toLowerCase())||e.unit_size.unit_size_label.toLowerCase().includes(R.toLowerCase())||e.job_type.job_type_label.toLowerCase().includes(R.toLowerCase())||w(e.work_order_num).toLowerCase().includes(R.toLowerCase()))),[...ue].sort(((e,t)=>{let s=0;const a="asc"===U.direction?1:-1;switch(U.field){case"work_order_num":s=e.work_order_num-t.work_order_num;break;case"job_phase":s=(e.job_phase?.job_phase_label||"").localeCompare(t.job_phase?.job_phase_label||"");break;case"property_name":s=e.property.property_name.localeCompare(t.property.property_name);break;case"unit_number":s=e.unit_number.localeCompare(t.unit_number);break;case"unit_size":s=e.unit_size.unit_size_label.localeCompare(t.unit_size.unit_size_label);break;case"job_type":s=e.job_type.job_type_label.localeCompare(t.job_type.job_type_label);break;case"scheduled_date":const a=c(e.scheduled_date),r=c(t.scheduled_date);s=a.getTime()-r.getTime();break;case"total_billing_amount":s=(e.total_billing_amount||0)-(t.total_billing_amount||0)}return s*a})));var ue;const xe=({field:t})=>U.field!==t?e.jsx(f,{className:"ml-2 h-4 w-4 text-gray-400 group-hover:text-gray-700 dark:group-hover:text-white"}):"asc"===U.direction?e.jsx(_,{className:"ml-2 h-4 w-4 text-gray-900 dark:text-white"}):e.jsx(y,{className:"ml-2 h-4 w-4 text-gray-900 dark:text-white"});return C?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A] min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(x,{className:"h-8 w-8 text-gray-500 dark:text-gray-400"}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:o})]}),e.jsxs("div",{className:"flex space-x-3",children:[P&&e.jsxs("button",{onClick:async()=>{if(P){ae(!0);try{await P(),t.success("Job list refreshed")}catch(e){t.error("Failed to refresh jobs. Please try again.")}finally{ae(!1)}}},disabled:se,className:"inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[e.jsx(h,{className:"h-4 w-4 mr-2 "+(se?"animate-spin":"")}),"Refresh"]}),H.length>0&&e.jsx(e.Fragment,{children:E?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>V(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Unarchive Selected (",H.length,")"]}),e.jsxs("button",{onClick:()=>K(!0),className:"inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),"Delete Selected (",H.length,")"]})]}):e.jsxs("button",{onClick:()=>Z(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Archive Selected (",H.length,")"]})}),A&&e.jsxs(r,{to:S,className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Add Job Request"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>O(!T),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Export",e.jsx(y,{className:"h-4 w-4 ml-1"})]}),T&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-[#1E293B] rounded-lg shadow-lg z-10",children:[e.jsx("button",{onClick:()=>ne("csv"),className:"w-full px-4 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-[#2D3B4E] rounded-t-lg",children:"Export as CSV"}),e.jsx("button",{onClick:()=>ne("pdf"),className:"w-full px-4 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-[#2D3B4E] rounded-b-lg",children:"Export as PDF"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:`Search ${o.toLowerCase()}...`,value:R,onChange:e=>z(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#1E293B] rounded-lg text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),D&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:D}),e.jsx("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg overflow-hidden shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-[#2D3B4E]",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-3 py-4 text-left",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",checked:H.length>0&&H.length===de.length,onChange:e=>{e.target.checked?G(de.map((e=>e.id))):G([])},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("work_order_num"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Work Order #",e.jsx(xe,{field:"work_order_num"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("job_phase"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Job Phase",e.jsx(xe,{field:"job_phase"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("property_name"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Property Name",e.jsx(xe,{field:"property_name"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("unit_number"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Unit #",e.jsx(xe,{field:"unit_number"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("unit_size"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Unit Size",e.jsx(xe,{field:"unit_size"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("job_type"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Job Type",e.jsx(xe,{field:"job_type"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("scheduled_date"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Scheduled Date",e.jsx(xe,{field:"scheduled_date"})]})}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-left",children:e.jsxs("button",{onClick:()=>re("total_billing_amount"),className:"group inline-flex items-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider hover:text-gray-700 dark:hover:text-white",children:["Amount",e.jsx(xe,{field:"total_billing_amount"})]})})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200 dark:divide-[#2D3B4E]",children:[de.map((t=>e.jsxs("tr",{className:"hover:bg-gray-50/50 dark:hover:bg-[#2D3B4E]/30 transition-colors",children:[e.jsx("td",{className:"px-3 py-4",children:e.jsx("div",{className:"flex items-center",children:e.jsx("input",{type:"checkbox",checked:H.includes(t.id),onChange:()=>{return e=t.id,void G((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]));var e},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(r,{to:`/dashboard/jobs/${t.id}`,className:"text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 font-medium",children:w(t.work_order_num)})}),e.jsx("td",{className:"px-6 py-4",children:t.job_phase&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:t.job_phase.color_dark_mode||"#4B5563",color:"white"},children:t.job_phase.job_phase_label})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(r,{to:`/dashboard/properties/${t.property.id}`,className:"text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400",children:t.property.property_name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:t.unit_number})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:t.unit_size.unit_size_label})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:t.job_type.job_type_label})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:N(t.scheduled_date)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:t.total_billing_amount?`$${t.total_billing_amount.toFixed(2)}`:"$0.00"})})]},t.id))),0===de.length&&e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-4 text-center text-gray-600 dark:text-gray-400",children:"No jobs found"})})]})]})})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Archive Selected Jobs"}),e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:["Are you sure you want to archive ",H.length," selected job",1!==H.length?"s":"","? Archived jobs will be moved to the Archives section."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>Z(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-gray-100 dark:bg-[#2D3B4E] rounded-lg hover:bg-gray-200 dark:hover:bg-[#374151] transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(0!==H.length){te(!0);try{const{data:e,error:a}=await s.from("job_phases").select("id").eq("job_phase_label","Archived").single();if(a){if("PGRST116"!==a.code)throw a;{const{data:e,error:t}=await s.from("job_phases").insert({job_phase_label:"Archived",color_light_mode:"#D4D4D8",color_dark_mode:"#52525B",sort_order:100,order_index:100}).select().single();if(t)throw t;if(!e)throw new Error("Failed to create Archived phase");const a=e,{data:r,error:n}=await s.auth.getUser();if(n)throw n;if(!r.user)throw new Error("User not found");const{data:l,error:c}=await s.from("jobs").select("id, current_phase_id").in("id",H);if(c)throw c;const{error:o}=await s.from("jobs").update({current_phase_id:a.id}).in("id",H);if(o)throw o;const i=l.map((e=>({job_id:e.id,changed_by:r.user.id,from_phase_id:e.current_phase_id,to_phase_id:a.id,change_reason:"Job archived"}))),{error:d}=await s.from("job_phase_changes").insert(i);if(d)throw d}}else{const{data:t,error:a}=await s.auth.getUser();if(a)throw a;if(!t.user)throw new Error("User not found");const{data:r,error:n}=await s.from("jobs").select("id, current_phase_id").in("id",H);if(n)throw n;const{error:l}=await s.from("jobs").update({current_phase_id:e.id}).in("id",H);if(l)throw l;const c=r.map((s=>({job_id:s.id,changed_by:t.user.id,from_phase_id:s.current_phase_id,to_phase_id:e.id,change_reason:"Job archived"}))),{error:o}=await s.from("job_phase_changes").insert(c);if(o)throw o}G([]),Z(!1),t.success(`Successfully archived ${H.length} job${1!==H.length?"s":""}`),P?await P():window.location.reload()}catch(e){t.error("Failed to archive jobs. Please try again.")}finally{te(!1)}}},disabled:ee,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:ee?"Archiving...":"Archive Jobs"})]})]})}),X&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Unarchive Selected Jobs"}),e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:["Are you sure you want to unarchive ",H.length," selected job",1!==H.length?"s":"","? Unarchived jobs will be moved back to the Job Requests section."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>V(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-gray-100 dark:bg-[#2D3B4E] rounded-lg hover:bg-gray-200 dark:hover:bg-[#374151] transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(0!==H.length){te(!0);try{const{data:e,error:a}=await s.from("job_phases").select("id").eq("job_phase_label","Job Request").single();if(a)throw a;const{data:r,error:n}=await s.auth.getUser();if(n)throw n;if(!r.user)throw new Error("User not found");const{data:l,error:c}=await s.from("jobs").select("id, current_phase_id").in("id",H);if(c)throw c;const{error:o}=await s.from("jobs").update({current_phase_id:e.id}).in("id",H);if(o)throw o;const i=l.map((t=>({job_id:t.id,changed_by:r.user.id,from_phase_id:t.current_phase_id,to_phase_id:e.id,change_reason:"Job unarchived"}))),{error:d}=await s.from("job_phase_changes").insert(i);if(d)throw d;G([]),V(!1),t.success(`Successfully unarchived ${H.length} job${1!==H.length?"s":""}`),P?await P():window.location.reload()}catch(e){t.error("Failed to unarchive jobs. Please try again.")}finally{te(!1)}}},disabled:ee,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:ee?"Unarchiving...":"Unarchive Jobs"})]})]})}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Selected Jobs"}),e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:["Are you sure you want to permanently delete ",H.length," selected job",1!==H.length?"s":"","? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>K(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-gray-100 dark:bg-[#2D3B4E] rounded-lg hover:bg-gray-200 dark:hover:bg-[#374151] transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(0!==H.length){te(!0);try{const{data:e,error:a}=await s.from("jobs").select("\n          id,\n          current_phase_id,\n          job_phases!current_phase_id (\n            job_phase_label\n          )\n        ").in("id",H);if(a)throw a;if(e.filter((e=>{const t=e.job_phases?.job_phase_label;return"Archived"!==t})).length>0)return void t.error("Only archived jobs can be deleted");const r=u("https://tbwtfimnbmvbgesidbxh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRid3RmaW1uYm12Ymdlc2lkYnhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MDEyOTA3OSwiZXhwIjoyMDY1NzA1MDc5fQ.6H9yeEtrq_kf8DkrQXSHCHlo-erE_gso715qAwsDKmU",{auth:{autoRefreshToken:!1,persistSession:!1}}),{error:n,count:l}=await r.from("work_orders").delete({count:"exact"}).in("job_id",H);if(n)throw new Error(`Failed to delete work orders: ${n.message}`);const{error:c,count:o}=await r.from("files").delete({count:"exact"}).in("job_id",H);if(c)throw new Error(`Failed to delete files: ${c.message}`);const{error:i,count:d}=await r.from("jobs").delete({count:"exact"}).in("id",H);if(i)throw new Error(`Failed to delete jobs: ${i.message}`);const{data:x,error:h}=await r.from("jobs").select("id").in("id",H);if(h);else if(x&&x.length>0)throw new Error(`Deletion failed: ${x.length} jobs still exist in database`);P?await P():window.location.reload(),G([]),K(!1),t.success("Selected jobs deleted successfully")}catch(e){t.error(e instanceof Error?e.message:"Failed to delete jobs")}finally{te(!1)}}},disabled:ee,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:ee?"Deleting...":"Delete Jobs"})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Export Configuration"}),e.jsx("button",{onClick:()=>I(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(k,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-[#0F172A] rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Date Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:J.dateRange.startDate,onChange:e=>$((t=>({...t,dateRange:{...t.dateRange,startDate:e.target.value}}))),className:"w-full px-3 py-2 bg-white dark:bg-[#2D3B4E] border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 dark:text-gray-400 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:J.dateRange.endDate,onChange:e=>$((t=>({...t,dateRange:{...t.dateRange,endDate:e.target.value}}))),className:"w-full px-3 py-2 bg-white dark:bg-[#2D3B4E] border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Fields to Export"}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg mb-3",children:[e.jsxs("button",{onClick:()=>le("jobInfo"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 dark:hover:bg-[#0F172A] transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Job Information"}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",Object.entries(J.columns).filter((([e,t])=>!e.includes("is")&&!e.includes("painted")&&!e.includes("has")&&!e.includes("extra")&&!e.includes("accent")&&!e.includes("submission")&&!e.includes("cabinet")&&!e.includes("ceiling")&&!e.includes("additional")&&!e.includes("sprinklers")&&!e.includes("paint")&&t)).length," selected)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),ce("jobInfo",!0)},className:"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"Select All"}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),ce("jobInfo",!1)},className:"text-xs text-gray-600 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"Clear All"}),L.jobInfo?e.jsx(_,{className:"h-5 w-5 text-gray-500"}):e.jsx(y,{className:"h-5 w-5 text-gray-500"})]})]}),L.jobInfo&&e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-[#0F172A]",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.workOrder,onChange:e=>$((t=>({...t,columns:{...t.columns,workOrder:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Work Order #"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.phase,onChange:e=>$((t=>({...t,columns:{...t.columns,phase:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Phase"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.property,onChange:e=>$((t=>({...t,columns:{...t.columns,property:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Property"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.address,onChange:e=>$((t=>({...t,columns:{...t.columns,address:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Address"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.unitNumber,onChange:e=>$((t=>({...t,columns:{...t.columns,unitNumber:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Unit #"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.unitSize,onChange:e=>$((t=>({...t,columns:{...t.columns,unitSize:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Unit Size"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.jobType,onChange:e=>$((t=>({...t,columns:{...t.columns,jobType:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Job Type"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.scheduledDate,onChange:e=>$((t=>({...t,columns:{...t.columns,scheduledDate:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Scheduled Date"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.dueDate,onChange:e=>$((t=>({...t,columns:{...t.columns,dueDate:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Due Date"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.completedDate,onChange:e=>$((t=>({...t,columns:{...t.columns,completedDate:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Completed Date"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.amount,onChange:e=>$((t=>({...t,columns:{...t.columns,amount:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Amount"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.description,onChange:e=>$((t=>({...t,columns:{...t.columns,description:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Description"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.status,onChange:e=>$((t=>({...t,columns:{...t.columns,status:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Status"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.createdBy,onChange:e=>$((t=>({...t,columns:{...t.columns,createdBy:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Created By"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.assignedTo,onChange:e=>$((t=>({...t,columns:{...t.columns,assignedTo:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Assigned To"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.createdAt,onChange:e=>$((t=>({...t,columns:{...t.columns,createdAt:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Created At"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.updatedAt,onChange:e=>$((t=>({...t,columns:{...t.columns,updatedAt:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Updated At"})]})]})})]}),e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("button",{onClick:()=>le("workOrderInfo"),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-50 dark:hover:bg-[#0F172A] transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Work Order Details"}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",Object.entries(J.columns).filter((([e,t])=>(e.includes("is")||e.includes("painted")||e.includes("has")||e.includes("extra")||e.includes("accent")||e.includes("submission")||e.includes("cabinet")||e.includes("ceiling")||e.includes("additional")||e.includes("sprinklers")||"paintType"===e)&&t)).length," selected)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),ce("workOrderInfo",!0)},className:"text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"Select All"}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("button",{onClick:e=>{e.stopPropagation(),ce("workOrderInfo",!1)},className:"text-xs text-gray-600 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:"Clear All"}),L.workOrderInfo?e.jsx(_,{className:"h-5 w-5 text-gray-500"}):e.jsx(y,{className:"h-5 w-5 text-gray-500"})]})]}),L.workOrderInfo&&e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-[#0F172A]",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.submissionDate,onChange:e=>$((t=>({...t,columns:{...t.columns,submissionDate:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Submission Date"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.isOccupied,onChange:e=>$((t=>({...t,columns:{...t.columns,isOccupied:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Is Occupied"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.isFullPaint,onChange:e=>$((t=>({...t,columns:{...t.columns,isFullPaint:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Full Paint"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.paintType,onChange:e=>$((t=>({...t,columns:{...t.columns,paintType:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Paint Type"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.hasSprinklers,onChange:e=>$((t=>({...t,columns:{...t.columns,hasSprinklers:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Has Sprinklers"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.sprinklersPainted,onChange:e=>$((t=>({...t,columns:{...t.columns,sprinklersPainted:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Sprinklers Painted"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.paintedCeilings,onChange:e=>$((t=>({...t,columns:{...t.columns,paintedCeilings:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Painted Ceilings"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.ceilingRoomsCount,onChange:e=>$((t=>({...t,columns:{...t.columns,ceilingRoomsCount:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Ceiling Rooms Count"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.paintedPatio,onChange:e=>$((t=>({...t,columns:{...t.columns,paintedPatio:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Painted Patio"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.paintedGarage,onChange:e=>$((t=>({...t,columns:{...t.columns,paintedGarage:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Painted Garage"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.paintedCabinets,onChange:e=>$((t=>({...t,columns:{...t.columns,paintedCabinets:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Painted Cabinets"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.paintedCrownMolding,onChange:e=>$((t=>({...t,columns:{...t.columns,paintedCrownMolding:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Painted Crown Molding"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.paintedFrontDoor,onChange:e=>$((t=>({...t,columns:{...t.columns,paintedFrontDoor:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Painted Front Door"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.cabinetRemovalRepair,onChange:e=>$((t=>({...t,columns:{...t.columns,cabinetRemovalRepair:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Cabinet Removal/Repair"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.ceilingLightsRepair,onChange:e=>$((t=>({...t,columns:{...t.columns,ceilingLightsRepair:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Ceiling Lights Repair"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.hasAccentWall,onChange:e=>$((t=>({...t,columns:{...t.columns,hasAccentWall:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Has Accent Wall"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.accentWallType,onChange:e=>$((t=>({...t,columns:{...t.columns,accentWallType:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Accent Wall Type"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.accentWallCount,onChange:e=>$((t=>({...t,columns:{...t.columns,accentWallCount:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Accent Wall Count"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.hasExtraCharges,onChange:e=>$((t=>({...t,columns:{...t.columns,hasExtraCharges:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Has Extra Charges"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.extraChargesDescription,onChange:e=>$((t=>({...t,columns:{...t.columns,extraChargesDescription:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Extra Charges Description"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.extraHours,onChange:e=>$((t=>({...t,columns:{...t.columns,extraHours:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Extra Hours"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:J.columns.additionalComments,onChange:e=>$((t=>({...t,columns:{...t.columns,additionalComments:e.target.checked}}))),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Additional Comments"})]})]})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Your field preferences will be saved for future exports."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-gray-100 dark:bg-[#2D3B4E] rounded-lg hover:bg-gray-200 dark:hover:bg-[#374151] transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:()=>{localStorage.setItem("jobExportConfig",JSON.stringify(J)),"csv"===B?oe():"pdf"===B&&ie(),I(!1)},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors",children:["Export ",B?.toUpperCase()]})]})]})]})})]})}function C({phaseLabel:e}){const[t,r]=a.useState([]),[n,l]=a.useState(!0),[c,o]=a.useState(null),[i,d]=a.useState([]),u=a.useRef(!0),x=a.useRef(null),h=a.useRef(0),m=a.useCallback((async(t=!1)=>{const a=Date.now();if(t||!(a-h.current<5e3)){h.current=a,x.current&&x.current.abort(),x.current=new AbortController;try{const{data:t,error:a}=await s.from("job_phases").select("id").in("job_phase_label",Array.isArray(e)?e:[e]);if(a)throw a;if(!t?.length)throw new Error(`${e} phase not found`);u.current&&d(t.map((e=>e.id)));let n="created_at",l=!1;"Job Request"===e||Array.isArray(e)&&e.includes("Job Request")?(n="created_at",l=!1):("Work Order"===e||"Pending Work Order"===e||"Grading"===e||"Invoicing"===e||Array.isArray(e)&&(e.includes("Work Order")||e.includes("Pending Work Order")||e.includes("Grading")||e.includes("Invoicing")))&&(n="updated_at",l=!1);const{data:c,error:i}=await s.from("jobs").select("\n          id,\n          work_order_num,\n          unit_number,\n          scheduled_date,\n          total_billing_amount,\n          property:properties (\n            id,\n            property_name,\n            address,\n            city,\n            state\n          ),\n          unit_size:unit_sizes (\n            unit_size_label\n          ),\n          job_type:job_types (\n            job_type_label\n          ),\n          job_phase:current_phase_id (\n            job_phase_label,\n            color_light_mode,\n            color_dark_mode\n          )\n        ").in("current_phase_id",t.map((e=>e.id))).order(n,{ascending:l});if(i)throw i;if(u.current){const e=(c||[]).map((e=>({id:e.id,work_order_num:e.work_order_num,unit_number:e.unit_number,scheduled_date:e.scheduled_date,total_billing_amount:e.total_billing_amount,property:Array.isArray(e.property)?e.property[0]:e.property,unit_size:Array.isArray(e.unit_size)?e.unit_size[0]:e.unit_size,job_type:Array.isArray(e.job_type)?e.job_type[0]:e.job_type,job_phase:Array.isArray(e.job_phase)?e.job_phase[0]:e.job_phase})));r(e),o(null)}}catch(n){u.current&&o(n instanceof Error?n.message:"Failed to fetch jobs")}finally{u.current&&l(!1)}}}),[e]);return a.useEffect((()=>(u.current=!0,m(),()=>{u.current=!1,x.current&&x.current.abort()})),[m]),a.useEffect((()=>{if(0===i.length)return;const e=s.channel("jobs-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"jobs",filter:`current_phase_id=in.(${i.join(",")})`},(async e=>{if(u.current){const{data:t,error:a}=await s.from("jobs").select("\n              id,\n              work_order_num,\n              unit_number,\n              scheduled_date,\n              total_billing_amount,\n              property:properties (\n                id,\n                property_name,\n                address,\n                city,\n                state\n              ),\n              unit_size:unit_sizes (\n                unit_size_label\n              ),\n              job_type:job_types (\n                job_type_label\n              ),\n              job_phase:current_phase_id (\n                job_phase_label,\n                color_light_mode,\n                color_dark_mode\n              )\n            ").eq("id",e.new.id).single();if(!a&&t){const e={id:t.id,work_order_num:t.work_order_num,unit_number:t.unit_number,scheduled_date:t.scheduled_date,total_billing_amount:t.total_billing_amount,property:Array.isArray(t.property)?t.property[0]:t.property,unit_size:Array.isArray(t.unit_size)?t.unit_size[0]:t.unit_size,job_type:Array.isArray(t.job_type)?t.job_type[0]:t.job_type,job_phase:Array.isArray(t.job_phase)?t.job_phase[0]:t.job_phase};r((t=>[e,...t]))}else m(!0)}})).on("postgres_changes",{event:"UPDATE",schema:"public",table:"jobs"},(async e=>{u.current&&setTimeout((()=>m(!0)),500)})).on("postgres_changes",{event:"INSERT",schema:"public",table:"job_phase_changes"},(async e=>{u.current&&setTimeout((()=>m(!0)),1e3)})).on("postgres_changes",{event:"DELETE",schema:"public",table:"jobs"},(e=>{u.current&&r((t=>t.filter((t=>t.id!==e.old.id))))})).subscribe();return()=>{e.unsubscribe()}}),[i,m]),{jobs:t,loading:n,error:c,refetch:()=>m(!0)}}export{v as J,C as u};
