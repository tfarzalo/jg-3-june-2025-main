import{s as e,j as t}from"./index-trbIQK5H.js";import{r,b as n,u as a,R as o}from"./react-vendor-BmeRVKJv.js";import{m as i,a5 as l,a6 as s,P as c,i as d,h as u,Z as m,N as f,p as h,Y as g,a7 as p,a8 as x,a9 as v,F as b}from"./ui-CiwSAYI4.js";import"./supabase-c3qFLfUQ.js";const y="carousel",w="controller",N="portal",k="toolbar",j="loading",E="error",C="complete",S="flex_center",P="no_scroll_padding",L="slide",M="prev",R="next",_="swipe",$="close",I="onPointerDown",D="onPointerMove",W="onPointerUp",O="onPointerLeave",U="onPointerCancel",T="onKeyDown",F="onWheel",A="icon",z="contain",X="cover",B="yarl__";function H(...e){return[...e].filter(Boolean).join(" ")}function Y(e){return`${B}${e}`}function K(e){return`--${B}${e}`}function q(e,t){return`${e}${t?`_${t}`:""}`}function V(e){return t=>q(e,t)}function Z(...e){return()=>{e.forEach((e=>{e()}))}}function G(e,t,n){return()=>{const a=r.useContext(n);if(!a)throw new Error(`${e} must be used within a ${t}.Provider`);return a}}function J(){return"undefined"!=typeof window}function Q(e){return void 0===e.type||"image"===e.type}function ee(e){return"string"==typeof e?Number.parseInt(e,10):e}function te(e){if("number"==typeof e)return{pixel:e};if("string"==typeof e){const t=ee(e);return e.endsWith("%")?{percent:t}:{pixel:t}}return{pixel:0}}function re(e,t){const r=te(t),n=void 0!==r.percent?e.width/100*r.percent:r.pixel;return{width:Math.max(e.width-2*n,0),height:Math.max(e.height-2*n,0)}}function ne(e,t){return t>0?(e%t+t)%t:0}function ae(e){return e.length>0}function oe(e,t){return e[ne(t,e.length)]}function ie(e,t){return ae(e)?oe(e,t):void 0}function le(e){return Q(e)?e.src:void 0}const se=Number(r.version.split(".")[0])>=19;const ce={open:!1,close:()=>{},index:0,slides:[],render:{},plugins:[],toolbar:{buttons:[$]},labels:{},animation:{fade:250,swipe:500,easing:{fade:"ease",swipe:"ease-out",navigation:"ease-in-out"}},carousel:{finite:!1,preload:2,padding:"16px",spacing:"30%",imageFit:z,imageProps:{}},controller:{ref:null,focus:!0,aria:!1,touchAction:"none",closeOnPullUp:!1,closeOnPullDown:!1,closeOnBackdropClick:!1,preventDefaultWheelX:!0,preventDefaultWheelY:!1,disableSwipeNavigation:!1},portal:{},noScroll:{disabled:!1},on:{},styles:{},className:""};function de(e,t){return{name:e,component:t}}function ue(e,t){return{module:e,children:t}}function me(e,t,r){return e.module.name===t?r(e):e.children?[ue(e.module,e.children.flatMap((e=>{var n;return null!==(n=me(e,t,r))&&void 0!==n?n:[]})))]:[e]}function fe(e,t,r){return e.flatMap((e=>{var n;return null!==(n=me(e,t,r))&&void 0!==n?n:[]}))}const he=r.createContext(null),ge=G("useDocument","DocumentContext",he);function pe({nodeRef:e,children:t}){const n=r.useMemo((()=>{const t=t=>{var r;return(null===(r=t||e.current)||void 0===r?void 0:r.ownerDocument)||document};return{getOwnerDocument:t,getOwnerWindow:e=>{var r;return(null===(r=t(e))||void 0===r?void 0:r.defaultView)||window}}}),[e]);return r.createElement(he.Provider,{value:n},t)}const xe=r.createContext(null),ve=G("useEvents","EventsContext",xe);function be({children:e}){const[t]=r.useState({});r.useEffect((()=>()=>{Object.keys(t).forEach((e=>delete t[e]))}),[t]);const n=r.useMemo((()=>{const e=(e,r)=>{var n;null===(n=t[e])||void 0===n||n.splice(0,t[e].length,...t[e].filter((e=>e!==r)))};return{publish:(...[e,r])=>{var n;null===(n=t[e])||void 0===n||n.forEach((e=>e(r)))},subscribe:(r,n)=>(t[r]||(t[r]=[]),t[r].push(n),()=>e(r,n)),unsubscribe:e}}),[t]);return r.createElement(xe.Provider,{value:n},e)}const ye=r.createContext(null),we=G("useLightboxProps","LightboxPropsContext",ye);function Ne({children:e,...t}){return r.createElement(ye.Provider,{value:t},e)}const ke=r.createContext(null),je=G("useLightboxState","LightboxStateContext",ke),Ee=r.createContext(null),Ce=G("useLightboxDispatch","LightboxDispatchContext",Ee);function Se(e,t){switch(t.type){case"swipe":{const{slides:r}=e,n=(null==t?void 0:t.increment)||0,a=e.globalIndex+n,o=ne(a,r.length);return{slides:r,currentIndex:o,globalIndex:a,currentSlide:ie(r,o),animation:n||void 0!==t.duration?{increment:n,duration:t.duration,easing:t.easing}:void 0}}case"update":return t.slides!==e.slides||t.index!==e.currentIndex?{slides:t.slides,currentIndex:t.index,globalIndex:t.index,currentSlide:ie(t.slides,t.index)}:e;default:throw new Error("Unknown action type")}}function Pe({slides:e,index:t,children:n}){const[a,o]=r.useReducer(Se,{slides:e,currentIndex:t,globalIndex:t,currentSlide:ie(e,t)});r.useEffect((()=>{o({type:"update",slides:e,index:t})}),[e,t]);const i=r.useMemo((()=>({...a,state:a,dispatch:o})),[a,o]);return r.createElement(Ee.Provider,{value:o},r.createElement(ke.Provider,{value:i},n))}const Le=r.createContext(null),Me=G("useTimeouts","TimeoutsContext",Le);function Re({children:e}){const[t]=r.useState([]);r.useEffect((()=>()=>{t.forEach((e=>window.clearTimeout(e))),t.splice(0,t.length)}),[t]);const n=r.useMemo((()=>{const e=e=>{t.splice(0,t.length,...t.filter((t=>t!==e)))};return{setTimeout:(r,n)=>{const a=window.setTimeout((()=>{e(a),r()}),n);return t.push(a),a},clearTimeout:t=>{void 0!==t&&(e(t),window.clearTimeout(t))}}}),[t]);return r.createElement(Le.Provider,{value:n},e)}const _e=r.forwardRef((function({label:e,className:t,icon:n,renderIcon:a,onClick:o,style:i,...l},s){const{styles:c,labels:d}=we(),u=function(e,t){var r;return null!==(r=null==e?void 0:e[t])&&void 0!==r?r:t}(d,e);return r.createElement("button",{ref:s,type:"button",title:u,"aria-label":u,className:H(Y("button"),t),onClick:o,style:{...i,...c.button},...l},a?a():r.createElement(n,{className:Y(A),style:c.icon}))}));function $e(e,t){return function(e,t){const n=e=>r.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false",...e},t);return n.displayName=e,n}(e,r.createElement("g",{fill:"currentColor"},r.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),t))}const Ie=$e("Close",r.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),De=$e("Previous",r.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),We=$e("Next",r.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})),Oe=$e("Loading",r.createElement(r.Fragment,null,Array.from({length:8}).map(((e,t,n)=>r.createElement("line",{key:t,x1:"12",y1:"6.5",x2:"12",y2:"1.8",strokeLinecap:"round",strokeWidth:"2.6",stroke:"currentColor",strokeOpacity:1/n.length*(t+1),transform:`rotate(${360/n.length*t}, 12, 12)`}))))),Ue=$e("Error",r.createElement("path",{d:"M21.9,21.9l-8.49-8.49l0,0L3.59,3.59l0,0L2.1,2.1L0.69,3.51L3,5.83V19c0,1.1,0.9,2,2,2h13.17l2.31,2.31L21.9,21.9z M5,18 l3.5-4.5l2.5,3.01L12.17,15l3,3H5z M21,18.17L5.83,3H19c1.1,0,2,0.9,2,2V18.17z"})),Te=J()?r.useLayoutEffect:r.useEffect;function Fe(){const[e,t]=r.useState(!1);return r.useEffect((()=>{var e,r;const n=null===(e=window.matchMedia)||void 0===e?void 0:e.call(window,"(prefers-reduced-motion: reduce)");t(null==n?void 0:n.matches);const a=e=>t(e.matches);return null===(r=null==n?void 0:n.addEventListener)||void 0===r||r.call(n,"change",a),()=>{var e;return null===(e=null==n?void 0:n.removeEventListener)||void 0===e?void 0:e.call(n,"change",a)}}),[]),e}function Ae(e,t){const n=r.useRef(void 0),a=r.useRef(void 0),o=Fe();return Te((()=>{var r,i,l;if(e.current&&void 0!==n.current&&!o){const{keyframes:o,duration:c,easing:d,onfinish:u}=t(n.current,e.current.getBoundingClientRect(),function(e){let t=0,r=0,n=0;const a=window.getComputedStyle(e).transform.match(/matrix.*\((.+)\)/);if(a){const e=a[1].split(",").map(ee);6===e.length?(t=e[4],r=e[5]):16===e.length&&(t=e[12],r=e[13],n=e[14])}return{x:t,y:r,z:n}}(e.current))||{};if(o&&c){null===(r=a.current)||void 0===r||r.cancel(),a.current=void 0;try{a.current=null===(l=(i=e.current).animate)||void 0===l?void 0:l.call(i,o,{duration:c,easing:d})}catch(s){}a.current&&(a.current.onfinish=()=>{a.current=void 0,null==u||u()})}}n.current=void 0})),{prepareAnimation:e=>{n.current=e},isAnimationPlaying:()=>{var e;return"running"===(null===(e=a.current)||void 0===e?void 0:e.playState)}}}function ze(){const e=r.useRef(null),t=r.useRef(void 0),[n,a]=r.useState();return{setContainerRef:r.useCallback((r=>{e.current=r,t.current&&(t.current.disconnect(),t.current=void 0);const n=()=>{if(r){const e=window.getComputedStyle(r),t=e=>parseFloat(e)||0;a({width:Math.round(r.clientWidth-t(e.paddingLeft)-t(e.paddingRight)),height:Math.round(r.clientHeight-t(e.paddingTop)-t(e.paddingBottom))})}else a(void 0)};n(),r&&"undefined"!=typeof ResizeObserver&&(t.current=new ResizeObserver(n),t.current.observe(r))}),[]),containerRef:e,containerRect:n}}function Xe(){const e=r.useRef(void 0),{setTimeout:t,clearTimeout:n}=Me();return r.useCallback(((r,a)=>{n(e.current),e.current=t(r,a>0?a:0)}),[t,n])}function Be(e){const t=r.useRef(e);return Te((()=>{t.current=e})),r.useCallback(((...e)=>{var r;return null===(r=t.current)||void 0===r?void 0:r.call(t,...e)}),[])}function He(e,t){"function"==typeof e?e(t):e&&(e.current=t)}function Ye(e,t){return r.useMemo((()=>null==e&&null==t?null:r=>{He(e,r),He(t,r)}),[e,t])}function Ke(e,t=!1){const n=r.useRef(!1);Te((()=>{t&&n.current&&(n.current=!1,e())}),[t,e]);return{onFocus:r.useCallback((()=>{n.current=!0}),[]),onBlur:r.useCallback((()=>{n.current=!1}),[])}}function qe(){const[e,t]=r.useState(!1);return Te((()=>{t("rtl"===window.getComputedStyle(window.document.documentElement).direction)}),[]),e}function Ve(e,t){const n=r.useRef(0),a=Xe(),o=Be(((...t)=>{n.current=Date.now(),e(t)}));return r.useCallback(((...e)=>{a((()=>{o(e)}),t-(Date.now()-n.current))}),[t,o,a])}const Ze=V("slide"),Ge=V("slide_image");function Je({slide:e,offset:t,render:n,rect:a,imageFit:o,imageProps:i,onClick:l,onLoad:s,onError:c,style:d}){var u,m,f,h,g,p,x;const[v,b]=r.useState(j),{publish:y}=ve(),{setTimeout:w}=Me(),N=r.useRef(null);r.useEffect((()=>{0===t&&y((e=>`active-slide-${e}`)(v))}),[t,v,y]);const k=Be((e=>{("decode"in e?e.decode():Promise.resolve()).catch((()=>{})).then((()=>{e.parentNode&&(b(C),w((()=>{null==s||s(e)}),0))}))})),S=r.useCallback((e=>{N.current=e,(null==e?void 0:e.complete)&&k(e)}),[k]),P=r.useCallback((e=>{k(e.currentTarget)}),[k]),L=Be((()=>{b(E),null==c||c()})),M=function(e,t){return e.imageFit===X||e.imageFit!==z&&t===X}(e,o),R=(e,t)=>Number.isFinite(e)?e:t,_=R(Math.max(...(null!==(m=null===(u=e.srcSet)||void 0===u?void 0:u.map((e=>e.width)))&&void 0!==m?m:[]).concat(e.width?[e.width]:[]).filter(Boolean)),(null===(f=N.current)||void 0===f?void 0:f.naturalWidth)||0),$=R(Math.max(...(null!==(g=null===(h=e.srcSet)||void 0===h?void 0:h.map((e=>e.height)))&&void 0!==g?g:[]).concat(e.height?[e.height]:[]).filter(Boolean)),(null===(p=N.current)||void 0===p?void 0:p.naturalHeight)||0),I=_&&$?{maxWidth:`min(${_}px, 100%)`,maxHeight:`min(${$}px, 100%)`}:{maxWidth:"100%",maxHeight:"100%"},D=null===(x=e.srcSet)||void 0===x?void 0:x.sort(((e,t)=>e.width-t.width)).map((e=>`${e.src} ${e.width}w`)).join(", "),W=D&&a&&J()?`${Math.round(Math.min(a&&!M&&e.width&&e.height?a.height/e.height*e.width:Number.MAX_VALUE,a.width))}px`:void 0,{style:O,className:U,...T}=i||{};return r.createElement(r.Fragment,null,r.createElement("img",{ref:S,onLoad:P,onError:L,onClick:l,draggable:!1,className:H(Y(Ge()),M&&Y(Ge("cover")),v!==C&&Y(Ge("loading")),U),style:{...I,...d,...O},...T,alt:e.alt,sizes:W,srcSet:D,src:e.src}),v!==C&&r.createElement("div",{className:Y(Ze("placeholder"))},v===j&&((null==n?void 0:n.iconLoading)?n.iconLoading():r.createElement(Oe,{className:H(Y(A),Y(Ze(j)))})),v===E&&((null==n?void 0:n.iconError)?n.iconError():r.createElement(Ue,{className:H(Y(A),Y(Ze(E)))}))))}const Qe=r.forwardRef((function({className:e,children:t,...n},a){const o=r.useRef(null);return r.createElement(pe,{nodeRef:o},r.createElement("div",{ref:Ye(a,o),className:H(Y("root"),e),...n},t))}));var et,tt;!function(e){e[e.NONE=0]="NONE",e[e.SWIPE=1]="SWIPE",e[e.PULL=2]="PULL",e[e.ANIMATION=3]="ANIMATION"}(et||(et={})),function(e){e[e.NONE=0]="NONE",e[e.SWIPE=1]="SWIPE",e[e.PULL=2]="PULL"}(tt||(tt={}));function rt({disableSwipeNavigation:e,closeOnBackdropClick:t},n,a,o,i,l,s,c,d,u,m,f,h,g,p,x){const v=r.useRef(0),b=r.useRef([]),y=r.useRef(void 0),w=r.useRef(0),N=r.useRef(tt.NONE),k=r.useCallback((e=>{y.current===e.pointerId&&(y.current=void 0,N.current=tt.NONE);const t=b.current;t.splice(0,t.length,...t.filter((t=>t.pointerId!==e.pointerId)))}),[]),j=r.useCallback((e=>{k(e),e.persist(),b.current.push(e)}),[k]),E=r.useCallback((e=>b.current.find((({pointerId:t})=>e.pointerId===t))),[]),C=Be((e=>{j(e)})),S=(e,t)=>m&&e>t||u&&e<-t,P=Be((e=>{const r=E(e);if(r)if(y.current===e.pointerId){const e=Date.now()-w.current,t=v.current;N.current===tt.SWIPE?Math.abs(t)>.3*o||Math.abs(t)>5&&e<i?c(t,e):d(t):N.current===tt.PULL&&(S(t,60)?g(t,e):p(t)),v.current=0,N.current=tt.NONE}else{const{target:n}=e;t&&n instanceof HTMLElement&&n===r.target&&(n.classList.contains(Y(L))||n.classList.contains(Y("slide_wrapper")))&&x()}k(e)}));!function(e,t,n,a,o){r.useEffect((()=>Z(e(I,t),e(D,n),e(W,a),e(O,a),e(U,a))),[e,t,n,a,o])}(n,C,Be((t=>{const r=E(t);if(r){const n=y.current===t.pointerId;if(0===t.buttons)return void(n&&0!==v.current?P(t):k(r));const o=t.clientX-r.clientX,i=t.clientY-r.clientY;if(void 0===y.current){const r=e=>{j(t),y.current=t.pointerId,w.current=Date.now(),N.current=e};Math.abs(o)>Math.abs(i)&&Math.abs(o)>30&&a(o)?e||(r(tt.SWIPE),l()):Math.abs(i)>Math.abs(o)&&S(i,30)&&(r(tt.PULL),f())}else n&&(N.current===tt.SWIPE?(v.current=o,s(o)):N.current===tt.PULL&&(v.current=i,h(i)))}})),P)}const nt=V("container"),at=r.createContext(null),ot=G("useController","ControllerContext",at);const it=de(w,(function({children:e,...t}){var n;const{carousel:a,animation:o,controller:i,on:l,styles:s,render:c}=t,{closeOnPullUp:d,closeOnPullDown:u,preventDefaultWheelX:m,preventDefaultWheelY:f}=i,[h,g]=r.useState(),p=je(),x=Ce(),[v,b]=r.useState(et.NONE),y=r.useRef(0),w=r.useRef(0),k=r.useRef(1),{registerSensors:j,subscribeSensors:E}=function(){const[e]=r.useState({}),t=r.useCallback(((t,r)=>{var n;null===(n=e[t])||void 0===n||n.forEach((e=>{r.isPropagationStopped()||e(r)}))}),[e]);return{registerSensors:r.useMemo((()=>({onPointerDown:e=>t(I,e),onPointerMove:e=>t(D,e),onPointerUp:e=>t(W,e),onPointerLeave:e=>t(O,e),onPointerCancel:e=>t(U,e),onKeyDown:e=>t(T,e),onKeyUp:e=>t("onKeyUp",e),onWheel:e=>t(F,e)})),[t]),subscribeSensors:r.useCallback(((t,r)=>(e[t]||(e[t]=[]),e[t].unshift(r),()=>{const n=e[t];n&&n.splice(0,n.length,...n.filter((e=>e!==r)))})),[e])}}(),{subscribe:C,publish:P}=ve(),L=Xe(),A=Xe(),z=Xe(),{containerRef:X,setContainerRef:B,containerRect:q}=ze(),V=Ye(function({preventDefaultWheelX:e,preventDefaultWheelY:t}){const n=r.useRef(null),a=Be((r=>{const n=Math.abs(r.deltaX)>Math.abs(r.deltaY);(n&&e||!n&&t||r.ctrlKey)&&r.preventDefault()}));return r.useCallback((e=>{var t;e?e.addEventListener("wheel",a,{passive:!1}):null===(t=n.current)||void 0===t||t.removeEventListener("wheel",a),n.current=e}),[a])}({preventDefaultWheelX:m,preventDefaultWheelY:f}),B),G=r.useRef(null),J=Ye(G,void 0),{getOwnerDocument:Q}=ge(),ee=qe(),ne=e=>(ee?-1:1)*("number"==typeof e?e:1),ae=Be((()=>{var e;return null===(e=X.current)||void 0===e?void 0:e.focus()})),oe=Be((()=>t)),ie=Be((()=>p)),le=r.useCallback((e=>P(M,e)),[P]),se=r.useCallback((e=>P(R,e)),[P]),ce=r.useCallback((()=>P($)),[P]),de=e=>!(a.finite&&(ne(e)>0&&0===p.currentIndex||ne(e)<0&&p.currentIndex===p.slides.length-1)),ue=e=>{var t;y.current=e,null===(t=X.current)||void 0===t||t.style.setProperty(K("swipe_offset"),`${Math.round(e)}px`)},me=e=>{var t,r;w.current=e,k.current=(()=>{const t=u&&e>0?e:d&&e<0?-e:0;return Math.min(Math.max(function(e,t=0){const r=10**t;return Math.round((e+Number.EPSILON)*r)/r}(1-t/60*.5,2),.5),1)})(),null===(t=X.current)||void 0===t||t.style.setProperty(K("pull_offset"),`${Math.round(e)}px`),null===(r=X.current)||void 0===r||r.style.setProperty(K("pull_opacity"),`${k.current}`)},{prepareAnimation:fe}=Ae(G,((e,t,r)=>{if(G.current&&q)return{keyframes:[{transform:`translate(0, ${e.rect.y-t.y+r.y}px)`,opacity:e.opacity},{transform:"translate(0, 0)",opacity:1}],duration:e.duration,easing:o.easing.fade}})),he=(e,t)=>{if(d||u){me(e);let r=0;G.current&&(r=o.fade*(t?2:1),fe({rect:G.current.getBoundingClientRect(),opacity:k.current,duration:r})),z((()=>{me(0),b(et.NONE)}),r),b(et.ANIMATION),t||ce()}},{prepareAnimation:pe,isAnimationPlaying:xe}=Ae(G,((e,t,r)=>{var n;if(G.current&&q&&(null===(n=p.animation)||void 0===n?void 0:n.duration)){const n=te(a.spacing),o=(n.percent?n.percent*q.width/100:n.pixel)||0;return{keyframes:[{transform:`translate(${ne(p.globalIndex-e.index)*(q.width+o)+e.rect.x-t.x+r.x}px, 0)`},{transform:"translate(0, 0)"}],duration:p.animation.duration,easing:p.animation.easing}}})),be=Be((e=>{var t,r;const n=e.offset||0,a=n?o.swipe:null!==(t=o.navigation)&&void 0!==t?t:o.swipe,i=n||xe()?o.easing.swipe:o.easing.navigation;let{direction:l}=e;const s=null!==(r=e.count)&&void 0!==r?r:1;let c=et.ANIMATION,d=a*s;if(!l){const t=null==q?void 0:q.width,r=e.duration||0,o=t?a/t*Math.abs(n):a;0!==s?(r<o?d=d/o*Math.max(r,o/5):t&&(d=a/t*(t-Math.abs(n))),l=ne(n)>0?M:R):d=a/2}let u=0;l===M?de(ne(1))?u=-s:(c=et.NONE,d=a):l===R&&(de(ne(-1))?u=s:(c=et.NONE,d=a)),d=Math.round(d),A((()=>{ue(0),b(et.NONE)}),d),G.current&&pe({rect:G.current.getBoundingClientRect(),index:p.globalIndex}),b(c),P(_,{type:"swipe",increment:u,duration:d,easing:i})}));r.useEffect((()=>{var e,t;(null===(e=p.animation)||void 0===e?void 0:e.increment)&&(null===(t=p.animation)||void 0===t?void 0:t.duration)&&L((()=>x({type:"swipe",increment:0})),p.animation.duration)}),[p.animation,x,L]);const ye=[E,de,(null==q?void 0:q.width)||0,o.swipe,()=>b(et.SWIPE),e=>ue(e),(e,t)=>be({offset:e,duration:t,count:1}),e=>be({offset:e,count:0})],we=[()=>{u&&b(et.PULL)},e=>me(e),e=>he(e),e=>he(e,!0)];rt(i,...ye,d,u,...we,ce),function(e,t,n,a,o,i,l,s,c){const d=r.useRef(0),u=r.useRef(0),m=r.useRef(void 0),f=r.useRef(void 0),h=r.useRef(0),g=r.useRef(void 0),p=r.useRef(0),{setTimeout:x,clearTimeout:v}=Me(),b=r.useCallback((()=>{m.current&&(v(m.current),m.current=void 0)}),[v]),y=r.useCallback((()=>{f.current&&(v(f.current),f.current=void 0)}),[v]),w=Be((()=>{e!==et.SWIPE&&(d.current=0,p.current=0,b(),y())}));r.useEffect(w,[e,w]);const N=Be((e=>{f.current=void 0,d.current===e&&c(d.current)})),k=Be((t=>{if(t.ctrlKey)return;if(Math.abs(t.deltaY)>Math.abs(t.deltaX))return;const r=e=>{h.current=e,v(g.current),g.current=e>0?x((()=>{h.current=0,g.current=void 0}),300):void 0};if(e===et.NONE){if(Math.abs(t.deltaX)<=1.2*Math.abs(h.current))return void r(t.deltaX);if(!n(-t.deltaX))return;if(u.current+=t.deltaX,b(),Math.abs(u.current)>30)u.current=0,r(0),p.current=Date.now(),i();else{const e=u.current;m.current=x((()=>{m.current=void 0,e===u.current&&(u.current=0)}),o)}}else if(e===et.SWIPE){let e=d.current-t.deltaX;if(e=Math.min(Math.abs(e),a)*Math.sign(e),d.current=e,l(e),y(),Math.abs(e)>.2*a)return r(t.deltaX),void s(e,Date.now()-p.current);f.current=x((()=>N(e)),2*o)}else r(t.deltaX)}));r.useEffect((()=>t(F,k)),[t,k])}(v,...ye);const Ne=Be((()=>{i.focus&&Q().querySelector(`.${Y(N)} .${Y(nt())}`)&&ae()}));r.useEffect(Ne,[Ne]);const ke=Be((()=>{var e;null===(e=l.view)||void 0===e||e.call(l,{index:p.currentIndex})}));r.useEffect(ke,[p.globalIndex,ke]),r.useEffect((()=>Z(C(M,(e=>be({direction:M,...e}))),C(R,(e=>be({direction:R,...e}))),C(_,(e=>x(e))))),[C,be,x]);const Ee=r.useMemo((()=>({prev:le,next:se,close:ce,focus:ae,slideRect:q?re(q,a.padding):{width:0,height:0},containerRect:q||{width:0,height:0},subscribeSensors:E,containerRef:X,setCarouselRef:J,toolbarWidth:h,setToolbarWidth:g})),[le,se,ce,ae,E,q,X,J,h,g,a.padding]);return r.useImperativeHandle(i.ref,(()=>({prev:le,next:se,close:ce,focus:ae,getLightboxProps:oe,getLightboxState:ie})),[le,se,ce,ae,oe,ie]),r.createElement("div",{ref:V,className:H(Y(nt()),Y(S)),style:{...v===et.SWIPE?{[K("swipe_offset")]:`${Math.round(y.current)}px`}:null,...v===et.PULL?{[K("pull_offset")]:`${Math.round(w.current)}px`,[K("pull_opacity")]:`${k.current}`}:null,..."none"!==i.touchAction?{[K("controller_touch_action")]:i.touchAction}:null,...s.container},...i.aria?{role:"region","aria-live":"polite","aria-roledescription":"carousel"}:null,tabIndex:-1,...j},q&&r.createElement(at.Provider,{value:Ee},e,null===(n=c.controls)||void 0===n?void 0:n.call(c)))}));function lt(e){return q(y,e)}function st(e){return q(L,e)}function ct({slide:e,offset:t}){const n=r.useRef(null),{currentIndex:a}=je(),{slideRect:o,focus:i}=ot(),{render:l,carousel:{imageFit:s,imageProps:c},on:{click:d},styles:{slide:u}}=we(),{getOwnerDocument:m}=ge(),f=0!==t;r.useEffect((()=>{var e;f&&(null===(e=n.current)||void 0===e?void 0:e.contains(m().activeElement))&&i()}),[f,i,m]);return r.createElement("div",{ref:n,className:H(Y(st()),!f&&Y(st("current")),Y(S)),...(h=f,{inert:se?h:h?"":void 0}),style:u,role:"region","aria-roledescription":"slide"},(()=>{var n,i,u,m;let h=null===(n=l.slide)||void 0===n?void 0:n.call(l,{slide:e,offset:t,rect:o});return!h&&Q(e)&&(h=r.createElement(Je,{slide:e,offset:t,render:l,rect:o,imageFit:s,imageProps:c,onClick:f?void 0:()=>null==d?void 0:d({index:a})})),h?r.createElement(r.Fragment,null,null===(i=l.slideHeader)||void 0===i?void 0:i.call(l,{slide:e}),(null!==(u=l.slideContainer)&&void 0!==u?u:({children:e})=>e)({slide:e,children:h}),null===(m=l.slideFooter)||void 0===m?void 0:m.call(l,{slide:e})):null})());var h}function dt(){const e=we().styles.slide;return r.createElement("div",{className:Y(L),style:e})}const ut=de(y,(function({carousel:e}){const{slides:t,currentIndex:n,globalIndex:a}=je(),{setCarouselRef:o}=ot(),i=te(e.spacing),l=te(e.padding),s=function(e,t,r=0){return Math.min(e.preload,Math.max(e.finite?t.length-1:Math.floor(t.length/2),r))}(e,t,1),c=[];if(ae(t))for(let r=n-s;r<=n+s;r+=1){const o=oe(t,r),i=a-n+r,l=e.finite&&(r<0||r>t.length-1);c.push(l?{key:i}:{key:[`${i}`,le(o)].filter(Boolean).join("|"),offset:r-n,slide:o})}return r.createElement("div",{ref:o,className:H(Y(lt()),c.length>0&&Y(lt("with_slides"))),style:{[`${K(lt("slides_count"))}`]:c.length,[`${K(lt("spacing_px"))}`]:i.pixel||0,[`${K(lt("spacing_percent"))}`]:i.percent||0,[`${K(lt("padding_px"))}`]:l.pixel||0,[`${K(lt("padding_percent"))}`]:l.percent||0}},c.map((({key:e,slide:t,offset:n})=>t?r.createElement(ct,{key:e,slide:t,offset:n}):r.createElement(dt,{key:e}))))}));function mt(){const{carousel:e}=we(),{slides:t,currentIndex:r}=je();return{prevDisabled:0===t.length||e.finite&&0===r,nextDisabled:0===t.length||e.finite&&r===t.length-1}}function ft({label:e,icon:t,renderIcon:n,action:a,onClick:o,disabled:i,style:l}){return r.createElement(_e,{label:e,icon:t,renderIcon:n,className:Y(`navigation_${a}`),disabled:i,onClick:o,style:l,...Ke(ot().focus,i)})}const ht=de("navigation",(function({render:{buttonPrev:e,buttonNext:t,iconPrev:n,iconNext:a},styles:o}){const{prev:i,next:l,subscribeSensors:s}=ot(),{prevDisabled:c,nextDisabled:d}=mt();return function(e){var t;const n=qe(),{publish:a}=ve(),{animation:o}=we(),{prevDisabled:i,nextDisabled:l}=mt(),s=(null!==(t=o.navigation)&&void 0!==t?t:o.swipe)/2,c=Ve((()=>a(M)),s),d=Ve((()=>a(R)),s),u=Be((e=>{switch(e.key){case"Escape":a($);break;case"ArrowLeft":(n?l:i)||(n?d:c)();break;case"ArrowRight":(n?i:l)||(n?c:d)()}}));r.useEffect((()=>e(T,u)),[e,u])}(s),r.createElement(r.Fragment,null,e?e():r.createElement(ft,{label:"Previous",action:M,icon:De,renderIcon:n,style:o.navigationPrev,disabled:c,onClick:i}),t?t():r.createElement(ft,{label:"Next",action:R,icon:We,renderIcon:a,style:o.navigationNext,disabled:d,onClick:l}))})),gt=Y("no_scroll"),pt=Y(P);function xt(e){return"style"in e}function vt(e,t,r){const n=window.getComputedStyle(e),a=r?"padding-left":"padding-right",o=r?n.paddingLeft:n.paddingRight,i=e.style.getPropertyValue(a);return e.style.setProperty(a,`${(ee(o)||0)+t}px`),()=>{i?e.style.setProperty(a,i):e.style.removeProperty(a)}}const bt=de("no-scroll",(function({noScroll:{disabled:e},children:t}){const n=qe(),{getOwnerDocument:a,getOwnerWindow:o}=ge();return r.useEffect((()=>{if(e)return()=>{};const t=[],r=o(),{body:i,documentElement:l}=a(),s=Math.round(r.innerWidth-l.clientWidth);if(s>0){t.push(vt(i,s,n));const e=i.getElementsByTagName("*");for(let a=0;a<e.length;a+=1){const o=e[a];xt(o)&&"fixed"===r.getComputedStyle(o).getPropertyValue("position")&&!o.classList.contains(pt)&&t.push(vt(o,s,n))}}return i.classList.add(gt),()=>{i.classList.remove(gt),t.forEach((e=>e()))}}),[n,e,a,o]),r.createElement(r.Fragment,null,t)}));function yt(e){return q(N,e)}function wt(e,t,r){const n=e.getAttribute(t);return e.setAttribute(t,r),()=>{n?e.setAttribute(t,n):e.removeAttribute(t)}}const Nt=de(N,(function({children:e,animation:t,styles:a,className:o,on:i,portal:l,close:s}){const[c,d]=r.useState(!1),[u,m]=r.useState(!1),f=r.useRef([]),h=r.useRef(null),{setTimeout:g}=Me(),{subscribe:p}=ve(),x=Fe()?0:t.fade;r.useEffect((()=>(d(!0),()=>{d(!1),m(!1)})),[]);const v=Be((()=>{f.current.forEach((e=>e())),f.current=[]})),b=Be((()=>{var e;m(!1),v(),null===(e=i.exiting)||void 0===e||e.call(i),g((()=>{var e;null===(e=i.exited)||void 0===e||e.call(i),s()}),x)}));r.useEffect((()=>p($,b)),[p,b]);const y=Be((e=>{var t,r,n;!function(e){e.scrollTop}(e),m(!0),null===(t=i.entering)||void 0===t||t.call(i);const a=null!==(n=null===(r=e.parentNode)||void 0===r?void 0:r.children)&&void 0!==n?n:[];for(let o=0;o<a.length;o+=1){const t=a[o];-1===["TEMPLATE","SCRIPT","STYLE"].indexOf(t.tagName)&&t!==e&&(f.current.push(wt(t,"inert","")),f.current.push(wt(t,"aria-hidden","true")))}f.current.push((()=>{var e,t;null===(t=null===(e=h.current)||void 0===e?void 0:e.focus)||void 0===t||t.call(e)})),g((()=>{var e;null===(e=i.entered)||void 0===e||e.call(i)}),x)})),w=r.useCallback((e=>{e?y(e):v()}),[y,v]);return c?n.createPortal(r.createElement(Qe,{ref:w,className:H(o,Y(yt()),Y(P),u&&Y(yt("open"))),"aria-modal":!0,role:"dialog","aria-live":"polite","aria-roledescription":"lightbox",style:{...t.fade!==ce.animation.fade?{[K("fade_animation_duration")]:`${x}ms`}:null,...t.easing.fade!==ce.animation.easing.fade?{[K("fade_animation_timing_function")]:t.easing.fade}:null,...a.root},onFocus:e=>{h.current||(h.current=e.relatedTarget)}},e),l.root||document.body):null}));const kt=de("root",(function({children:e}){return r.createElement(r.Fragment,null,e)}));const jt=de(k,(function({toolbar:{buttons:e},render:{buttonClose:t,iconClose:n},styles:a}){const{close:o,setToolbarWidth:i}=ot(),{setContainerRef:l,containerRect:s}=ze();return Te((()=>{i(null==s?void 0:s.width)}),[i,null==s?void 0:s.width]),r.createElement("div",{ref:l,style:a.toolbar,className:Y(q(k,c))},null==e?void 0:e.map((e=>e===$?t?t():r.createElement(_e,{key:$,label:"Close",icon:Ie,renderIcon:n,onClick:o}):e)));var c}));function Et(e,t){var n;return r.createElement(e.module.component,{key:e.module.name,...t},null===(n=e.children)||void 0===n?void 0:n.map((e=>Et(e,t))))}function Ct(e,t={}){const{easing:r,...n}=e,{easing:a,...o}=t;return{easing:{...r,...a},...n,...o}}function St({carousel:e,animation:t,render:n,toolbar:a,controller:o,noScroll:i,on:l,plugins:s,slides:c,index:d,...u}){const{animation:m,carousel:f,render:h,toolbar:g,controller:p,noScroll:x,on:v,slides:b,index:y,plugins:N,...k}=ce,{config:j,augmentation:E}=function(e,t=[],r=[]){let n=e;const a=e=>{const t=[...n];for(;t.length>0;){const r=t.pop();if((null==r?void 0:r.module.name)===e)return!0;(null==r?void 0:r.children)&&t.push(...r.children)}return!1},o=(e,t)=>{n=""!==e?fe(n,e,(e=>[ue(t,[e])])):[ue(t,n)]},i=(e,t)=>{n=fe(n,e,(e=>[ue(e.module,[ue(t,e.children)])]))},l=(e,t,r)=>{n=fe(n,e,(e=>{var n;return[ue(e.module,[...r?[ue(t)]:[],...null!==(n=e.children)&&void 0!==n?n:[],...r?[]:[ue(t)]])]}))},s=(e,t,r)=>{n=fe(n,e,(e=>[...r?[ue(t)]:[],e,...r?[]:[ue(t)]]))},c=e=>{i(w,e)},d=(e,t)=>{n=fe(n,e,(e=>[ue(t,e.children)]))},u=e=>{n=fe(n,e,(e=>e.children))},m=e=>{r.push(e)};return t.forEach((e=>{e({contains:a,addParent:o,append:i,addChild:l,addSibling:s,addModule:c,replace:d,remove:u,augment:m})})),{config:n,augmentation:e=>r.reduce(((e,t)=>t(e)),e)}}([ue(Nt,[ue(bt,[ue(it,[ue(ut),ue(jt),ue(ht)])])])],s||N),C=E({animation:Ct(m,t),carousel:{...f,...e},render:{...h,...n},toolbar:{...g,...a},controller:{...p,...o},noScroll:{...x,...i},on:{...v,...l},...k,...u});return C.open?r.createElement(Ne,{...C},r.createElement(Pe,{slides:c||b,index:ee(d||y)},r.createElement(Re,null,r.createElement(be,null,Et(ue(kt,j),C))))):null}function Pt(){const[n,y]=r.useState([]),[w,N]=r.useState(null),[k,j]=r.useState([{id:null,name:"All Files"}]),[E,C]=r.useState(!0),[S,P]=r.useState(null),[L,M]=r.useState("list"),[R,_]=r.useState(""),[$,I]=r.useState(!1),[D,W]=r.useState(!1),[O,U]=r.useState([]),[T,F]=r.useState({}),[A,z]=r.useState(""),[X,B]=r.useState("date"),[H,Y]=r.useState("desc"),[K,q]=r.useState(null),[V,Z]=r.useState(null),[G,J]=r.useState(""),Q=r.useRef(null);a();const[ee,te]=r.useState({}),[re,ne]=r.useState(!1),ae=r.useRef(null),[oe,ie]=r.useState(!1),[le,se]=r.useState(0),[ce,de]=r.useState([]),[ue,me]=r.useState([]),fe=r.useCallback((async()=>{if(e){C(!0),P(null);try{let t=e.from("files").select("id, name, type, folder_id, uploaded_by, created_at, size, job_id, property_id, path");t=null===w?t.is("folder_id",null):t.eq("folder_id",w);const r=new URLSearchParams(window.location.search).get("job_id");r&&(t=t.eq("job_id",r));const{data:n,error:a}=await t.order("name");if(a)throw a;const o=(n||[]).map((e=>({...e,file_path:e.path||(e.job_id?`jobs/${e.job_id}/${e.name}`:`root/${e.name}`)})));y(o)}catch(t){P("Failed to load file items.")}finally{C(!1)}}}),[w]);r.useEffect((()=>{fe()}),[fe]);const he=async()=>{if(R.trim())try{const{data:t}=await e.auth.getUser();if(!t.user)throw new Error("Not authenticated");const r=new URLSearchParams(window.location.search).get("job_id");let n,a=null;if(r){const{data:t}=await e.from("jobs").select("property_id").eq("id",r).single();a=t?.property_id}n=r&&a?`properties/${a}/jobs/${r}/${w||""}/${R.trim()}`:w?`${w}/${R.trim()}`:`root/${R.trim()}`,n=n.replace(/\/+/g,"/");const{error:o}=await e.from("files").insert({name:R.trim(),type:"folder/directory",path:n,folder_id:w,uploaded_by:t.user.id,job_id:r||null,property_id:a,size:0});if(o)throw o;_(""),I(!1),fe()}catch(t){P("Failed to create folder.")}},ge=async t=>{if(confirm(`Are you sure you want to delete ${t.name}?`))try{const{error:r}=await e.from("files").delete().eq("id",t.id);if(r)throw r;fe()}catch(r){P("Failed to delete item.")}},pe=e=>{N(e.id),j([...k,{id:e.id,name:e.name}])},xe=e=>e.startsWith("image/")?t.jsx(g,{className:"h-5 w-5 text-blue-500"}):e.startsWith("video/")?t.jsx(p,{className:"h-5 w-5 text-purple-500"}):e.startsWith("audio/")?t.jsx(x,{className:"h-5 w-5 text-green-500"}):e.includes("zip")||e.includes("rar")?t.jsx(v,{className:"h-5 w-5 text-orange-500"}):t.jsx(b,{className:"h-5 w-5 text-gray-500"}),ve=async t=>{if(t.type.startsWith("image/"))try{const{data:r}=await e.storage.from("files").createSignedUrl(t.file_path,3600);return r?.signedUrl}catch(r){return null}return null};r.useEffect((()=>{(async()=>{const e={};for(const t of n)if(t.type.startsWith("image/")){const r=await ve(t);r&&(e[t.id]=r)}te(e)})()}),[n]);const be=[...n].sort(((e,t)=>{const r="asc"===H?1:-1;switch(X){case"name":return r*e.name.localeCompare(t.name);case"date":return r*(new Date(e.created_at).getTime()-new Date(t.created_at).getTime());case"size":return r*(e.size-t.size);case"type":return r*e.type.localeCompare(t.type);default:return 0}})).filter((e=>e.name.toLowerCase().includes(A.toLowerCase()))),ye=async t=>{try{const{data:r,error:n}=await e.storage.from("files").createSignedUrl(t.file_path,3600);if(n)throw n;if(!r?.signedUrl)throw new Error("No signed URL available");if("application/pdf"===t.type||t.type.startsWith("text/")||t.type.includes("document"))window.open(r.signedUrl,"_blank");else{const e=document.createElement("a");e.href=r.signedUrl,e.download=t.name,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(r){P("Failed to handle file.")}},we=t=>{t.type.startsWith("image/")?(async t=>{if(t.type.startsWith("image/"))try{const r=n.filter((e=>e.type.startsWith("image/"))),a=r.findIndex((e=>e.id===t.id)),o=await Promise.all(r.map((async t=>{const{data:r}=await e.storage.from("files").createSignedUrl(t.file_path,3600);return{src:r?.signedUrl||"",alt:t.name}})));de(o),se(a),ie(!0)}catch(r){P("Failed to open image preview.")}})(t):("application/pdf"===t.type||t.type.startsWith("text/")||t.type.includes("document"))&&ye(t)};return E?t.jsx("div",{className:"p-4 text-gray-900 dark:text-gray-100",children:"Loading..."}):S?t.jsxs("div",{className:"p-4 text-red-500 dark:text-red-400",children:["Error: ",S]}):t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"flex items-center space-x-2 mb-4",children:k.map(((e,r)=>t.jsxs(o.Fragment,{children:[r>0&&t.jsx("span",{className:"text-gray-500",children:"/"}),t.jsx("button",{onClick:()=>(e=>{N(k[e].id),j(k.slice(0,e+1))})(r),className:"text-blue-600 dark:text-blue-400 hover:underline",children:e.name})]},e.id||"root")))}),t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"File Manager"}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",value:A,onChange:e=>z(e.target.value),placeholder:"Search files...",className:"pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),t.jsx(i,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),t.jsxs("select",{value:X,onChange:e=>B(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[t.jsx("option",{value:"name",children:"Name"}),t.jsx("option",{value:"date",children:"Date"}),t.jsx("option",{value:"size",children:"Size"}),t.jsx("option",{value:"type",children:"Type"})]}),t.jsx("button",{onClick:()=>Y("asc"===H?"desc":"asc"),className:"p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:"asc"===H?"↑":"↓"}),t.jsx("button",{onClick:()=>M("list"===L?"grid":"list"),className:"p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:"list"===L?t.jsx(l,{className:"h-5 w-5"}):t.jsx(s,{className:"h-5 w-5"})}),t.jsxs("button",{onClick:()=>I(!0),className:"flex items-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(c,{className:"h-4 w-4 mr-2"}),"New Folder"]}),t.jsxs("button",{onClick:()=>W(!0),className:"flex items-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(d,{className:"h-4 w-4 mr-2"}),"Upload Files"]})]})]}),$&&t.jsxs("div",{className:"mb-4 flex items-center space-x-2",children:[t.jsx("input",{type:"text",value:R,onChange:e=>_(e.target.value),placeholder:"Enter folder name",className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",onKeyPress:e=>"Enter"===e.key&&he()}),t.jsx("button",{onClick:he,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Create"}),t.jsx("button",{onClick:()=>{I(!1),_("")},className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100 text-sm font-medium rounded-lg transition-colors",children:"Cancel"})]}),0===be.length?t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No items found."}):"list"===L?t.jsx("ul",{className:"space-y-2",children:be.map((e=>{return t.jsxs("li",{className:"p-3 border border-gray-200 dark:border-gray-700 rounded-lg flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors "+(ue.includes(e.id)?"bg-blue-50 dark:bg-blue-900/20":""),onClick:t=>{return r=e.id,void((n=t).ctrlKey||n.metaKey?me((e=>e.includes(r)?e.filter((e=>e!==r)):[...e,r])):me([r]));var r,n},children:[t.jsx("div",{className:"flex items-center space-x-4 flex-1",children:"folder/directory"===e.type?t.jsxs("button",{onClick:()=>pe(e),className:"flex items-center text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 w-full",children:[t.jsx(u,{className:"h-5 w-5 mr-3 text-yellow-500"}),t.jsx("span",{children:e.name})]}):t.jsxs("button",{onClick:()=>we(e),className:"flex items-center w-full hover:text-blue-600 dark:hover:text-blue-400",children:[e.type.startsWith("image/")&&ee[e.id]?t.jsx("img",{src:ee[e.id],alt:e.name,className:"h-8 w-8 object-cover rounded mr-3"}):t.jsx("div",{className:"mr-3",children:xe(e.type)}),t.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.name})]})}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:(r=e.created_at,new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>ye(e),className:"p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx(m,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>ge(e),className:"p-1 text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400",children:t.jsx(f,{className:"h-4 w-4"})})]})]})]},e.id);var r}))}):t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:be.map((e=>t.jsx("div",{className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:t.jsxs("div",{className:"flex flex-col items-center",children:["folder/directory"===e.type?t.jsxs("button",{onClick:()=>pe(e),className:"flex flex-col items-center text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 w-full",children:[t.jsx(u,{className:"h-8 w-8 mb-2 text-yellow-500"}),t.jsx("span",{className:"text-center mb-2",children:e.name})]}):t.jsxs("button",{onClick:()=>we(e),className:"flex flex-col items-center w-full hover:text-blue-600 dark:hover:text-blue-400",children:[e.type.startsWith("image/")&&ee[e.id]?t.jsx("img",{src:ee[e.id],alt:e.name,className:"h-24 w-24 object-cover rounded mb-2"}):t.jsx("div",{className:"h-24 w-24 flex items-center justify-center mb-2",children:xe(e.type)}),t.jsx("span",{className:"mt-2 text-center mb-2 text-gray-900 dark:text-gray-100",children:e.name})]}),t.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[t.jsx("button",{onClick:()=>ye(e),className:"p-2 text-gray-500 hover:text-blue-500 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",title:"Download",children:t.jsx(m,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>ge(e),className:"p-2 text-gray-500 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400 transition-colors",children:t.jsx(f,{className:"h-5 w-5"})})]})]})},e.id)))}),D&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Files"}),t.jsx("button",{onClick:()=>{W(!1),U([]),F({}),te({})},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx(h,{className:"h-6 w-6"})})]}),t.jsxs("div",{ref:ae,className:"mb-4 border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors "+(re?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-500"),onClick:()=>Q.current?.click(),onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),ne(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),ne(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{e.preventDefault(),e.stopPropagation(),ne(!1);const t=Array.from(e.dataTransfer.files);U(t),W(!0)},children:[t.jsx("input",{ref:Q,type:"file",multiple:!0,onChange:e=>{if(e.target.files){const t=Array.from(e.target.files);U(t);const r={};t.forEach((e=>{const t=(e=>e.type.startsWith("image/")?URL.createObjectURL(e):null)(e);t&&(r[e.name]=t)})),te(r)}},className:"hidden"}),t.jsx(d,{className:"mx-auto h-12 w-12 text-gray-500 dark:text-gray-400 mb-4"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-400 mb-2",children:"Drag and drop files here, or click to select files"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:"Maximum file size: 50MB"})]}),O.length>0&&t.jsx("div",{className:"space-y-4 mb-4",children:O.map(((e,r)=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[e.type.startsWith("image/")&&ee[e.name]?t.jsx("img",{src:ee[e.name],alt:e.name,className:"h-10 w-10 object-cover rounded"}):t.jsx("div",{className:"h-10 w-10 flex items-center justify-center",children:xe(e.type)}),t.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:e.name})]}),T[e.name]&&t.jsx("div",{className:"w-24 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${T[e.name]}%`}})})]},r)))}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:()=>{W(!1),U([]),F({}),te({})},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(0!==O.length)try{const{data:t}=await e.auth.getUser();if(!t.user)throw new Error("Not authenticated");const r=new URLSearchParams(window.location.search).get("job_id");let n=null;if(r){const{data:t}=await e.from("jobs").select("property_id").eq("id",r).single();n=t?.property_id}for(const a of O){let o;o=r&&n?`properties/${n}/jobs/${r}/${w||""}/${Date.now()}_${a.name}`:w?`${w}/${Date.now()}_${a.name}`:`root/${Date.now()}_${a.name}`,o=o.replace(/\/+/g,"/");const{error:i}=await e.storage.from("files").upload(o,a);if(i)throw i;const{error:l}=await e.from("files").insert({name:a.name,type:a.type,size:a.size,path:o,folder_id:w,uploaded_by:t.user.id,job_id:r||null,property_id:n});if(l)throw l;F((e=>({...e,[a.name]:100})))}U([]),W(!1),F({}),fe()}catch(t){P("Failed to upload files.")}},disabled:0===O.length,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50",children:"Upload"})]})]})}),V&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Rename"}),t.jsx("button",{onClick:()=>{Z(null),J("")},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:t.jsx(h,{className:"h-6 w-6"})})]}),t.jsx("input",{type:"text",value:G,onChange:e=>J(e.target.value),placeholder:"Enter new name",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 mb-4"}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:()=>{Z(null),J("")},className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),t.jsx("button",{onClick:()=>(async t=>{if(G.trim())try{const{error:r}=await e.from("files").update({name:G.trim()}).eq("id",t.id);if(r)throw r;Z(null),J(""),fe()}catch(r){P("Failed to rename item.")}})(V),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Rename"})]})]})}),t.jsx(St,{open:oe,close:()=>ie(!1),index:le,slides:ce,carousel:{padding:"16px",spacing:"16px"},controller:{closeOnBackdropClick:!0},animation:{fade:300}}),ue.length>0&&t.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-4",children:t.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[t.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[ue.length," items selected"]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{onClick:async()=>{if(ue.length&&confirm(`Are you sure you want to delete ${ue.length} items?`))try{const t=n.filter((e=>ue.includes(e.id)));for(const n of t)"folder/directory"!==n.type&&await e.storage.from("files").remove([n.file_path]);const{error:r}=await e.from("files").delete().in("id",ue);if(r)throw r;me([]),fe()}catch(t){P("Failed to delete items.")}},className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Delete Selected"}),t.jsx("button",{onClick:()=>me([]),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})})]})}export{Pt as FileManager};
