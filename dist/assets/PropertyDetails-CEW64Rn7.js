import{j as e,s as t,b as a}from"./index-DSvJvUB2.js";import{k as r,u as s,r as d,L as l}from"./react-vendor-BmeRVKJv.js";import{P as i}from"./PropertyMap-DAli-ETh.js";import{u as n}from"./useSessionValidation-DqgMRuY1.js";import{w as c}from"./supabaseErrorHandler-C0_Arg9J.js";import{u as x,J as o}from"./useJobFetch-eNBkwTTl.js";import{f as m}from"./utils-DJWOA4Os.js";import{z as g,B as p,a0 as h,M as y,a1 as u,a2 as b,q as j,I as k,P as N,N as w}from"./ui-CiwSAYI4.js";import"./supabase-c3qFLfUQ.js";import"./leaflet-D5r8Lo0S.js";import"./pdf-BIHRzquI.js";function f(){const{propertyId:f}=r(),v=s();n();const{jobs:_,loading:C,error:A}=x({phaseLabel:["Job Request","Work Order","Pending Work Order","Invoicing","Completed","Cancelled"]}),B=_.filter((e=>e.property.id===f)),[P,E]=d.useState(null),[D,S]=d.useState(!0),[q,F]=d.useState(null),[M,U]=d.useState([]),[z,I]=d.useState({}),[R,$]=d.useState({}),[T,L]=d.useState([]),[J,H]=d.useState([]),[O,W]=d.useState([]),[G,Q]=d.useState(!1),[K,V]=d.useState({callback_date:m(new Date,"yyyy-MM-dd"),painter:"",unit_number:"",reason:""}),[Y,X]=d.useState(!1),[Z,ee]=d.useState({update_date:m(new Date,"yyyy-MM-dd"),update_type:"",note:""}),[te,ae]=d.useState(null),[re,se]=d.useState(null),de=P?[P.address,P.city,P.state,P.zip].filter(Boolean).join(", "):"";d.useEffect((()=>{(async()=>{try{S(!0),F(null);const{data:e,error:r}=await t.from("property_updates").select("update_type");if(!r&&e){const t=Array.from(new Set(e.map((e=>e.update_type))));W(t)}if(!f)return a.error("Property ID is required"),S(!1),void v("/dashboard/properties");const{data:s,error:d}=await t.from("properties").select("\n            *,\n            property_management_group:property_management_groups!fk_property_management_group(\n              company_name\n            )\n          ").eq("id",f).single();if(d)throw d;if(!s)return a.error("Property not found"),S(!1),void v("/dashboard/properties");E(s);const{data:l,error:i}=await t.from("billing_categories").select("*").eq("property_id",f).order("sort_order");if(i)throw i;if(U(l||[]),l?.length){const{data:e,error:a}=await t.from("billing_details").select("*").eq("property_id",f);if(a)throw a;const r={};e?.forEach((e=>{r[e.category_id]||(r[e.category_id]=[]),r[e.category_id].push(e)})),I(r);const{data:s,error:d}=await t.from("unit_sizes").select("*");if(d)throw d;const l={};s?.forEach((e=>{l[e.id]=e.unit_size_label})),$(l)}const{data:n,error:c}=await t.from("property_callbacks").select("\n            *,\n            poster:profiles(full_name)\n          ").eq("property_id",f).order("callback_date",{ascending:!1});if(c)throw c;L(n||[]);const{data:x,error:o}=await t.from("property_updates").select("\n            *,\n            poster:profiles(full_name)\n          ").eq("property_id",f).order("update_date",{ascending:!1});if(o)throw o;H(x||[]),S(!1)}catch(e){F("Failed to load property details"),S(!1)}})()}),[f,v]);return D?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):q||!P?e.jsx("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A]",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>v("/dashboard/properties"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:e.jsx(g,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Property Details"})]})}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:q||"Property not found"}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>v("/dashboard/properties"),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Back to Properties"})})]})}):e.jsxs("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(p,{className:"h-8 w-8 text-gray-600 dark:text-gray-400"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:P.property_name})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{type:"button",onClick:()=>v(`/dashboard/properties/${P.id}/edit`),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Edit Property"]}),e.jsx("button",{type:"button",onClick:()=>v("/dashboard/properties"),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#2D3B4E] rounded-lg hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors",children:"Back to List"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Location"})]}),P&&P.address?e.jsx(i,{address:de,className:"w-full h-[300px]"}):e.jsx("div",{className:"flex items-center justify-center h-[300px] bg-gray-100 dark:bg-[#0F172A] rounded-lg border border-dashed border-gray-300 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No address available"})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Basic Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Address"}),e.jsxs("p",{className:"text-gray-900 dark:text-white",children:[P.address,P.address_2&&e.jsxs("span",{children:[e.jsx("br",{}),P.address_2]}),e.jsx("br",{}),P.city,", ",P.state," ",P.zip]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(p,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Property Management Group"}),e.jsx(l,{to:`/dashboard/property-groups/${P.property_management_group_id}`,className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:P.property_management_group?.company_name||"No Group Assigned"})]})]}),P.phone&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(u,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Phone"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.phone})]})]}),P.region&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Region"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.region})]})]}),P.property_grade&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(b,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Property Grade"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.property_grade})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Contact Information"}),e.jsxs("div",{className:"space-y-6",children:[(P.community_manager_name||P.community_manager_email||P.community_manager_phone)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Community Manager"}),e.jsxs("div",{className:"space-y-2",children:[P.community_manager_name&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.community_manager_name})]}),P.community_manager_email&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.community_manager_email})]}),P.community_manager_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.community_manager_phone})]})]})]}),(P.maintenance_supervisor_name||P.maintenance_supervisor_email||P.maintenance_supervisor_phone)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Maintenance Supervisor"}),e.jsxs("div",{className:"space-y-2",children:[P.maintenance_supervisor_name&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.maintenance_supervisor_name})]}),P.maintenance_supervisor_email&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.maintenance_supervisor_email})]}),P.maintenance_supervisor_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.maintenance_supervisor_phone})]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Paint Colors"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[P.color_walls&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Walls"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_walls})]}),P.color_trim&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Trim"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_trim})]}),P.color_regular_unit&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Regular Unit"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_regular_unit})]}),P.color_kitchen_bathroom&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Kitchen/Bathroom"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_kitchen_bathroom})]}),P.color_ceilings&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ceilings"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_ceilings})]}),P.paint_location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Paint Location"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.paint_location})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Compliance Information"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Compliance Required"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_required||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Compliance Approved"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_approved||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Bid Approved"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_bid_approved||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"PO Needed"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_po_needed||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"W9 Created"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_w9_created||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"COI Address"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_coi_address||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Create Sub Prop Portal"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_create_sub_prop_portal||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Notify Team"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_notify_team||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Upload Documents"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_upload_documents||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Invoice Delivery"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_invoice_delivery||"N/A"})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Billing Information"}),e.jsxs("button",{onClick:()=>v(`/dashboard/properties/${P.id}/billing`),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(N,{className:"h-4 w-4 mr-2 inline-block"}),"Manage Billing Details"]})]}),e.jsxs("div",{className:"space-y-6",children:[(P.ap_name||P.ap_email||P.ap_phone)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"AP Contact"}),e.jsxs("div",{className:"space-y-2",children:[P.ap_name&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.ap_name})]}),P.ap_email&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.ap_email})]}),P.ap_phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:P.ap_phone})]})]})]}),P.quickbooks_number&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"QuickBooks Number"}),e.jsx("p",{className:"text-gray-900 dark:text-white",children:P.quickbooks_number})]}),P.billing_notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Billing Notes"}),e.jsx("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:P.billing_notes})]}),M.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Billing Details"}),e.jsx("div",{className:"space-y-4",children:M.map((t=>e.jsxs("div",{className:"bg-gray-50 dark:bg-[#0F172A] rounded-lg p-4",children:[e.jsx("h5",{className:"text-gray-900 dark:text-white font-medium mb-2",children:t.name}),e.jsx("div",{className:"space-y-2",children:z[t.id]?.map((t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:R[t.unit_size_id]}),e.jsxs("div",{className:"space-x-4",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Bill: $",t.bill_amount]}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Sub Pay: $",t.sub_pay_amount]}),!t.is_hourly&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Profit: $",t.profit_amount]}),t.is_hourly&&e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Hourly Rate"})]})]},t.unit_size_id)))})]},t.id)))})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Callbacks"}),e.jsxs("button",{onClick:()=>Q(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(N,{className:"h-4 w-4 mr-2 inline-block"}),"Add Callback"]})]}),0===T.length?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No callbacks recorded for this property"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-[#0F172A]",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Painter"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Unit"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Reason"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Posted By"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-[#1E293B] divide-y divide-gray-200 dark:divide-gray-700",children:T.map((t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:new Date(t.callback_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.painter||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.unit_number}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:t.reason}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.poster?.full_name||"Unknown"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>ae(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",children:e.jsx(w,{className:"h-4 w-4"})})})]},t.id)))})]})}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New Callback"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:K.callback_date,onChange:e=>V({...K,callback_date:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Painter"}),e.jsx("input",{type:"text",value:K.painter,onChange:e=>V({...K,painter:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",placeholder:"Enter painter name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Unit #"}),e.jsx("input",{type:"text",value:K.unit_number,onChange:e=>V({...K,unit_number:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",placeholder:"Enter unit number",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reason"}),e.jsx("textarea",{value:K.reason,onChange:e=>V({...K,reason:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",placeholder:"Enter reason for callback",rows:3,required:!0})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>Q(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{if(f)if(K.callback_date.trim())if(K.unit_number.trim())if(K.reason.trim())try{const{data:e,error:r}=await c(t.from("property_callbacks").insert({property_id:f,callback_date:K.callback_date,painter:K.painter,unit_number:K.unit_number,reason:K.reason}).select("\n            *,\n            poster:profiles(full_name)\n          "),"add-callback");if(r)return void a.error(`Failed to add callback: ${r.message}`);e&&(L((t=>[e[0],...t])),Q(!1),V({callback_date:m(new Date,"yyyy-MM-dd"),painter:"",unit_number:"",reason:""}),a.success("Callback added successfully"))}catch(e){a.error("An unexpected error occurred.")}else a.error("Reason is required");else a.error("Unit number is required");else a.error("Callback date is required");else a.error("You must be logged in to add a callback.")},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Callback"})]})]})}),te&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Callback"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Are you sure you want to delete this callback? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>ae(null),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>(async e=>{try{const{error:r}=await t.from("property_callbacks").delete().eq("id",e);if(r)throw r;ae(null);const{data:s,error:d}=await t.from("property_callbacks").select("\n          *,\n          poster:profiles(full_name)\n        ").eq("property_id",f).order("callback_date",{ascending:!1});if(d)throw d;L(s||[]),a.success("Callback deleted successfully")}catch(r){a.error("Failed to delete callback")}})(te),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-3 mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Property Updates / Notes"}),e.jsxs("button",{onClick:()=>X(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(N,{className:"h-4 w-4 mr-2 inline-block"}),"Add Note"]})]}),0===J.length?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No updates recorded for this property"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-[#0F172A]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Note"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Posted By"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-[#1E293B] divide-y divide-gray-200 dark:divide-gray-700",children:J.map((t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:m(new Date(t.update_date),"MM/dd/yyyy")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.update_type}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:t.note}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.poster.full_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>se(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",children:e.jsx(w,{className:"h-4 w-4"})})})]},t.id)))})]})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New Update/Note"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Date"}),e.jsx("input",{type:"date",value:Z.update_date,onChange:e=>ee({...Z,update_date:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),e.jsxs("select",{value:Z.update_type,onChange:e=>ee({...Z,update_type:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"",children:"Select a type..."}),O.map((t=>e.jsx("option",{value:t,children:t},t)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Note"}),e.jsx("textarea",{value:Z.note,onChange:e=>ee({...Z,note:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white h-24",placeholder:"Enter note details"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>X(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"button",onClick:async()=>{if(!f)return void a.error("Property ID is required to add a note.");const{data:e,error:r}=await t.auth.getSession();if(r||!e.session)return void a.error("Authentication error. Please log in again.");const s=e.session.user.id;if(!Z.update_date.trim()||!Z.update_type.trim()||!Z.note.trim())return void a.error("All fields are required for an update.");const{data:d,error:l}=await c(t.from("property_updates").insert({property_id:f,update_date:Z.update_date,update_type:Z.update_type,note:Z.note,posted_by:s}).select("\n          *,\n          poster:profiles(full_name)\n        "),"add-update");l?a.error(`Failed to add update: ${l.message}`):d&&(H((e=>[d[0],...e])),X(!1),ee({update_date:m(new Date,"yyyy-MM-dd"),update_type:"",note:""}),a.success("Update added successfully"))},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Update"})]})]})}),re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Update"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Are you sure you want to delete this update? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>se(null),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>(async e=>{try{const{error:r}=await t.from("property_updates").delete().eq("id",e);if(r)throw r;se(null);const{data:s,error:d}=await t.from("property_updates").select("\n          *,\n          poster:profiles(full_name)\n        ").eq("property_id",f).order("update_date",{ascending:!1});if(d)throw d;H(s||[]),a.success("Update deleted successfully")}catch(r){a.error("Failed to delete update")}})(re),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-3 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Job History"}),e.jsx(o,{title:"Job History",jobs:B,loading:C,error:A??null,showAddButton:!1})]})]})]})}export{f as PropertyDetails};
