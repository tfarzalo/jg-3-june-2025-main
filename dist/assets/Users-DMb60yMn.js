import{s as e,j as r,b as a}from"./index-trbIQK5H.js";import{r as t,L as s}from"./react-vendor-BmeRVKJv.js";import{j as l,a3 as d,ac as n,m as i,n as o,b as c,ad as x,U as m,q as u,X as g,ae as h,k as b,af as p,K as y,N as f}from"./ui-CiwSAYI4.js";import"./supabase-c3qFLfUQ.js";function w(){const[w,j]=t.useState([]),[k,v]=t.useState([]),[N,_]=t.useState(!0),[C,S]=t.useState(null),[E,F]=t.useState(""),[B,P]=t.useState(!1),[A,D]=t.useState(!1),[U,$]=t.useState(!1),[q,M]=t.useState(!1),[O,I]=t.useState(null),[R,z]=t.useState(!1),[J,T]=t.useState(!1),[G,L]=t.useState([]),[V,K]=t.useState(!1),[X,H]=t.useState(new Set),[Q,W]=t.useState({email:"",password:"",confirmPassword:"",full_name:"",role:"user"}),[Y,Z]=t.useState({password:"",confirmPassword:""}),ee=t.useCallback((async()=>{let r=null;try{_(!0);const{data:{user:a}}=await e.auth.getUser();if(!a||!a.id)throw new Error("No current user found or user id missing");const t=(new Date).toISOString(),s={last_seen:t,updated_at:t},{error:l,data:d}=await e.from("profiles").update(s).eq("id",a.id),{data:n,error:i}=await e.from("profiles").select("*").order("created_at",{ascending:!1});if(i)throw i;const o=n?.map((e=>({...e,last_seen:e.id===a.id?t:e.last_seen||e.updated_at||e.created_at})))||[];j(o),v(o),r=e.channel("online_users",{config:{broadcast:{self:!0}}}).on("presence",{event:"sync"},(()=>{const t=r.presenceState(),s=new Set(Object.keys(t));s.add(a.id),H(s);const l=(new Date).toISOString();s.forEach((async r=>{await e.from("profiles").update({last_seen:l,updated_at:l}).eq("id",r)}))})).subscribe((async e=>{"SUBSCRIBED"===e&&await r.track({user_id:a.id,last_seen:(new Date).toISOString()})}));const c=setInterval((async()=>{const r=(new Date).toISOString();await e.from("profiles").update({last_seen:r,updated_at:r}).eq("id",a.id),j((e=>e.map((e=>e.id===a.id?{...e,last_seen:r}:e)))),v((e=>e.map((e=>e.id===a.id?{...e,last_seen:r}:e))))}),15e3);return()=>{clearInterval(c),r&&r.unsubscribe()}}catch(a){S(a instanceof Error?a.message:"Failed to fetch users")}finally{_(!1)}}),[]);t.useEffect((()=>{let e;return(async()=>{e=await ee()})(),()=>{e&&e()}}),[ee]),t.useEffect((()=>{let e=w;if(E){const r=E.toLowerCase();e=e.filter((e=>e.email.toLowerCase().includes(r)||e.full_name&&e.full_name.toLowerCase().includes(r)))}G.length>0&&(e=e.filter((e=>G.includes(e.role)))),v(e)}),[w,E,G]);const re=e=>{L((r=>r.includes(e)?r.filter((r=>r!==e)):[...r,e]))},ae=e=>{switch(e){case"admin":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"jg_management":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";case"subcontractor":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},te=e=>{switch(e){case"admin":return r.jsx(x,{className:"h-4 w-4 mr-1"});case"jg_management":return r.jsx(m,{className:"h-4 w-4 mr-1"});default:return r.jsx(u,{className:"h-4 w-4 mr-1"})}},se=e=>{if(!e)return"Never";const r=new Date(e),a=new Date,t=Math.floor((a.getTime()-r.getTime())/6e4),s=Math.floor(t/60),l=Math.floor(s/24);return t<1?"Currently Online":t<60?`${t} minute${1===t?"":"s"} ago`:s<24?`${s} hour${1===s?"":"s"} ago`:l<7?`${l} day${1===l?"":"s"} ago`:l<30?`${Math.floor(l/7)} week${1===Math.floor(l/7)?"":"s"} ago`:l<365?`${Math.floor(l/30)} month${1===Math.floor(l/30)?"":"s"} ago`:`${Math.floor(l/365)} year${1===Math.floor(l/365)?"":"s"} ago`};return N&&!R?r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r.jsxs("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A] min-h-screen",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(l,{className:"h-8 w-8 text-gray-600 dark:text-gray-400"}),r.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Users"})]}),r.jsxs("div",{className:"flex space-x-3",children:[r.jsxs("button",{onClick:async()=>{z(!0),await ee(),z(!1)},disabled:R,className:"inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[r.jsx(d,{className:"h-4 w-4 mr-2 "+(R?"animate-spin":"")}),"Refresh"]}),r.jsxs("button",{onClick:()=>{W({email:"",password:"",confirmPassword:"",full_name:"",role:"user"}),P(!0)},className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[r.jsx(n,{className:"h-4 w-4 mr-2"}),"Add User"]})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsxs("div",{className:"relative flex-1 max-w-md",children:[r.jsx(i,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search users...",value:E,onChange:e=>F(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#1E293B] rounded-lg text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>T(!J),className:"flex items-center px-4 py-2 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors",children:[r.jsx(o,{className:"h-4 w-4 mr-2"}),"Filter by Role",r.jsx(c,{className:"h-4 w-4 ml-2"})]}),J&&r.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-[#1E293B] rounded-lg shadow-lg z-10 border border-gray-200 dark:border-[#2D3B4E]",children:[r.jsxs("div",{className:"p-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"User Roles"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:G.includes("admin"),onChange:()=>re("admin"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"}),r.jsxs("span",{className:"ml-2 text-gray-700 dark:text-gray-300 flex items-center",children:[r.jsx(x,{className:"h-4 w-4 mr-1 text-red-600 dark:text-red-400"}),"Admin"]})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:G.includes("jg_management"),onChange:()=>re("jg_management"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"}),r.jsxs("span",{className:"ml-2 text-gray-700 dark:text-gray-300 flex items-center",children:[r.jsx(m,{className:"h-4 w-4 mr-1 text-purple-600 dark:text-purple-400"}),"JG Management"]})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:G.includes("subcontractor"),onChange:()=>re("subcontractor"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"}),r.jsxs("span",{className:"ml-2 text-gray-700 dark:text-gray-300 flex items-center",children:[r.jsx(u,{className:"h-4 w-4 mr-1 text-blue-600 dark:text-blue-400"}),"Subcontractor"]})]}),r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",checked:G.includes("user"),onChange:()=>re("user"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-600 rounded"}),r.jsxs("span",{className:"ml-2 text-gray-700 dark:text-gray-300 flex items-center",children:[r.jsx(u,{className:"h-4 w-4 mr-1 text-gray-600 dark:text-gray-400"}),"Regular User"]})]})]})]}),r.jsx("div",{className:"border-t border-gray-200 dark:border-[#2D3B4E] p-4 flex justify-end",children:r.jsx("button",{onClick:()=>L([]),className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:"Reset Filters"})})]})]})]}),C&&r.jsx("div",{className:"mb-6 bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:C}),G.length>0&&r.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[G.map((e=>r.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm ${ae(e)}`,children:[te(e),r.jsx("span",{children:"jg_management"===e?"JG Management":e.charAt(0).toUpperCase()+e.slice(1)}),r.jsx("button",{onClick:()=>re(e),className:"ml-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:r.jsx(g,{className:"h-4 w-4"})})]},e))),r.jsx("button",{onClick:()=>L([]),className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full",children:"Clear All Filters"})]}),r.jsx("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg overflow-hidden shadow",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-[#2D3B4E]",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),r.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Email"}),r.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Role"}),r.jsx("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Last Seen"}),r.jsx("th",{scope:"col",className:"px-6 py-4 text-right text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-[#2D3B4E]",children:0===k.length?r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:"No users found"})}):k.map((e=>r.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("div",{className:"flex items-center",children:[r.jsxs("div",{className:"flex-shrink-0 h-10 w-10 relative",children:[e.avatar_url?r.jsx("img",{src:`https://tbwtfimnbmvbgesidbxh.supabase.co/storage/v1/object/public/avatars/${e.avatar_url}`,alt:e.full_name||"User",className:"h-10 w-10 rounded-full object-cover"}):r.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:r.jsx("span",{className:"text-blue-800 dark:text-blue-300 font-medium",children:e.full_name?e.full_name.charAt(0).toUpperCase():e.email.charAt(0).toUpperCase()})}),r.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white dark:border-[#1E293B] "+(X.has(e.id)?"bg-green-500":"bg-red-500"),title:X.has(e.id)?"Online":"Offline"})]}),r.jsx("div",{className:"ml-4",children:r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.full_name||"Unnamed User"})})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:e.email})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${ae(e.role)}`,children:[te(e.role),"jg_management"===e.role?"JG Management":e.role.charAt(0).toUpperCase()+e.role.slice(1)]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-2 h-2 rounded-full mr-2 "+(X.has(e.id)?"bg-green-500":"bg-red-500")}),r.jsx("span",{children:se(e.last_seen)})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:r.jsxs("div",{className:"flex justify-end space-x-3",children:["subcontractor"===e.role&&r.jsx(s,{to:`/dashboard/subcontractor?userId=${e.id}`,className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300",title:"View Subcontractor Dashboard",children:r.jsx(h,{className:"h-5 w-5"})}),"subcontractor"===e.role&&r.jsx(s,{to:"/dashboard/sub-scheduler",className:"text-purple-600 dark:text-purple-400 hover:text-purple-900 dark:hover:text-purple-300",title:"View Subcontractor Schedule",children:r.jsx(b,{className:"h-5 w-5"})}),r.jsx("button",{onClick:()=>{I(e),Z({password:"",confirmPassword:""}),M(!0)},className:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300",title:"Change Password",children:r.jsx(p,{className:"h-5 w-5"})}),r.jsx("button",{onClick:()=>{I(e),W({email:e.email,password:"",confirmPassword:"",full_name:e.full_name||"",role:e.role}),D(!0)},className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300",title:"Edit User",children:r.jsx(y,{className:"h-5 w-5"})}),r.jsx("button",{onClick:()=>{I(e),$(!0)},className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",title:"Delete User",children:r.jsx(f,{className:"h-5 w-5"})})]})})]},e.id)))})]})})]}),B&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New User"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email Address"}),r.jsx("input",{type:"email",id:"email",value:Q.email,onChange:e=>W({...Q,email:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Name"}),r.jsx("input",{type:"text",id:"full_name",value:Q.full_name,onChange:e=>W({...Q,full_name:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),r.jsx("input",{type:"password",id:"password",value:Q.password,onChange:e=>W({...Q,password:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirm Password"}),r.jsx("input",{type:"password",id:"confirmPassword",value:Q.confirmPassword,onChange:e=>W({...Q,confirmPassword:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Role"}),r.jsxs("select",{id:"role",value:Q.role,onChange:e=>W({...Q,role:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0,children:[r.jsx("option",{value:"user",children:"User"}),r.jsx("option",{value:"admin",children:"Admin"}),r.jsx("option",{value:"jg_management",children:"JG Management"}),r.jsx("option",{value:"subcontractor",children:"Subcontractor"})]})]})]}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>P(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"button",onClick:async()=>{try{if(!(Q.email&&Q.password&&Q.full_name&&Q.role))return void a.error("Please fill in all required fields");if(Q.password!==Q.confirmPassword)return void a.error("Passwords do not match");const r="https://tbwtfimnbmvbgesidbxh.supabase.co/functions/v1/create-user",t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(await e.auth.getSession()).data.session?.access_token}`},body:JSON.stringify({email:Q.email,password:Q.password,full_name:Q.full_name,role:Q.role})}),s=await t.json();if(!s.success)throw new Error(s.error||"Failed to create user");a.success("User created successfully"),W({email:"",password:"",confirmPassword:"",full_name:"",role:"user"}),P(!1),ee()}catch(r){a.error(r instanceof Error?r.message:"Failed to create user")}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add User"})]})]})}),A&&O&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Edit User"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"edit-email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email Address"}),r.jsx("input",{type:"email",id:"edit-email",value:Q.email,onChange:e=>W({...Q,email:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"edit-full_name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Name"}),r.jsx("input",{type:"text",id:"edit-full_name",value:Q.full_name,onChange:e=>W({...Q,full_name:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"edit-role",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Role"}),r.jsxs("select",{id:"edit-role",value:Q.role,onChange:e=>W({...Q,role:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0,children:[r.jsx("option",{value:"user",children:"User"}),r.jsx("option",{value:"admin",children:"Admin"}),r.jsx("option",{value:"jg_management",children:"JG Management"}),r.jsx("option",{value:"subcontractor",children:"Subcontractor"})]})]})]}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>D(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"button",onClick:async()=>{try{if(!O)return;if(!Q.email||!Q.full_name||!Q.role)return void a.error("Please fill in all required fields");const{error:r}=await e.from("profiles").update({email:Q.email,full_name:Q.full_name,role:Q.role}).eq("id",O.id);if(r)throw r;a.success("User updated successfully"),W({email:"",password:"",confirmPassword:"",full_name:"",role:"user"}),I(null),D(!1),ee()}catch(r){a.error(r instanceof Error?r.message:"Failed to update user")}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Changes"})]})]})}),q&&O&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Change Password for ",O.full_name||O.email]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"new-password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Password"}),r.jsx("input",{type:"password",id:"new-password",value:Y.password,onChange:e=>Z({...Y,password:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"confirm-new-password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirm New Password"}),r.jsx("input",{type:"password",id:"confirm-new-password",value:Y.confirmPassword,onChange:e=>Z({...Y,confirmPassword:e.target.value}),className:"w-full px-3 py-2 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white",required:!0})]})]}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>M(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"button",onClick:async()=>{try{if(!O)return;if(!Y.password)return void a.error("Please enter a password");if(Y.password!==Y.confirmPassword)return void a.error("Passwords do not match");K(!0);const r="https://tbwtfimnbmvbgesidbxh.supabase.co/functions/v1/update-user-password",t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(await e.auth.getSession()).data.session?.access_token}`},body:JSON.stringify({userId:O.id,password:Y.password})}),s=await t.json();if(!s.success)throw new Error(s.error||"Failed to change password");a.success("Password changed successfully"),Z({password:"",confirmPassword:""}),I(null),M(!1)}catch(r){a.error(r instanceof Error?r.message:"Failed to change password")}finally{K(!1)}},disabled:V,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center",children:V?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Changing..."]}):"Change Password"})]})]})}),U&&O&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full shadow-xl",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete User"}),r.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:["Are you sure you want to delete ",O.full_name||O.email,"? This action cannot be undone."]}),r.jsxs("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{type:"button",onClick:()=>$(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),r.jsx("button",{type:"button",onClick:async()=>{try{if(!O)return;const{error:r}=await e.auth.admin.deleteUser(O.id);if(r)throw r;a.success("User deleted successfully"),I(null),$(!1),ee()}catch(r){a.error(r instanceof Error?r.message:"Failed to delete user")}},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete User"})]})]})})]})}export{w as Users,w as default};
