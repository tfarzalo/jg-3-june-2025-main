import{s as e,j as t,b as a}from"./index-nRXVoRx_.js";import{k as r,u as s,r as d,L as l}from"./react-vendor--AdGielI.js";import{P as i}from"./PropertyMap-g0Uczq7S.js";import{u as n}from"./useSessionValidation-Dpzv_eLL.js";import{w as c}from"./supabaseErrorHandler-1QEbvNQf.js";import{u as x,J as o}from"./useJobFetch-ep4kg6_o.js";import{f as m}from"./utils-DsqaXd9R.js";import{z as g,B as h,a0 as p,M as y,a1 as u,a2 as b,q as j,I as k,P as N,N as w,F as f}from"./ui-a3QeRpHh.js";import"./supabase-Dq0wjmmz.js";import"./leaflet-DrIUZV5B.js";import"./pdf-TGvrJ6T9.js";function v(){const{propertyId:v}=r(),_=s();n();const{jobs:C,loading:A,error:B}=x({phaseLabel:["Job Request","Work Order","Pending Work Order","Invoicing","Completed","Cancelled"]}),E=C.filter((e=>e.property.id===v)),[P,D]=d.useState(null),[S,q]=d.useState(!0),[F,M]=d.useState(null),[U,z]=d.useState([]),[I,R]=d.useState({}),[$,L]=d.useState({}),[T,J]=d.useState([]),[H,O]=d.useState([]),[W,G]=d.useState([]),[Q,K]=d.useState([]),[V,Y]=d.useState(!1),[X,Z]=d.useState({callback_date:m(new Date,"yyyy-MM-dd"),painter:"",unit_number:"",reason:""}),[ee,te]=d.useState(!1),[ae,re]=d.useState({update_date:m(new Date,"yyyy-MM-dd"),update_type:"",note:""}),[se,de]=d.useState(null),[le,ie]=d.useState(null),ne=P?[P.address,P.city,P.state,P.zip].filter(Boolean).join(", "):"";d.useEffect((()=>{v&&ce()}),[v]);const ce=async()=>{try{const{data:t,error:a}=await e.from("files").select("*").eq("property_id",v).order("created_at",{ascending:!1});if(a)throw a;K(t||[])}catch(t){}};d.useEffect((()=>{(async()=>{try{q(!0),M(null);const{data:t,error:r}=await e.from("property_updates").select("update_type");if(!r&&t){const e=Array.from(new Set(t.map((e=>e.update_type))));G(e)}if(!v)return a.error("Property ID is required"),q(!1),void _("/dashboard/properties");const{data:s,error:d}=await e.from("properties").select("\n            *,\n            property_management_group:property_management_groups!fk_property_management_group(\n              company_name\n            )\n          ").eq("id",v).single();if(d)throw d;if(!s)return a.error("Property not found"),q(!1),void _("/dashboard/properties");D(s);const{data:l,error:i}=await e.from("billing_categories").select("*").eq("property_id",v).order("sort_order");if(i)throw i;if(z(l||[]),l?.length){const{data:t,error:a}=await e.from("billing_details").select("*").eq("property_id",v);if(a)throw a;const r={};t?.forEach((e=>{r[e.category_id]||(r[e.category_id]=[]),r[e.category_id].push(e)})),R(r);const{data:s,error:d}=await e.from("unit_sizes").select("*");if(d)throw d;const l={};s?.forEach((e=>{l[e.id]=e.unit_size_label})),L(l)}const{data:n,error:c}=await e.from("property_callbacks").select("\n            *,\n            poster:profiles(full_name)\n          ").eq("property_id",v).order("callback_date",{ascending:!1});if(c)throw c;J(n||[]);const{data:x,error:o}=await e.from("property_updates").select("\n            *,\n            poster:profiles(full_name)\n          ").eq("property_id",v).order("update_date",{ascending:!1});if(o)throw o;O(x||[]),q(!1)}catch(t){M("Failed to load property details"),q(!1)}})()}),[v,_]);return S?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):F||!P?t.jsx("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A]",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsx("div",{className:"flex items-center justify-between mb-8",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>_("/dashboard/properties"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:t.jsx(g,{className:"h-6 w-6"})}),t.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Property Details"})]})}),t.jsx("div",{className:"bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:F||"Property not found"}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>_("/dashboard/properties"),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:"Back to Properties"})})]})}):t.jsxs("div",{className:"p-6 bg-gray-100 dark:bg-[#0F172A]",children:[t.jsxs("div",{className:"flex items-center justify-between mb-8",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(h,{className:"h-8 w-8 text-gray-600 dark:text-gray-400"}),t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:P.property_name})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsxs("button",{type:"button",onClick:()=>_(`/dashboard/properties/${P.id}/edit`),className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(p,{className:"h-4 w-4 mr-2"}),"Edit Property"]}),t.jsx("button",{type:"button",onClick:()=>_("/dashboard/properties"),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#2D3B4E] rounded-lg hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors",children:"Back to List"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[t.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx(y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Location"})]}),P&&P.address?t.jsx(i,{address:ne,className:"w-full h-[300px]"}):t.jsx("div",{className:"flex items-center justify-center h-[300px] bg-gray-100 dark:bg-[#0F172A] rounded-lg border border-dashed border-gray-300 dark:border-gray-700",children:t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No address available"})})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Basic Information"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Address"}),t.jsxs("p",{className:"text-gray-900 dark:text-white",children:[P.address,P.address_2&&t.jsxs("span",{children:[t.jsx("br",{}),P.address_2]}),t.jsx("br",{}),P.city,", ",P.state," ",P.zip]})]})]}),t.jsxs("div",{className:"flex items-start",children:[t.jsx(h,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Property Management Group"}),t.jsx(l,{to:`/dashboard/property-groups/${P.property_management_group_id}`,className:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:P.property_management_group?.company_name||"No Group Assigned"})]})]}),P.phone&&t.jsxs("div",{className:"flex items-start",children:[t.jsx(u,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Phone"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.phone})]})]}),P.region&&t.jsxs("div",{className:"flex items-start",children:[t.jsx(y,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Region"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.region})]})]}),P.property_grade&&t.jsxs("div",{className:"flex items-start",children:[t.jsx(b,{className:"h-5 w-5 text-gray-500 dark:text-gray-400 mt-1 mr-3"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Property Grade"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.property_grade})]})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Contact Information"}),t.jsxs("div",{className:"space-y-6",children:[(P.community_manager_name||P.community_manager_email||P.community_manager_phone)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Community Manager"}),t.jsxs("div",{className:"space-y-2",children:[P.community_manager_name&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(j,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.community_manager_name})]}),P.community_manager_email&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.community_manager_email})]}),P.community_manager_phone&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(u,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.community_manager_phone})]})]})]}),(P.maintenance_supervisor_name||P.maintenance_supervisor_email||P.maintenance_supervisor_phone)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Maintenance Supervisor"}),t.jsxs("div",{className:"space-y-2",children:[P.maintenance_supervisor_name&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(j,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.maintenance_supervisor_name})]}),P.maintenance_supervisor_email&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.maintenance_supervisor_email})]}),P.maintenance_supervisor_phone&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(u,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.maintenance_supervisor_phone})]})]})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Paint Colors"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[P.color_walls&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Walls"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_walls})]}),P.color_trim&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Trim"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_trim})]}),P.color_regular_unit&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Regular Unit"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_regular_unit})]}),P.color_kitchen_bathroom&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Kitchen/Bathroom"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_kitchen_bathroom})]}),P.color_ceilings&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Ceilings"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.color_ceilings})]}),P.paint_location&&t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Paint Location"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.paint_location})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Compliance Information"}),t.jsx("div",{className:"space-y-3",children:t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Compliance Required"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_required||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Compliance Approved"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_approved||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Bid Approved"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_bid_approved||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"PO Needed"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_po_needed||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"W9 Created"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_w9_created||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"COI Address"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_coi_address||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Create Sub Prop Portal"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_create_sub_prop_portal||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Notify Team"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_notify_team||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Upload Documents"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_upload_documents||"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Invoice Delivery"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.compliance_invoice_delivery||"N/A"})]})]})})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-2",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Billing Information"}),t.jsxs("button",{onClick:()=>_(`/dashboard/properties/${P.id}/billing`),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(N,{className:"h-4 w-4 mr-2 inline-block"}),"Manage Billing Details"]})]}),t.jsxs("div",{className:"space-y-6",children:[(P.ap_name||P.ap_email||P.ap_phone)&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"AP Contact"}),t.jsxs("div",{className:"space-y-2",children:[P.ap_name&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(j,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.ap_name})]}),P.ap_email&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(k,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.ap_email})]}),P.ap_phone&&t.jsxs("div",{className:"flex items-center",children:[t.jsx(u,{className:"h-4 w-4 text-gray-500 dark:text-gray-400 mr-2"}),t.jsx("span",{className:"text-gray-900 dark:text-white",children:P.ap_phone})]})]})]}),P.quickbooks_number&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"QuickBooks Number"}),t.jsx("p",{className:"text-gray-900 dark:text-white",children:P.quickbooks_number})]}),P.billing_notes&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Billing Notes"}),t.jsx("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:P.billing_notes})]}),U.length>0&&t.jsxs("div",{children:[t.jsx("h4",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2",children:"Billing Details"}),t.jsx("div",{className:"space-y-4",children:U.map((e=>t.jsxs("div",{className:"bg-gray-50 dark:bg-[#0F172A] rounded-lg p-4",children:[t.jsx("h5",{className:"text-gray-900 dark:text-white font-medium mb-2",children:e.name}),t.jsx("div",{className:"space-y-2",children:I[e.id]?.map((e=>t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:$[e.unit_size_id]}),t.jsxs("div",{className:"space-x-4",children:[t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Bill: $",e.bill_amount]}),t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Sub Pay: $",e.sub_pay_amount]}),!e.is_hourly&&t.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Profit: $",e.profit_amount]}),e.is_hourly&&t.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Hourly Rate"})]})]},e.unit_size_id)))})]},e.id)))})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-3",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Callbacks"}),t.jsxs("button",{onClick:()=>Y(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(N,{className:"h-4 w-4 mr-2 inline-block"}),"Add Callback"]})]}),0===T.length?t.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No callbacks recorded for this property"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-[#0F172A]",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Painter"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Unit"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Reason"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Posted By"}),t.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white dark:bg-[#1E293B] divide-y divide-gray-200 dark:divide-gray-700",children:T.map((e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:new Date(e.callback_date).toLocaleDateString()}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.painter||"N/A"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.unit_number}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:e.reason}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.poster?.full_name||"Unknown"}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx("button",{onClick:()=>de(e.id),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",children:t.jsx(w,{className:"h-4 w-4"})})})]},e.id)))})]})}),V&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New Callback"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Date"}),t.jsx("input",{type:"date",value:X.callback_date,onChange:e=>Z({...X,callback_date:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Painter"}),t.jsx("input",{type:"text",value:X.painter,onChange:e=>Z({...X,painter:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",placeholder:"Enter painter name"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Unit #"}),t.jsx("input",{type:"text",value:X.unit_number,onChange:e=>Z({...X,unit_number:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",placeholder:"Enter unit number",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reason"}),t.jsx("textarea",{value:X.reason,onChange:e=>Z({...X,reason:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",placeholder:"Enter reason for callback",rows:3,required:!0})]})]}),t.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>Y(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{if(v)if(X.callback_date.trim())if(X.unit_number.trim())if(X.reason.trim())try{const{data:t,error:r}=await c(e.from("property_callbacks").insert({property_id:v,callback_date:X.callback_date,painter:X.painter,unit_number:X.unit_number,reason:X.reason}).select("\n            *,\n            poster:profiles(full_name)\n          "),"add-callback");if(r)return void a.error(`Failed to add callback: ${r.message}`);t&&(J((e=>[t[0],...e])),Y(!1),Z({callback_date:m(new Date,"yyyy-MM-dd"),painter:"",unit_number:"",reason:""}),a.success("Callback added successfully"))}catch(t){a.error("An unexpected error occurred.")}else a.error("Reason is required");else a.error("Unit number is required");else a.error("Callback date is required");else a.error("You must be logged in to add a callback.")},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Callback"})]})]})}),se&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Callback"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Are you sure you want to delete this callback? This action cannot be undone."}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>de(null),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{type:"button",onClick:()=>(async t=>{try{const{error:r}=await e.from("property_callbacks").delete().eq("id",t);if(r)throw r;de(null);const{data:s,error:d}=await e.from("property_callbacks").select("\n          *,\n          poster:profiles(full_name)\n        ").eq("property_id",v).order("callback_date",{ascending:!1});if(d)throw d;J(s||[]),a.success("Callback deleted successfully")}catch(r){a.error("Failed to delete callback")}})(se),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-3 mt-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Property Updates / Notes"}),t.jsxs("button",{onClick:()=>te(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(N,{className:"h-4 w-4 mr-2 inline-block"}),"Add Note"]})]}),0===H.length?t.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No updates recorded for this property"}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[t.jsx("thead",{className:"bg-gray-50 dark:bg-[#0F172A]",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Note"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Posted By"}),t.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white dark:bg-[#1E293B] divide-y divide-gray-200 dark:divide-gray-700",children:H.map((e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:m(new Date(e.update_date),"MM/dd/yyyy")}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.update_type}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white",children:e.note}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:e.poster.full_name}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:t.jsx("button",{onClick:()=>ie(e.id),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",children:t.jsx(w,{className:"h-4 w-4"})})})]},e.id)))})]})}),ee&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Add New Update/Note"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Date"}),t.jsx("input",{type:"date",value:ae.update_date,onChange:e=>re({...ae,update_date:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),t.jsxs("select",{value:ae.update_type,onChange:e=>re({...ae,update_type:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white",children:[t.jsx("option",{value:"",children:"Select a type..."}),W.map((e=>t.jsx("option",{value:e,children:e},e)))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Note"}),t.jsx("textarea",{value:ae.note,onChange:e=>re({...ae,note:e.target.value}),className:"w-full rounded-md bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white h-24",placeholder:"Enter note details"})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>te(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{if(!v)return void a.error("Property ID is required to add a note.");const{data:t,error:r}=await e.auth.getSession();if(r||!t.session)return void a.error("Authentication error. Please log in again.");const s=t.session.user.id;if(!ae.update_date.trim()||!ae.update_type.trim()||!ae.note.trim())return void a.error("All fields are required for an update.");const{data:d,error:l}=await c(e.from("property_updates").insert({property_id:v,update_date:ae.update_date,update_type:ae.update_type,note:ae.note,posted_by:s}).select("\n          *,\n          poster:profiles(full_name)\n        "),"add-update");l?a.error(`Failed to add update: ${l.message}`):d&&(O((e=>[d[0],...e])),te(!1),re({update_date:m(new Date,"yyyy-MM-dd"),update_type:"",note:""}),a.success("Update added successfully"))},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Update"})]})]})}),le&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Update"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Are you sure you want to delete this update? This action cannot be undone."}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>ie(null),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Cancel"}),t.jsx("button",{type:"button",onClick:()=>(async t=>{try{const{error:r}=await e.from("property_updates").delete().eq("id",t);if(r)throw r;ie(null);const{data:s,error:d}=await e.from("property_updates").select("\n          *,\n          poster:profiles(full_name)\n        ").eq("property_id",v).order("update_date",{ascending:!1});if(d)throw d;O(s||[]),a.success("Update deleted successfully")}catch(r){a.error("Failed to delete update")}})(le),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-3 mt-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Job History"}),t.jsx(o,{title:"Job History",jobs:E,loading:A,error:B??null,showAddButton:!1})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow-lg lg:col-span-3 mt-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Property Documents"}),t.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Q.map((e=>t.jsxs("div",{className:"relative flex items-center space-x-3 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-[#1E293B] px-6 py-5 shadow-sm hover:border-gray-400 dark:hover:border-gray-600",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(f,{className:"h-6 w-6 text-gray-400"})}),t.jsx("div",{className:"min-w-0 flex-1",children:t.jsxs("a",{href:e.path,target:"_blank",rel:"noopener noreferrer",className:"focus:outline-none",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),t.jsx("p",{className:"truncate text-sm text-gray-500 dark:text-gray-400",children:new Date(e.created_at).toLocaleDateString()})]})})]},e.id)))})]})]})]})}export{v as PropertyDetails};
