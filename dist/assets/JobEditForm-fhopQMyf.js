import{s as e,j as t}from"./index-trbIQK5H.js";import{k as r,u as a,r as s}from"./react-vendor-BmeRVKJv.js";import{b as o}from"./dateUtils-aI21ZMtv.js";import{z as d,N as i}from"./ui-CiwSAYI4.js";import"./supabase-c3qFLfUQ.js";import"./utils-C_z87yX_.js";function n(){const{jobId:n}=r(),l=a(),[c,b]=s.useState(!1),[u,m]=s.useState(!0),[h,x]=s.useState(null),[g,p]=s.useState(!1),[y,j]=s.useState([]),[f,_]=s.useState([]),[k,w]=s.useState([]),[v,N]=s.useState([]),[E,F]=s.useState({property_id:"",unit_number:"",unit_size_id:"",job_type_id:"",description:"",scheduled_date:""});s.useEffect((()=>{n?Promise.all([S(),z(),D(),q(),B()]):l("/dashboard/jobs")}),[n,l]);const S=async()=>{try{const{data:t,error:r}=await e.from("jobs").select("\n          id,\n          property_id,\n          unit_number,\n          unit_size_id,\n          job_type_id,\n          description,\n          scheduled_date,\n          job_phase:current_phase_id (\n            id,\n            job_phase_label,\n            color_light_mode,\n            color_dark_mode,\n            sort_order,\n            order_index,\n            created_at\n          )\n        ").eq("id",n).single();if(r)throw r;if(!t)throw new Error("Job not found");if("Job Request"!==t.job_phase?.job_phase_label)throw new Error("This job can no longer be edited as it has progressed beyond the Job Request phase.");const a=o(t.scheduled_date);F({property_id:t.property_id,unit_number:t.unit_number,unit_size_id:t.unit_size_id,job_type_id:t.job_type_id,description:t.description||"",scheduled_date:a})}catch(t){x(t instanceof Error?t.message:"Failed to fetch job")}finally{m(!1)}},z=async()=>{try{const{data:t,error:r}=await e.from("properties").select("*").eq("is_archived",!1).order("property_name");if(r)throw r;j(t||[])}catch(t){x(t instanceof Error?t.message:"Failed to fetch properties")}},D=async()=>{try{const{data:t,error:r}=await e.from("unit_sizes").select("*").order("unit_size_label");if(r)throw r;_(t||[])}catch(t){x(t instanceof Error?t.message:"Failed to fetch unit sizes")}},q=async()=>{try{const{data:t,error:r}=await e.from("job_types").select("*").order("job_type_label");if(r)throw r;w(t||[])}catch(t){x(t instanceof Error?t.message:"Failed to fetch job types")}},B=async()=>{try{const{data:t,error:r}=await e.from("job_phases").select("id, job_phase_label, color_light_mode, color_dark_mode, sort_order, order_index, created_at").order("sort_order");if(r)throw r;N(t||[])}catch(t){}},C=e=>[e.address,e.address_2,e.city,e.state,e.zip].filter(Boolean).join(", "),J=e=>{const{name:t,value:r}=e.target;F((e=>({...e,[t]:r})))};return u?t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):t.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-[#0F172A] p-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsx("div",{className:"flex items-center justify-between mb-8",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>l(`/dashboard/jobs/${n}`),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:t.jsx(d,{className:"h-6 w-6"})}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Edit Job Request"})]})}),h&&t.jsx("div",{className:"mb-6 bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:h}),t.jsxs("form",{onSubmit:async t=>{t.preventDefault(),b(!0),x(null);try{const{error:t}=await e.from("jobs").update(E).eq("id",n);if(t)throw t;l(`/dashboard/jobs/${n}`)}catch(r){x(r instanceof Error?r.message:"Failed to update job")}finally{b(!1)}},className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Property Information"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"property_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Select Property"}),t.jsxs("select",{id:"property_id",name:"property_id",required:!0,value:E.property_id,onChange:J,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a property"}),y.map((e=>t.jsxs("option",{value:e.id,children:[e.property_name," | ",C(e)]},e.id)))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_number",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Unit #"}),t.jsx("input",{type:"text",id:"unit_number",name:"unit_number",required:!0,value:E.unit_number,onChange:J,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter unit number"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_size_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Unit Size"}),t.jsxs("select",{id:"unit_size_id",name:"unit_size_id",required:!0,value:E.unit_size_id,onChange:J,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a unit size"}),f.map((e=>t.jsx("option",{value:e.id,children:e.unit_size_label},e.id)))]})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Job Details"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"scheduled_date",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Schedule Work Date"}),t.jsx("input",{type:"date",id:"scheduled_date",name:"scheduled_date",required:!0,value:E.scheduled_date,onChange:J,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"job_type_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Job Type"}),t.jsxs("select",{id:"job_type_id",name:"job_type_id",required:!0,value:E.job_type_id,onChange:J,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a job type"}),k.map((e=>t.jsx("option",{value:e.id,children:e.job_type_label},e.id)))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Job Request Notes / Additional Info"}),t.jsx("textarea",{id:"description",name:"description",rows:4,value:E.description,onChange:J,className:"w-full px-4 py-3 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter job request notes and additional information..."})]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("button",{type:"button",onClick:()=>p(!0),className:"inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors",children:[t.jsx(i,{className:"h-4 w-4 mr-2"}),"Delete Job"]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>l(`/dashboard/jobs/${n}`),className:"px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#2D3B4E] rounded-lg hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:c,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:c?"Saving...":"Save Changes"})]})]})]}),g&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 max-w-md w-full",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Delete Job"}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:"Are you sure you want to delete this job? This action cannot be undone."}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-[#2D3B4E] rounded-lg hover:bg-gray-50 dark:hover:bg-[#374151] transition-colors",children:"Cancel"}),t.jsx("button",{type:"button",onClick:async()=>{b(!0),x(null);try{const{error:t}=await e.from("job_phase_changes").delete().eq("job_id",n);if(t)throw t;const{error:r}=await e.from("jobs").delete().eq("id",n);if(r)throw r;l("/dashboard/jobs")}catch(t){x(t instanceof Error?t.message:"Failed to delete job"),b(!1)}},disabled:c,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:c?"Deleting...":"Delete Job"})]})]})})]})})}export{n as JobEditForm};
