import{s as e,b as t}from"./index-BXIsiie0.js";class r{static retryAttempts=new Map;static maxRetries=1;static async handleError(t,r){if(this.is401Error(t)){const t=r||"default",i=this.retryAttempts.get(t)||0;if(i>=this.maxRetries)return this.retryAttempts.delete(t),this.redirectToLogin("Session expired. Please sign in again."),!1;try{this.retryAttempts.set(t,i+1);const{data:r,error:s}=await e.auth.refreshSession();return s||!r.session?(this.retryAttempts.delete(t),this.redirectToLogin("Session expired. Please sign in again."),!1):(this.retryAttempts.delete(t),!0)}catch(s){return this.retryAttempts.delete(t),this.redirectToLogin("Session expired. Please sign in again."),!1}}return!1}static is401Error(e){return"401"===e?.code||401===e?.status||e?.message?.includes("401")||e?.message?.includes("JWT expired")||e?.message?.includes("unauthorized")||e?.message?.toLowerCase().includes("permission denied")}static redirectToLogin(e){t.error(e);try{const e="https://tbwtfimnbmvbgesidbxh.supabase.co"?.split("//")[1]?.split(".")[0];e&&localStorage.removeItem(`sb-${e}-auth-token`),localStorage.removeItem("gibson_token")}catch(r){}setTimeout((()=>{window.location.href="/auth"}),100)}static async executeWithRetry(e,t){try{const r=await e();if(r.error){if(await this.handleError(r.error,t))return await e()}return r}catch(r){throw await this.handleError(r,t),r}}}function s(e,t){return r.executeWithRetry((()=>e),t)}export{r as S,s as w};
