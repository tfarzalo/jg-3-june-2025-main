import{u as e,s as r,j as t}from"./index-BXIsiie0.js";import{u as a,r as s}from"./react-vendor--AdGielI.js";import{g as d}from"./dateUtils-lps6FOOV.js";import{z as o}from"./ui-a3QeRpHh.js";import"./supabase-Dq0wjmmz.js";import"./utils-D-HhOMZR.js";function i(){const i=a(),{user:n}=e(),[l,c]=s.useState(!1),[u,b]=s.useState(null),[m,x]=s.useState([]),[p,h]=s.useState([]),[g,y]=s.useState([]),[j,f]=s.useState({supabaseConnected:!1,propertiesLoaded:!1,unitSizesLoaded:!1,jobTypesLoaded:!1}),[_,k]=s.useState({property_id:"",unit_number:"",unit_size_id:"",job_type_id:"",description:"",scheduled_date:d()});s.useEffect((()=>{(async()=>{try{const{data:e,error:t}=await r.from("properties").select("count").limit(1);if(f((e=>({...e,supabaseConnected:!t}))),t)throw t}catch(e){}})(),Promise.all([v(),w(),N()])}),[]);const v=async()=>{try{const{data:e,error:t}=await r.from("properties").select("*").eq("is_archived",!1).order("property_name");if(t)throw t;x(e||[]),f((e=>({...e,propertiesLoaded:!0})))}catch(e){b(e instanceof Error?e.message:"Failed to fetch properties")}},w=async()=>{try{const{data:e,error:t}=await r.from("unit_sizes").select("*").order("unit_size_label");if(t)throw t;h(e||[]),f((e=>({...e,unitSizesLoaded:!0})))}catch(e){b(e instanceof Error?e.message:"Failed to fetch unit sizes")}},N=async()=>{try{const{data:e,error:t}=await r.from("job_types").select("*").order("job_type_label");if(t)throw t;y(e||[]),f((e=>({...e,jobTypesLoaded:!0})))}catch(e){b(e instanceof Error?e.message:"Failed to fetch job types")}},E=e=>[e.address,e.address_2,e.city,e.state,e.zip].filter(Boolean).join(", "),F=e=>{const{name:r,value:t}=e.target;k((e=>({...e,[r]:t})))};return t.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-[#0F172A] p-6",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsx("div",{className:"flex items-center justify-between mb-8",children:t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:()=>i("/dashboard/jobs"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:t.jsx(o,{className:"h-6 w-6"})}),t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Add Job Request"})]})}),u&&t.jsx("div",{className:"mb-6 bg-red-50 dark:bg-red-900/50 border border-red-200 dark:border-red-500/50 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg",children:u}),t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),c(!0),b(null),!n)return b("You must be logged in to create a job request"),void c(!1);try{const e=_.scheduled_date,{data:t,error:a}=await r.rpc("create_job",{p_property_id:_.property_id,p_unit_number:_.unit_number,p_unit_size_id:_.unit_size_id,p_job_type_id:_.job_type_id,p_description:_.description||"",p_scheduled_date:e});if(a)throw a;if(!t)throw new Error("Failed to create job");i(`/dashboard/jobs/${t.id}`)}catch(t){b(t instanceof Error?t.message:"Failed to create job request"),c(!1)}},className:"space-y-6",children:[t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Property Information"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"property_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Select Property"}),t.jsxs("select",{id:"property_id",name:"property_id",required:!0,value:_.property_id,onChange:F,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a property"}),m.map((e=>t.jsxs("option",{value:e.id,children:[e.property_name," | ",E(e)]},e.id)))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_number",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Unit #"}),t.jsx("input",{type:"text",id:"unit_number",name:"unit_number",required:!0,value:_.unit_number,onChange:F,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter unit number"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"unit_size_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Unit Size"}),t.jsxs("select",{id:"unit_size_id",name:"unit_size_id",required:!0,value:_.unit_size_id,onChange:F,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a unit size"}),p.map((e=>t.jsx("option",{value:e.id,children:e.unit_size_label},e.id)))]})]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-[#1E293B] rounded-lg p-6 shadow",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Job Details"}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"scheduled_date",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Schedule Work Date"}),t.jsx("input",{type:"date",id:"scheduled_date",name:"scheduled_date",required:!0,value:_.scheduled_date,onChange:F,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"job_type_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Job Type"}),t.jsxs("select",{id:"job_type_id",name:"job_type_id",required:!0,value:_.job_type_id,onChange:F,className:"w-full h-11 px-4 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select a job type"}),g.map((e=>t.jsx("option",{value:e.id,children:e.job_type_label},e.id)))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"Job Request Notes / Additional Info"}),t.jsx("textarea",{id:"description",name:"description",rows:4,value:_.description,onChange:F,className:"w-full px-4 py-3 bg-gray-50 dark:bg-[#0F172A] border border-gray-300 dark:border-[#2D3B4E] rounded-lg text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter job request notes and additional information..."})]})]})]}),t.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[t.jsx("button",{type:"button",onClick:()=>i("/dashboard/jobs"),className:"px-6 py-2 text-sm font-medium text-gray-700 dark:text-gray-400 bg-white dark:bg-[#1E293B] border border-gray-300 dark:border-[#2D3B4E] rounded-lg hover:bg-gray-50 dark:hover:bg-[#2D3B4E] transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:l?"Creating...":"Create Job Request"})]})]})]})})}export{i as JobRequestForm};
